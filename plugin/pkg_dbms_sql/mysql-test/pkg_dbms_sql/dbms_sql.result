SET sql_mode=ORACLE;
CREATE TABLE t1 (a INT, b VARCHAR(10));
CREATE PROCEDURE p1 AS
BEGIN
PREPARE stmt FROM 'INSERT INTO t1 VALUES (:a,:b)';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':b', 'b00');
EXECUTE stmt;
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 1);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':b', 'b01');
EXECUTE stmt;
END;
$$
CALL p1;
SELECT * FROM t1;
a	b
0	b00
1	b01
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT, b VARCHAR(10));
CREATE PROCEDURE p1(do_set_b BOOL, do_execute BOOL) AS
BEGIN
PREPARE stmt FROM 'INSERT INTO t1 VALUES (:a,:b)';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 1);
IF do_set_b THEN
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':b', 'b01');
END IF;
IF do_execute THEN
EXECUTE stmt;
END IF;
END;
$$
CALL p1(FALSE, FALSE);
CALL p1(FALSE, TRUE);
ERROR HY000: Incorrect arguments to EXECUTE
CALL p1(TRUE, TRUE);
SELECT * FROM t1;
a	b
1	b01
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT, b VARCHAR(10));
CREATE PROCEDURE p1(do_execute BOOL) AS
BEGIN
PREPARE stmt FROM 'INSERT INTO t1 VALUES (:a,:a)';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 1); -- Sets the left :a again
IF do_execute THEN
EXECUTE stmt;
END IF;
END;
$$
CALL p1(FALSE);
CALL p1(TRUE);
ERROR HY000: Incorrect arguments to EXECUTE
SELECT * FROM t1;
a	b
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT, b VARCHAR(10));
CREATE PROCEDURE p1 AS
BEGIN
PREPARE stmt FROM 'INSERT INTO t1 VALUES (:a,:b)';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':a', 0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':b', 'b00');
EXECUTE stmt;
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'A', 1);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'B', 'b01');
EXECUTE stmt;
END;
$$
CALL p1;
SELECT * FROM t1;
a	b
0	b00
1	b01
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT, b VARCHAR(10), c DECIMAL(12,2));
CREATE OR REPLACE PROCEDURE p1 AS
BEGIN
PREPARE stmt FROM 'INSERT INTO t1 VALUES(:a,:b,:c)';
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', 10);
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', 'b01');
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', 10.12);
EXECUTE stmt;
EXECUTE stmt;
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', NULL);
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', NULL);
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', NULL);
EXECUTE stmt;
EXECUTE stmt;
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', 20);
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', 'b02');
SELECT DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', 20.12);
EXECUTE stmt;
EXECUTE stmt;
END;
$$
CALL p1();
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', 10)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', 'b01')
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', 10.12)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', NULL)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', NULL)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', NULL)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'a', 20)
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'b', 'b02')
0
DBMS_SQL_BIND_PARAM_BY_NAME('stmt', 'c', 20.12)
0
SELECT * FROM t1;
a	b	c
10	b01	10.12
10	b01	10.12
NULL	NULL	NULL
NULL	NULL	NULL
20	b02	20.12
20	b02	20.12
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE PROCEDURE p1 AS
v0 INT := 10;
v1 VARCHAR(10) := 'v10';
BEGIN
PREPARE stmt FROM 'SELECT :p0,:p1';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p0', v0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p1', v1);
EXECUTE stmt;
v0:= 11;
v1:= 'v11';
EXECUTE stmt; -- This still selects (10,'v10')
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p0', v0);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p1', v1);
EXECUTE stmt;
DEALLOCATE PREPARE stmt;
END;
$$
CALL p1;
:p0	:p1
10	v10
:p0	:p1
10	v10
:p0	:p1
11	v11
DROP PROCEDURE p1;
CREATE PROCEDURE p1 AS
v0 TEXT;
c0 SYS_REFCURSOR;
BEGIN
PREPARE stmt FROM 'SELECT 123';
OPEN c0 FOR 'PS:stmt';
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
123
DROP PROCEDURE p1;
CREATE PROCEDURE p1 AS
c0 SYS_REFCURSOR;
BEGIN
PREPARE stmt FROM 'SELECT :a';
OPEN c0 FOR 'PS:stmt';
END;
$$
CALL p1;
ERROR HY000: Incorrect arguments to OPEN
DROP PROCEDURE p1;
CREATE PROCEDURE p1 AS
v0 INTEGER;
v1 TEXT;
c0 SYS_REFCURSOR;
BEGIN
PREPARE stmt FROM 'SELECT :p0,:p1';
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p0', 10);
DO DBMS_SQL_BIND_PARAM_BY_NAME('stmt', ':p1', 'p10');
OPEN c0 FOR 'PS:stmt';
FETCH c0 INTO v0, v1;
CLOSE c0;
SELECT v0, v1;
END;
$$
CALL p1;
v0	v1
10	p10
DROP PROCEDURE p1;
CREATE PROCEDURE p1() AS
c0 SYS_REFCURSOR;
BEGIN
DO DBMS_SQL_COLUMN_VALUE(c0, 1, 10/*expect a variable here*/);
END;
$$
CALL p1;
ERROR HY000: Incorrect arguments to DBMS_SQL_COLUMN_VALUE
DROP PROCEDURE p1;
CREATE PROCEDURE p1() AS
v00 INT;
c0 SYS_REFCURSOR;
BEGIN
DO DBMS_SQL_COLUMN_VALUE(c0, 1, v00);
SELECT v00;
END;
$$
CALL p1;
v00
NULL
Warnings:
Error	1324	Undefined CURSOR: NULL
DROP PROCEDURE p1;
CREATE PROCEDURE p1() AS
v00 INT;
V10 VARCHAR(10);
c0 SYS_REFCURSOR;
BEGIN
OPEN c0 FOR SELECT 0,'s0' UNION SELECT 1,'s1';
DO DBMS_SQL_COLUMN_VALUE(c0, 1, v00);
DO DBMS_SQL_COLUMN_VALUE(c0, 2, v10);
SELECT v00, v10;
END;
$$
CALL p1();
v00	v10
1	s1
DROP PROCEDURE p1;
CREATE PROCEDURE p1(col1 INT, col2 INT) AS
v00_dummy INT;
v10_dummy VARCHAR(10);
v00 INT;
V10 VARCHAR(10);
c0 SYS_REFCURSOR;
BEGIN
OPEN c0 FOR SELECT 0,'s0' UNION SELECT 1,'s1';
FETCH c0 INTO v00_dummy,v10_dummy;
FETCH c0 INTO v00_dummy,v10_dummy;
DO DBMS_SQL_COLUMN_VALUE(c0, col1, v00);
DO DBMS_SQL_COLUMN_VALUE(c0, col2, v10);
SELECT v00, v10;
END;
$$
CALL p1(NULL,NULL);
v00	v10
NULL	NULL
Warnings:
Error	1210	Incorrect arguments to DBMS_SQL_COLUMN_VALUE
CALL p1(0,1);
v00	v10
NULL	1
Warnings:
Error	1210	Incorrect arguments to DBMS_SQL_COLUMN_VALUE
CALL p1(-1,0);
v00	v10
NULL	NULL
Warnings:
Error	1210	Incorrect arguments to DBMS_SQL_COLUMN_VALUE
CALL p1(1,3);
v00	v10
1	NULL
Warnings:
Error	1210	Incorrect arguments to DBMS_SQL_COLUMN_VALUE
CALL p1(1,2);
v00	v10
1	s1
DROP PROCEDURE p1;
CREATE PROCEDURE p1 AS
v00 INT;
V10 VARCHAR(10);
c0 SYS_REFCURSOR;
BEGIN
OPEN c0 FOR SELECT 0,'s0' UNION SELECT 1,'s1';
FETCH c0;
SELECT DBMS_SQL_COLUMN_VALUE(c0,1,v00);
SELECT DBMS_SQL_COLUMN_VALUE(c0,2,v10);
SELECT v00, v10, c0%FOUND;
FETCH c0;
SELECT DBMS_SQL_COLUMN_VALUE(c0,1,v00);
SELECT DBMS_SQL_COLUMN_VALUE(c0,2,v10);
SELECT v00, v10, c0%FOUND;
FETCH c0;
SELECT DBMS_SQL_COLUMN_VALUE(c0,1,v00);
SELECT DBMS_SQL_COLUMN_VALUE(c0,2,v10);
SELECT v00, v10, c0%FOUND;
END;
$$
CALL p1;
DBMS_SQL_COLUMN_VALUE(c0,1,v00)
0
DBMS_SQL_COLUMN_VALUE(c0,2,v10)
0
v00	v10	c0%FOUND
0	s0	1
DBMS_SQL_COLUMN_VALUE(c0,1,v00)
0
DBMS_SQL_COLUMN_VALUE(c0,2,v10)
0
v00	v10	c0%FOUND
1	s1	1
DBMS_SQL_COLUMN_VALUE(c0,1,v00)
NULL
DBMS_SQL_COLUMN_VALUE(c0,2,v10)
NULL
v00	v10	c0%FOUND
1	s1	0
DROP PROCEDURE p1;
CREATE PROCEDURE p1 AS
v00 INT;
V10 VARCHAR(10);
CURSOR c0 IS SELECT 0,'s0' UNION SELECT 1,'s1';
BEGIN
OPEN c0;
FETCH c0;
FETCH c0 INTO v00, v10;
SELECT v00, v10, c0%FOUND;
FETCH c0 INTO v00, v10;
SELECT v00, v10, c0%FOUND;
END;
$$
CALL p1;
v00	v10	c0%FOUND
1	s1	1
v00	v10	c0%FOUND
1	s1	0
DROP PROCEDURE p1;
