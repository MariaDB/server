--echo #
--echo # MDEV-20034 Add support for the pre-defined weak SYS_REFCURSOR
--echo #

--echo #
--echo # IF expr
--echo #

DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  IF c0 THEN
    SELECT 'TRUE';
  ELSE
    SELECT 'NOT TRUE';
  END IF;
END;
/
DELIMITER ;/


--echo #
--echo # CASE expr WHEN..THEN
--echo #

DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  CASE c0 WHEN TRUE THEN
    SELECT 'TRUE';
  ELSE
    SELECT 'NOT TRUE';
  END CASE;
END;
/
DELIMITER ;/


--echo #
--echo # CASE WHEN expr THEN
--echo #

DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  CASE
  WHEN c0 THEN
    SELECT 'TRUE';
  ELSE
    SELECT 'NOT TRUE';
  END CASE;
END;
/
DELIMITER ;/


--echo #
--echo # UNTIL expr
--echo #

DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  DECLARE v INT;
  OPEN c0 FOR SELECT 1;
  REPEAT
    FETCH c0 INTO v;
  UNTIL c0
  END REPEAT;
END;
/
DELIMITER ;/


--echo #
--echo # WHILE expr
--echo #

DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  DECLARE v INT;
  OPEN c0 FOR SELECT 1;
  WHILE c0 DO
    FETCH c0 INTO v;
  END WHILE;
END;
/
DELIMITER ;/


--echo #
--echo # EXIT WHEN expr
--echo #

SET sql_mode=ORACLE;
DELIMITER /;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
DECLARE
  c0 SYS_REFCURSOR;
BEGIN
  OPEN c0 FOR SELECT 1;
  FOR i IN 0..5
  LOOP
    EXIT WHEN c0;
  END LOOP;
END;
/
DELIMITER ;/
SET sql_mode=DEFAULT;


--echo #
--echo # RAISE expr
--echo #

SET sql_mode=ORACLE;
DELIMITER /;
--error ER_SP_COND_MISMATCH
DECLARE
  c0 SYS_REFCURSOR;
BEGIN
  RAISE c0;
EXCEPTION
  WHEN OTHERS THEN SELECT 'Got some exception';
END;
/
DELIMITER ;/
SET sql_mode=DEFAULT;


--echo #
--echo # EXCEPTION WHEN expr
--echo #

SET sql_mode=ORACLE;
DELIMITER /;
--error ER_SP_COND_MISMATCH
DECLARE
  c0 SYS_REFCURSOR;
BEGIN
  SELECT 1;
EXCEPTION
  WHEN c0 THEN RETURN 'Got exception c0';
END;
/
DELIMITER ;/
SET sql_mode=DEFAULT;
