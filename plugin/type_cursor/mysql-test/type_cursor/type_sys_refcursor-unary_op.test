--echo #
--echo # MDEV-20034 Add support for the pre-defined weak SYS_REFCURSOR
--echo #

--echo #
--echo # Unary operations
--echo #

DELIMITER $$;
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT c0 IS NULL AS c0n1;
  OPEN c0 FOR SELECT 1;
  SELECT c0 IS NULL AS c0n2;
  CLOSE c0;
  SELECT c0 IS NULL AS c0n3;
  SET c0=NULL;
  SELECT c0 IS NULL AS c0n3;
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT ROUND(c0);
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT FLOOR(c0);
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT ABS(c0);
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT -c0;
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT NOT c0;
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c0 SYS_REFCURSOR;
  SELECT c0 COLLATE latin1_bin;
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT IF (c, 'TRUE', 'FALSE'); -- can_return_bool()
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT CASE WHEN c THEN 'TRUE' ELSE 'FALSE' END;
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT BIT_COUNT(c); -- can_return_int()
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT FROM_UNIXTIME(c); -- can_return_decimal
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT SEC_TO_TIME(c); -- can_return_decimal
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT LN(c); -- can_return_real
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT OCTET_LENGTH(c); -- can_return_str
END;
$$
DELIMITER ;$$

DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT COERCIBILITY(c); -- can_return_str
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT LAST_DAY(c); -- can_return_date
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT SECOND(c); -- can_return_time
END;
$$
DELIMITER ;$$


DELIMITER $$;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
BEGIN NOT ATOMIC
  DECLARE c SYS_REFCURSOR;
  SELECT EXTRACT(SECOND FROM c); -- can_return_extract_source
END;
$$
DELIMITER ;$$
