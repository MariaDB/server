SET sql_mode=ORACLE;
#
# MDEV-10152 Add support for TYPE .. IS REF CURSOR
#
################### RECORD + XXX
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
v0 INT;
BEGIN
OPEN c0 FOR SELECT 10;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT a FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
r0 rec0_t;
BEGIN
OPEN c0 FOR SELECT 10;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE rec1_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
r0 rec1_t;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
r0 t1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
CURSOR c1 IS SELECT * FROM t1;
c0 cur0_t;
r0 c1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
################### RECORD(col%TYPE) + XXX
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
v0 INT;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE rec1_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
r0 rec1_t;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT 10;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
c0 cur0_t;
r0 t1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec0_t IS RECORD (a t1.a%TYPE);
TYPE cur0_t IS REF CURSOR RETURN rec0_t;
CURSOR c1 IS SELECT * FROM t1;
c0 cur0_t;
r0 c1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
################### table%ROWTYPE + XXX
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
c0 cur0_t;
v0 INT;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE rec1_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
c0 cur0_t;
r0 rec1_t;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT 10;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
c0 cur0_t;
r0 t1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
TYPE cur0_t IS REF CURSOR RETURN t1%ROWTYPE;
CURSOR c1 IS SELECT * FROM t1;
c0 cur0_t;
r0 c1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
################### cursor%ROWTYPE + XXX
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
v0 INT;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE rec1_t IS RECORD (a INT);
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
r0 rec1_t;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
v0 t1.a%TYPE;
BEGIN
OPEN c0 FOR SELECT 10;
FETCH c0 INTO v0;
CLOSE c0;
SELECT v0;
END;
$$
CALL p1;
v0
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
r0 t1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (10);
CREATE PROCEDURE p1 IS
CURSOR c1 IS SELECT * FROM t1;
TYPE cur0_t IS REF CURSOR RETURN c1%ROWTYPE;
c0 cur0_t;
r0 c1%ROWTYPE;
BEGIN
OPEN c0 FOR SELECT * FROM t1;
FETCH c0 INTO r0;
CLOSE c0;
SELECT r0.a;
END;
$$
CALL p1;
r0.a
10
DROP PROCEDURE p1;
DROP TABLE t1;
