set generate_embedding_openai_host="http://127.0.0.1:OPENAI_PORT/success";
create table expensive_test (idx int, doc text, model text, 
embedding vector(1536) as (generate_embedding_openai(doc, model)) stored, 
c int as (idx+1));
insert into expensive_test (idx, doc, model) values (1, "abc", "text-embedding-ada-002");
select idx, doc, model from expensive_test;
idx	doc	model
1	abc	text-embedding-ada-002
1
update expensive_test set idx = 2;
select idx, doc, model from expensive_test;
idx	doc	model
2	abc	text-embedding-ada-002
1
drop table expensive_test;
create table expensive_test (idx int, doc text, model text, 
embedding vector(1536) as (generate_embedding_openai(doc, model)) stored, 
c int as (idx+1) stored);
1
insert into expensive_test (idx, doc, model) values (1, "abc", "text-embedding-ada-002");
select idx, doc, model from expensive_test;
idx	doc	model
1	abc	text-embedding-ada-002
2
update expensive_test set idx = 2;
select idx, doc, model from expensive_test;
idx	doc	model
2	abc	text-embedding-ada-002
2
drop table expensive_test;
create table expensive_test (d text, doc text, 
embedding vector(1536) as (generate_embedding_openai(doc, "text-embedding-ada-002")) stored,
c text as (concat(doc, d)) stored);
2
insert into expensive_test (d, doc) values ("whatever", "abc");
select d, doc, c from expensive_test;
d	doc	c
whatever	abc	abcwhatever
3
update expensive_test set d = "whatever2";
select d, doc, c from expensive_test;
d	doc	c
whatever2	abc	abcwhatever2
3
drop table expensive_test;
