set generate_embedding_openai_host="http://127.0.0.1:OPENAI_PORT/success";
create table expensive_test (idx int, a text, b text, doc text as (concat(a,b)),
embedding vector(1536) as (generate_embedding_openai(doc, "text-embedding-ada-002")) stored);
insert into expensive_test (idx, a, b) values (1, "a", "bc");
select idx, a, b, doc from expensive_test;
idx	a	b	doc
1	a	bc	abc
1
update expensive_test set a = "a", b = "bc";
select idx, a, b, doc from expensive_test;
idx	a	b	doc
1	a	bc	abc
2
update expensive_test set a = "ab";
select idx, a, b, doc from expensive_test;
idx	a	b	doc
1	ab	bc	abbc
3
update expensive_test set idx = 2;
select idx, a, b, doc from expensive_test;
idx	a	b	doc
2	ab	bc	abbc
3
drop table expensive_test;
create table expensive_test (idx int, a text, b text, doc text as (concat(a,b)) stored,
embedding vector(1536) as (generate_embedding_openai(doc, "text-embedding-ada-002")) stored);
insert into expensive_test (idx, a, b) values (1, "a", "bc");
select idx, a, b, doc from expensive_test;
idx	a	b	doc
1	a	bc	abc
4
update expensive_test set a = "a", b = "bc";
select idx, a, b, doc from expensive_test;
idx	a	b	doc
1	a	bc	abc
5
update expensive_test set idx = 2;
select idx, a, b, doc from expensive_test;
idx	a	b	doc
2	a	bc	abc
6
drop table expensive_test;
