source include/have_gen_embedding.inc;

--replace_result $OPENAI_PORT OPENAI_PORT
eval set generate_embedding_openai_host="http://127.0.0.1:$OPENAI_PORT/success";
# set generate_embedding_openai_host="http://127.0.0.1:5000/success";

drop table if exists exp_test_new;
create table exp_test_new (
    doc text,
    embedding vector(1536) as (generate_embedding_openai(doc, "text-embedding-ada-002")) stored
) engine=MyISAM;

show status like "%generate%";
insert into exp_test_new (doc) values ("abc");
show status like "%generate%";

alter table exp_test_new add x int;
show status like "%generate%";
select doc, x, embedding is null from exp_test_new;

drop table exp_test_new;