#
# Basic CREATE functionality, defaults, metadata
#
CREATE TABLE t1 (a INET6 AUTO_INCREMENT);
ERROR 42000: Incorrect column specifier for column 'a'
CREATE TABLE t1 (a INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DESCRIBE t1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		NULL	
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE table_schema='test' AND table_name='t1';
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	a
ORDINAL_POSITION	1
COLUMN_DEFAULT	NULL
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1');
SELECT * FROM t1;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def	test	t1	t1	a	a	254 (type=inet6)	39	3	Y	160	0	8
a
::1
SELECT CAST('::' AS INET6) AS a;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def					a	254 (type=inet6)	39	2	N	33	0	8
a
::
DROP TABLE t1;
CREATE TABLE t1 (
c1 INET6 DEFAULT 0x00000000000000000000000000000000,
c2 INET6 DEFAULT 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF,
c3 INET6 DEFAULT '::',
c4 INET6 DEFAULT 'FFFF::ffff',
c5 INET6 DEFAULT CAST(X'FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' AS INET6)
);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c1` inet6 DEFAULT '::',
  `c2` inet6 DEFAULT 'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff',
  `c3` inet6 DEFAULT '::',
  `c4` inet6 DEFAULT 'ffff::ffff',
  `c5` inet6 DEFAULT cast(X'ffffffffffffffffffffffffffffffff' as inet6)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DESCRIBE t1;
Field	Type	Null	Key	Default	Extra
c1	inet6	YES		::	
c2	inet6	YES		ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff	
c3	inet6	YES		::	
c4	inet6	YES		ffff::ffff	
c5	inet6	YES		cast(X'ffffffffffffffffffffffffffffffff' as inet6)	
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE table_schema='test' AND table_name='t1';
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c1
ORDINAL_POSITION	1
COLUMN_DEFAULT	'::'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c2
ORDINAL_POSITION	2
COLUMN_DEFAULT	'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c3
ORDINAL_POSITION	3
COLUMN_DEFAULT	'::'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c4
ORDINAL_POSITION	4
COLUMN_DEFAULT	'ffff::ffff'
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
COLUMN_NAME	c5
ORDINAL_POSITION	5
COLUMN_DEFAULT	cast(X'ffffffffffffffffffffffffffffffff' as inet6)
IS_NULLABLE	YES
DATA_TYPE	inet6
CHARACTER_MAXIMUM_LENGTH	NULL
CHARACTER_OCTET_LENGTH	NULL
NUMERIC_PRECISION	NULL
NUMERIC_SCALE	NULL
DATETIME_PRECISION	NULL
CHARACTER_SET_NAME	NULL
COLLATION_NAME	NULL
COLUMN_TYPE	inet6
COLUMN_KEY	
EXTRA	
PRIVILEGES	#
COLUMN_COMMENT	
IS_GENERATED	NEVER
GENERATION_EXPRESSION	NULL
DROP TABLE t1;
CREATE TABLE t1 (c1 INET6 DEFAULT 0x00);
ERROR 42000: Invalid default value for 'c1'
CREATE TABLE t1 (c1 INET6 DEFAULT '');
ERROR 42000: Invalid default value for 'c1'
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('x');
ERROR 22007: Incorrect inet6 value: 'x' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (1);
ERROR 22007: Incorrect inet6 value: '1' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (TIME'10:20:30');
ERROR 22007: Incorrect inet6 value: '10:20:30' for column `test`.`t1`.`a` at row 1
INSERT INTO t1 VALUES (0x00);
ERROR 22007: Incorrect inet6 value: '\x00' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
#
# CAST
#
SELECT CAST('garbage' AS INET6);
CAST('garbage' AS INET6)
NULL
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT CAST(0x01 AS INET6);
CAST(0x01 AS INET6)
NULL
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
SELECT CAST(REPEAT(0x00,16) AS INET6);
CAST(REPEAT(0x00,16) AS INET6)
::
SELECT CAST(REPEAT(0x11,16) AS INET6);
CAST(REPEAT(0x11,16) AS INET6)
1111:1111:1111:1111:1111:1111:1111:1111
CREATE TABLE t1 AS SELECT CAST('::' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `CAST('::' AS INET6)` inet6 NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
#
# Text and binary formats, comparison operators
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xFFFF0000000000000000000000000001);
INSERT INTO t1 VALUES (0xFFFF0000000000000000000000000002);
SELECT * FROM t1 ORDER BY a;
a
::
::1
ffff::1
ffff::2
SELECT * FROM t1 ORDER BY a DESC;
a
ffff::2
ffff::1
::1
::
SELECT HEX(a),a FROM t1 ORDER BY a;
HEX(a)	a
00000000000000000000000000000000	::
00000000000000000000000000000001	::1
FFFF0000000000000000000000000001	ffff::1
FFFF0000000000000000000000000002	ffff::2
SELECT * FROM t1 WHERE a='::';
a
::
SELECT * FROM t1 WHERE a='::1';
a
::1
SELECT * FROM t1 WHERE a='ffff::1';
a
ffff::1
SELECT * FROM t1 WHERE a='ffff::2';
a
ffff::2
SELECT * FROM t1 WHERE a=0x00000000000000000000000000000000;
a
::
SELECT * FROM t1 WHERE a=0x00000000000000000000000000000001;
a
::1
SELECT * FROM t1 WHERE a=0xffff0000000000000000000000000001;
a
ffff::1
SELECT * FROM t1 WHERE a=0xffff0000000000000000000000000002;
a
ffff::2
SELECT * FROM t1 WHERE a<'::';
a
SELECT * FROM t1 WHERE a<='::';
a
::
SELECT * FROM t1 WHERE a>='ffff::2';
a
ffff::2
SELECT * FROM t1 WHERE a>'ffff::2';
a
SELECT * FROM t1 WHERE a IN ('::', 'ffff::1') ORDER BY a;
a
::
ffff::1
SELECT * FROM t1 WHERE a IN ('::', 0xffff0000000000000000000000000002) ORDER BY a;
a
::
ffff::2
SELECT * FROM t1 WHERE a<'garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT * FROM t1 WHERE a<='garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT * FROM t1 WHERE a='garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT * FROM t1 WHERE a>='garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT * FROM t1 WHERE a>'garbage';
a
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT * FROM t1 WHERE a<0x01;
a
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
SELECT * FROM t1 WHERE a<=0x01;
a
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
SELECT * FROM t1 WHERE a=0x01;
a
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
Warning	1292	Incorrect inet6 value: '\x01'
SELECT * FROM t1 WHERE a>=0x01;
a
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
SELECT * FROM t1 WHERE a>0x01;
a
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
SELECT * FROM t1 WHERE a='0::0';
a
::
SELECT * FROM t1 WHERE a='0::00';
a
::
SELECT * FROM t1 WHERE a='0::000';
a
::
SELECT * FROM t1 WHERE a='0::0000';
a
::
SELECT * FROM t1 WHERE a=0;
ERROR HY000: Illegal parameter data types inet6 and int for operation '='
SELECT * FROM t1 WHERE a=0.0;
ERROR HY000: Illegal parameter data types inet6 and decimal for operation '='
SELECT * FROM t1 WHERE a=0e0;
ERROR HY000: Illegal parameter data types inet6 and double for operation '='
SELECT * FROM t1 WHERE a=TIME'10:20:30';
ERROR HY000: Illegal parameter data types inet6 and time for operation '='
SELECT * FROM t1 WHERE a IN ('::', 10);
ERROR HY000: Illegal parameter data types inet6 and int for operation 'in'
DROP TABLE t1;
#
# cmp_item_inet6: IN for non-constants
#
CREATE TABLE t1 (a INET6, b INET6);
INSERT INTO t1 VALUES ('::1', '::2');
SELECT * FROM t1 WHERE '::' IN (a, b);
a	b
SELECT * FROM t1 WHERE '::1' IN (a, b);
a	b
::1	::2
SELECT * FROM t1 WHERE '::01' IN (a, b);
a	b
::1	::2
SELECT * FROM t1 WHERE '00::01' IN (a, b);
a	b
::1	::2
DROP TABLE t1;
#
# cmp_item_inet6: DECODE_ORACLE
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (NULL),('::01'),('::02');
SELECT a, DECODE_ORACLE(a, '::01', '01') AS d FROM t1;
a	d
NULL	NULL
::1	01
::2	NULL
SELECT
a,
DECODE_ORACLE(a, '::01', '01') AS d0,
DECODE_ORACLE(a, NULL, '<NULL>', '::01', '01') AS d1,
DECODE_ORACLE(a, 'garbage', '<NULL>', '::01', '01') AS d2
FROM t1;
a	d0	d1	d2
NULL	NULL	<NULL>	<NULL>
::1	01	01	01
::2	NULL	NULL	NULL
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage'
DROP TABLE t1;
#
# CASE abbreviations
#
CREATE TABLE t1 (
c INET6,
c_char CHAR(32),
c_varchar VARCHAR(32),
c_tinytext TINYTEXT,
c_text TEXT,
c_mediumtext TEXT,
c_longtext LONGTEXT
);
CREATE TABLE t2 AS SELECT
COALESCE(c, c_char),
COALESCE(c, c_varchar),
COALESCE(c, c_tinytext),
COALESCE(c, c_text),
COALESCE(c, c_mediumtext),
COALESCE(c, c_longtext)
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(c, c_char)` inet6 DEFAULT NULL,
  `COALESCE(c, c_varchar)` inet6 DEFAULT NULL,
  `COALESCE(c, c_tinytext)` inet6 DEFAULT NULL,
  `COALESCE(c, c_text)` inet6 DEFAULT NULL,
  `COALESCE(c, c_mediumtext)` inet6 DEFAULT NULL,
  `COALESCE(c, c_longtext)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
LEAST(c, c_char),
LEAST(c, c_varchar),
LEAST(c, c_tinytext),
LEAST(c, c_text),
LEAST(c, c_mediumtext),
LEAST(c, c_longtext)
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `LEAST(c, c_char)` inet6 DEFAULT NULL,
  `LEAST(c, c_varchar)` inet6 DEFAULT NULL,
  `LEAST(c, c_tinytext)` inet6 DEFAULT NULL,
  `LEAST(c, c_text)` inet6 DEFAULT NULL,
  `LEAST(c, c_mediumtext)` inet6 DEFAULT NULL,
  `LEAST(c, c_longtext)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (NULL),('::1'),('::2');
SELECT COALESCE(a, '::') FROM t1 ORDER BY a;
COALESCE(a, '::')
::
::1
::2
SELECT a, LEAST(a,'::0'), LEAST(a,'::f') FROM t1 ORDER BY a;
a	LEAST(a,'::0')	LEAST(a,'::f')
NULL	NULL	NULL
::1	::	::1
::2	::	::2
SELECT a, GREATEST(a,'::0'), GREATEST(a,'::f') FROM t1 ORDER BY a;
a	GREATEST(a,'::0')	GREATEST(a,'::f')
NULL	NULL	NULL
::1	::1	::f
::2	::2	::f
CREATE TABLE t2 AS SELECT
COALESCE(a, '::'),
LEAST(a,'::'),
GREATEST(a,'::')
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(a, '::')` inet6 DEFAULT NULL,
  `LEAST(a,'::')` inet6 DEFAULT NULL,
  `GREATEST(a,'::')` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT COALESCE(a, 0x00000000000000000000000000000000) FROM t1 ORDER BY a;
COALESCE(a, 0x00000000000000000000000000000000)
::
::1
::2
SELECT a,
LEAST(a, 0x00000000000000000000000000000000),
LEAST(a, 0x0000000000000000000000000000000f)
FROM t1 ORDER BY a;
a	LEAST(a, 0x00000000000000000000000000000000)	LEAST(a, 0x0000000000000000000000000000000f)
NULL	NULL	NULL
::1	::	::1
::2	::	::2
SELECT a,
GREATEST(a, 0x00000000000000000000000000000000),
GREATEST(a, 0x0000000000000000000000000000000f)
FROM t1 ORDER BY a;
a	GREATEST(a, 0x00000000000000000000000000000000)	GREATEST(a, 0x0000000000000000000000000000000f)
NULL	NULL	NULL
::1	::1	::f
::2	::2	::f
CREATE TABLE t2 AS SELECT
COALESCE(a, 0x00000000000000000000000000000000),
LEAST(a,0x00000000000000000000000000000000),
GREATEST(a,0x00000000000000000000000000000000)
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(a, 0x00000000000000000000000000000000)` inet6 DEFAULT NULL,
  `LEAST(a,0x00000000000000000000000000000000)` inet6 DEFAULT NULL,
  `GREATEST(a,0x00000000000000000000000000000000)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT COALESCE(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'coalesce'
SELECT LEAST(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'least'
SELECT GREATEST(a, 10) FROM t1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'greatest'
DROP TABLE t1;
SELECT COALESCE('garbage', CAST('::1' AS INET6));
COALESCE('garbage', CAST('::1' AS INET6))
::1
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT COALESCE(0x01, CAST('::1' AS INET6));
COALESCE(0x01, CAST('::1' AS INET6))
::1
Warnings:
Warning	1292	Incorrect inet6 value: '\x01'
#
# Uniqueness
#
CREATE TABLE t1 (a INET6 NOT NULL PRIMARY KEY);
INSERT INTO t1 VALUES ('41::1'),('61::1');
INSERT INTO t1 VALUES ('41::1');
ERROR 23000: Duplicate entry '41::1' for key 'PRIMARY'
SELECT * FROM t1;
a
41::1
61::1
DROP TABLE t1;
#
# Indexes
#
CREATE TABLE t1 (a INET6, KEY(a(1)));
ERROR HY000: Incorrect prefix key; the used key part isn't a string, the used length is longer than the key part, or the storage engine doesn't support unique prefix keys
#
# Explicit CAST on INSERT
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES (CAST('1::1' AS INET6));
INSERT INTO t1 VALUES (CAST('1::2' AS INET6));
INSERT INTO t1 VALUES (CAST('1::3' AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::1') AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::2') AS INET6));
INSERT INTO t1 VALUES (CAST(CONCAT('2','::3') AS INET6));
SELECT * FROM t1 ORDER BY a;
a
1::1
1::2
1::3
2::1
2::2
2::3
DROP TABLE t1;
#
# Explicit CAST and implicit CAST on ALTER
#
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES ('garbage'),('::'),('::1'),('ffff::1'),('ffff::2');
SELECT a, CAST(a AS INET6) FROM t1 ORDER BY a;
a	CAST(a AS INET6)
::	::
::1	::1
ffff::1	ffff::1
ffff::2	ffff::2
garbage	NULL
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
SELECT a, CAST(a AS INET6) FROM t1 ORDER BY CAST(a AS INET6);
a	CAST(a AS INET6)
garbage	NULL
::	::
::1	::1
ffff::1	ffff::1
ffff::2	ffff::2
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage'
Warning	1292	Incorrect inet6 value: 'garbage'
ALTER TABLE t1 MODIFY a INET6;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SET sql_mode='';
ALTER TABLE t1 MODIFY a INET6;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t1`.`a` at row 1
SET sql_mode=DEFAULT;
SELECT * FROM t1 ORDER BY a;
a
NULL
::
::1
ffff::1
ffff::2
DROP TABLE t1;
CREATE TABLE t1 (a BINARY(16));
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000002);
SELECT HEX(a), CAST(a AS INET6) FROM t1 ORDER BY a;
HEX(a)	CAST(a AS INET6)
00000000000000000000000000000000	::
00000000000000000000000000000001	::1
FFFF0000000000000000000000000001	ffff::1
FFFF0000000000000000000000000002	ffff::2
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1 ORDER BY a;
a
::
::1
ffff::1
ffff::2
DROP TABLE t1;
#
# INSERT..SELECT, same data types
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
SELECT * FROM t2;
a
::
::1
::2
DROP TABLE t1,t2;
#
# Implicit CAST on INSERT..SELECT, text format
#
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES ('garbage'),('::'),('::1'),('ffff::1'),('ffff::2');
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SET sql_mode='';
INSERT INTO t2 SELECT a FROM t1;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SELECT * FROM t2 ORDER BY a;
a
NULL
::
::1
ffff::1
ffff::2
SET sql_mode=DEFAULT;
DROP TABLE t2;
CREATE TABLE t2 (a INET6 NOT NULL);
INSERT INTO t2 SELECT a FROM t1;
ERROR 22007: Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SET sql_mode='';
INSERT INTO t2 SELECT a FROM t1;
Warnings:
Warning	1292	Incorrect inet6 value: 'garbage' for column `test`.`t2`.`a` at row 1
SELECT * FROM t2 ORDER BY a;
a
::
::
::1
ffff::1
ffff::2
SET sql_mode=DEFAULT;
DROP TABLE t2;
DROP TABLE t1;
#
# Implicit CAST on INSERT..SELECT, binary format
#
CREATE TABLE t1 (a BINARY(16));
INSERT INTO t1 VALUES (0x00000000000000000000000000000000);
INSERT INTO t1 VALUES (0x00000000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000001);
INSERT INTO t1 VALUES (0xffff0000000000000000000000000002);
CREATE TABLE t2 (a INET6);
INSERT INTO t2 SELECT a FROM t1;
SELECT a FROM t2 ORDER BY a;
a
::
::1
ffff::1
ffff::2
DROP TABLE t1,t2;
#
# CAST to other data types
#
SELECT CAST(CAST('::' AS INET6) AS DOUBLE);
ERROR HY000: Illegal parameter data type inet6 for operation 'double_typecast'
SELECT CAST(CAST('::' AS INET6) AS FLOAT);
ERROR HY000: Illegal parameter data type inet6 for operation 'float_typecast'
SELECT CAST(CAST('::' AS INET6) AS DECIMAL);
ERROR HY000: Illegal parameter data type inet6 for operation 'decimal_typecast'
SELECT CAST(CAST('::' AS INET6) AS SIGNED);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_signed'
SELECT CAST(CAST('::' AS INET6) AS UNSIGNED);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_unsigned'
SELECT CAST(CAST('::' AS INET6) AS TIME);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_time'
SELECT CAST(CAST('::' AS INET6) AS DATE);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_date'
SELECT CAST(CAST('::' AS INET6) AS DATETIME);
ERROR HY000: Illegal parameter data type inet6 for operation 'cast_as_datetime'
SELECT CAST(CAST('::' AS INET6) AS CHAR);
CAST(CAST('::' AS INET6) AS CHAR)
::
CREATE TABLE t1 AS SELECT CAST(CAST('::' AS INET6) AS CHAR) AS a;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` varchar(39) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('ffff::ffff');
CREATE TABLE t2 AS SELECT
CAST(a AS CHAR),
CAST(a AS CHAR(39)),
CAST(a AS CHAR(530)),
CAST(a AS CHAR(65535)),
CAST(a AS CHAR(66000)),
CAST(a AS CHAR(16777215)),
CAST(a AS CHAR(16777216))
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `CAST(a AS CHAR)` varchar(39) DEFAULT NULL,
  `CAST(a AS CHAR(39))` varchar(39) DEFAULT NULL,
  `CAST(a AS CHAR(530))` text DEFAULT NULL,
  `CAST(a AS CHAR(65535))` text DEFAULT NULL,
  `CAST(a AS CHAR(66000))` mediumtext DEFAULT NULL,
  `CAST(a AS CHAR(16777215))` mediumtext DEFAULT NULL,
  `CAST(a AS CHAR(16777216))` longtext DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
SELECT * FROM t2;
CAST(a AS CHAR)	ffff::ffff
CAST(a AS CHAR(39))	ffff::ffff
CAST(a AS CHAR(530))	ffff::ffff
CAST(a AS CHAR(65535))	ffff::ffff
CAST(a AS CHAR(66000))	ffff::ffff
CAST(a AS CHAR(16777215))	ffff::ffff
CAST(a AS CHAR(16777216))	ffff::ffff
DROP TABLE t2;
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('ffff::ffff');
CREATE TABLE t2 AS SELECT
CAST(a AS BINARY(4)) AS cb4,
CAST(a AS BINARY) AS cb,
CAST(a AS BINARY(16)) AS cb16,
CAST(a AS BINARY(32)) AS cb32,
CAST(a AS BINARY(530)) AS cb530,
CAST(a AS BINARY(65535)) AS cb65535,
CAST(a AS BINARY(66000)) AS cb66000,
CAST(a AS BINARY(16777215)) AS cb16777215,
CAST(a AS BINARY(16777216)) AS cb16777216
FROM t1 LIMIT 0;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `cb4` binary(4) DEFAULT NULL,
  `cb` binary(16) DEFAULT NULL,
  `cb16` binary(16) DEFAULT NULL,
  `cb32` binary(32) DEFAULT NULL,
  `cb530` varbinary(530) DEFAULT NULL,
  `cb65535` blob DEFAULT NULL,
  `cb66000` mediumblob DEFAULT NULL,
  `cb16777215` mediumblob DEFAULT NULL,
  `cb16777216` longblob DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
CAST(a AS BINARY(4)) AS cb4,
CAST(a AS BINARY) AS cb,
CAST(a AS BINARY(16)) AS cb16,
CAST(a AS BINARY(32)) AS cb32,
CAST(a AS BINARY(530)) AS cb530,
CAST(a AS BINARY(65535)) AS cb65535
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `cb4` binary(4) DEFAULT NULL,
  `cb` binary(16) DEFAULT NULL,
  `cb16` binary(16) DEFAULT NULL,
  `cb32` binary(32) DEFAULT NULL,
  `cb530` varbinary(530) DEFAULT NULL,
  `cb65535` blob DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
SELECT
HEX(cb4),
HEX(cb),
HEX(cb16),
HEX(cb32),
LENGTH(cb530),
LENGTH(cb65535)
FROM t2;
HEX(cb4)	FFFF0000
HEX(cb)	FFFF000000000000000000000000FFFF
HEX(cb16)	FFFF000000000000000000000000FFFF
HEX(cb32)	FFFF000000000000000000000000FFFF00000000000000000000000000000000
LENGTH(cb530)	530
LENGTH(cb65535)	65535
DROP TABLE t2;
DROP TABLE t1;
#
# Implicit conversion to other types in INSERT
#
CREATE TABLE t1 (a INT);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect integer value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a DOUBLE);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect double value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a DECIMAL(32,0));
INSERT INTO t1 VALUES (CAST('::' AS INET6));
ERROR 22007: Incorrect decimal value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES (CAST('::' AS INET6));
DROP TABLE t1;
CREATE TABLE t1 (a TEXT);
INSERT INTO t1 VALUES (CAST('::' AS INET6));
DROP TABLE t1;
#
# Boolean context
#
SELECT
CAST('::' AS INET6) IS TRUE, 
CAST('::' AS INET6) IS FALSE,
CAST('::1' AS INET6) IS TRUE,
CAST('::1' AS INET6) IS FALSE;
CAST('::' AS INET6) IS TRUE	CAST('::' AS INET6) IS FALSE	CAST('::1' AS INET6) IS TRUE	CAST('::1' AS INET6) IS FALSE
0	1	1	0
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1');
SELECT a, a IS TRUE, a IS FALSE FROM t1 ORDER BY a;
a	a IS TRUE	a IS FALSE
::	0	1
::1	1	0
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1 WHERE a;
ERROR HY000: Illegal parameter data types inet6 and bigint for operation '<>'
DROP TABLE t1;
#
# GROUP BY
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::');
INSERT INTO t1 VALUES ('::1'),('::01'),('::0001');
INSERT INTO t1 VALUES ('::2'),('::2'),('::2'),('::2');
SELECT a, COUNT(*) FROM t1 GROUP BY a;
a	COUNT(*)
::	2
::1	3
::2	4
DROP TABLE t1;
#
# Aggregate functions
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::');
INSERT INTO t1 VALUES ('::1'),('::01'),('::0001');
INSERT INTO t1 VALUES ('::2'),('::2'),('::2'),('::2');
SELECT MIN(a),MAX(a) FROM t1;
MIN(a)	MAX(a)
::	::2
CREATE TABLE t2 AS SELECT MIN(a), MAX(a) FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `MIN(a)` inet6 DEFAULT NULL,
  `MAX(a)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
SELECT AVG(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'avg('
SELECT AVG(DISTINCT a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'avg(distinct '
SELECT SUM(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'sum('
SELECT SUM(DISTINCT a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'sum(distinct '
SELECT STDDEV(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'std('
SELECT GROUP_CONCAT(a ORDER BY a) FROM t1;
GROUP_CONCAT(a ORDER BY a)
::,::,::1,::1,::1,::2,::2,::2,::2
SELECT a, GROUP_CONCAT(a ORDER BY a) FROM t1 GROUP BY a;
a	GROUP_CONCAT(a ORDER BY a)
::	::,::
::1	::1,::1,::1
::2	::2,::2,::2,::2
DROP TABLE t1;
#
# MDEV-21765 Possibly inconsistent behavior of BIT_xx functions with INET6 field
#
CREATE TABLE t1 (a INET6);
SELECT BIT_AND(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'bit_and('
SELECT BIT_OR(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'bit_or('
SELECT BIT_XOR(a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'bit_xor('
DROP TABLE t1;
#
# Window functions
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1'),('::2'),('::3'),('::4');
SELECT
a,
LAG(a) OVER (ORDER BY a),
LEAD(a) OVER (ORDER BY a)
FROM t1 ORDER BY a;
a	LAG(a) OVER (ORDER BY a)	LEAD(a) OVER (ORDER BY a)
::1	NULL	::2
::2	::1	::3
::3	::2	::4
::4	::3	NULL
SELECT
a,
FIRST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING),
LAST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
FROM t1 ORDER BY a;
a	FIRST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)	LAST_VALUE(a) OVER (ORDER BY a ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)
::1	::1	::2
::2	::1	::3
::3	::2	::4
::4	::3	::4
DROP TABLE t1;
#
# Prepared statements
#
EXECUTE IMMEDIATE 'CREATE TABLE t1 AS SELECT ? AS a' USING CAST('::' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` inet6 NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING '::1';
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING CAST('::2' AS INET6);
EXECUTE IMMEDIATE 'INSERT INTO t1 VALUES (?)' USING 0x00000000000000000000000000000003;
SELECT a FROM t1 ORDER BY a;
a
::
::1
::2
::3
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING '::1';
a
::1
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING CAST('::2' AS INET6);
a
::2
EXECUTE IMMEDIATE 'SELECT * FROM t1 WHERE a=?' USING 0x00000000000000000000000000000003;
a
::3
DROP TABLE t1;
#
# Character set and collation aggregation
#
CREATE TABLE t1 (a INET6);
CREATE TABLE t2 AS SELECT
CONCAT(a) AS c1,
CONCAT(CAST('::' AS INET6)) AS c2
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(39) DEFAULT NULL,
  `c2` varchar(39) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
CONCAT(_utf8'1', a) AS c1,
CONCAT(_utf8'1', CAST('::1' AS INET6)) AS c2,
CONCAT(_utf8'1', COALESCE(a)) AS c3
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(40) CHARACTER SET utf8 DEFAULT NULL,
  `c2` varchar(40) CHARACTER SET utf8 DEFAULT NULL,
  `c3` varchar(40) CHARACTER SET utf8 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT
CONCAT(_latin1'1', a) AS c1,
CONCAT(_latin1'1', CAST('::1' AS INET6)) AS c2,
CONCAT(_latin1'1', COALESCE(a)) AS c3
FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `c1` varchar(40) DEFAULT NULL,
  `c2` varchar(40) DEFAULT NULL,
  `c3` varchar(40) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
DROP TABLE t1;
#
# UNION
#
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT CAST('::1' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT '::1';
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT '::' AS c UNION SELECT CAST('::1' AS INET6);
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `c` inet6 NOT NULL DEFAULT '::'
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT 0x00000000000000000000000000000001;
SELECT * FROM t1;
c
::
::1
DROP TABLE t1;
CREATE TABLE t1 AS SELECT CAST('::' AS INET6) AS c UNION SELECT 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'UNION'
#
# Unary operators
#
SELECT -CAST('::' AS INET6);
ERROR HY000: Illegal parameter data type inet6 for operation '-'
SELECT ABS(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'abs'
SELECT ROUND(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'round'
SELECT CEILING(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'ceiling'
SELECT FLOOR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'floor'
#
# Arithmetic operators
#
SELECT CAST('::' AS INET6) + 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '+'
SELECT CAST('::' AS INET6) - 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '-'
SELECT CAST('::' AS INET6) * 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '*'
SELECT CAST('::' AS INET6) / 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation '/'
SELECT CAST('::' AS INET6) MOD 1;
ERROR HY000: Illegal parameter data types inet6 and int for operation 'MOD'
#
# Misc
#
SELECT RAND(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'rand'
SELECT FROM_UNIXTIME(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'from_unixtime'
SELECT HOUR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'hour'
SELECT YEAR(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'year'
SELECT RELEASE_LOCK(CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'release_lock'
SELECT JSON_LENGTH(CAST('::' AS INET6));
JSON_LENGTH(CAST('::' AS INET6))
NULL
Warnings:
Warning	4038	Syntax error in JSON text in argument 1 to function 'json_length' at position 1
#
# Virtual columns
#
CREATE TABLE t1 (
a INT,
b INET6 GENERATED ALWAYS AS (CAST(CONCAT(RAND(),a) AS INET6)), INDEX(b)
);
ERROR HY000: Function or expression 'rand()' cannot be used in the GENERATED ALWAYS AS clause of `b`
CREATE TABLE t1 (
a INT,
b INET6 GENERATED ALWAYS AS (CAST(CONCAT('::',HEX(a)) AS INET6)), INDEX(b)
);
INSERT INTO t1 (a) VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15);
SELECT * FROM t1;
a	b
0	::
1	::1
2	::2
3	::3
4	::4
5	::5
6	::6
7	::7
8	::8
9	::9
10	::a
11	::b
12	::c
13	::d
14	::e
15	::f
DROP TABLE t1;
#
# VIEW
#
CREATE TABLE t1 (a INT DEFAULT 0);
INSERT INTO t1 (a) VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15);
SELECT * FROM t1 ORDER BY a;
a
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
CREATE VIEW v1 AS SELECT (CAST(CONCAT('::',HEX(a)) AS INET6)) AS c FROM t1;
SELECT * FROM v1 ORDER BY c;
c
::
::1
::2
::3
::4
::5
::6
::7
::8
::9
::a
::b
::c
::d
::e
::f
DROP VIEW v1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6 DEFAULT '::');
CREATE VIEW v1 AS SELECT * FROM t1;
SHOW CREATE VIEW v1;
View	Create View	character_set_client	collation_connection
v1	CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v1` AS select `t1`.`a` AS `a` from `t1`	latin1	latin1_swedish_ci
DESCRIBE v1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		::	
INSERT INTO v1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1;
a
::
::1
::2
DROP VIEW v1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6 DEFAULT CAST('::' AS INET6));
CREATE VIEW v1 AS SELECT * FROM t1;
SHOW CREATE VIEW v1;
View	Create View	character_set_client	collation_connection
v1	CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v1` AS select `t1`.`a` AS `a` from `t1`	latin1	latin1_swedish_ci
DESCRIBE v1;
Field	Type	Null	Key	Default	Extra
a	inet6	YES		cast('::' as inet6)	
INSERT INTO v1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1;
a
::
::1
::2
DROP VIEW v1;
DROP TABLE t1;
#
# Subqueries
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::'),('::1'),('::2');
SELECT * FROM t1 WHERE a=(SELECT MIN(a) FROM t1) ORDER BY a;
a
::
SELECT * FROM t1 WHERE a=(SELECT MAX(a) FROM t1) ORDER BY a;
a
::2
SELECT * FROM t1 WHERE a IN (SELECT a FROM t1 WHERE a>'::') ORDER BY a;
a
::1
::2
DROP TABLE t1;
#
# Stored routines
#
CREATE PROCEDURE p1(a INET6)
BEGIN
DECLARE b INET6 DEFAULT CONCAT('1', a);
SELECT a, b;
END;
$$
CALL p1('::1');
a	b
::1	1::1
CALL p1(CAST('::2' AS INET6));
a	b
::2	1::2
DROP PROCEDURE p1;
CREATE FUNCTION f1(a INET6) RETURNS INET6
BEGIN
RETURN CONCAT('1',a);
END;
$$
SELECT f1('::1');
f1('::1')
1::1
SELECT f1(CAST('::1' AS INET6));
f1(CAST('::1' AS INET6))
1::1
DROP FUNCTION f1;
#
# Anchored data types in SP variables
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::1');
CREATE PROCEDURE p1()
BEGIN
DECLARE va TYPE OF t1.a;
SELECT MAX(a) INTO va FROM t1;
SELECT va;
END;
$$
CALL p1;
va
::1
DROP PROCEDURE p1;
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b INET6);
INSERT INTO t1 VALUES ('::a', '::b');
CREATE PROCEDURE p1()
BEGIN
DECLARE va ROW TYPE OF t1;
SELECT MAX(a), MAX(b) INTO va FROM t1;
SELECT va.a, va.b;
END;
$$
CALL p1;
va.a	va.b
::a	::b
DROP PROCEDURE p1;
DROP TABLE t1;
#
# Optimizer: make_const_item_for_comparison
#
CREATE TABLE t1 (id INT, a INET6);
INSERT INTO t1 VALUES (1,'::1'),(2,'::2');
EXPLAIN EXTENDED SELECT * FROM t1 WHERE a=COALESCE(CAST('::1' AS INET6)) AND id>0;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	2	100.00	Using where
Warnings:
Note	1003	select `test`.`t1`.`id` AS `id`,`test`.`t1`.`a` AS `a` from `test`.`t1` where `test`.`t1`.`a` = INET6'::1' and `test`.`t1`.`id` > 0
DROP TABLE t1;
#
# Optimizer: equal field propagation
#
CREATE TABLE t1 (id INT, a INET6);
INSERT INTO t1 VALUES (1,'::1'),(2,'::2');
EXPLAIN EXTENDED SELECT * FROM t1
WHERE a=COALESCE(CAST('::1' AS INET6))
AND LENGTH(CONCAT(a,RAND()))>1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	2	100.00	Using where
Warnings:
Note	1003	select `test`.`t1`.`id` AS `id`,`test`.`t1`.`a` AS `a` from `test`.`t1` where `test`.`t1`.`a` = INET6'::1' and octet_length(concat(INET6'::1',rand())) > 1
EXPLAIN EXTENDED SELECT * FROM t1
WHERE a=COALESCE(CAST('::1' AS INET6))
AND LENGTH(a)>1;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	2	100.00	Using where
Warnings:
Note	1003	select `test`.`t1`.`id` AS `id`,`test`.`t1`.`a` AS `a` from `test`.`t1` where `test`.`t1`.`a` = INET6'::1'
DROP TABLE t1;
#
# Optimizer: equal expression propagation
#
CREATE TABLE t1 (id INT, a INET6);
INSERT INTO t1 VALUES (1,'::1'),(2,'::2');
EXPLAIN EXTENDED SELECT * FROM t1
WHERE COALESCE(a)='::1' AND COALESCE(a)=CONCAT(a);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	2	100.00	Using where
Warnings:
Note	1003	select `test`.`t1`.`id` AS `id`,`test`.`t1`.`a` AS `a` from `test`.`t1` where coalesce(`test`.`t1`.`a`) = '::1' and concat(`test`.`t1`.`a`) = '::1'
DROP TABLE t1;
#
# Subquery materialization
#
CREATE TABLE t1 (a INET6, b VARCHAR(32), KEY (a), KEY(b)) ;
INSERT INTO t1 VALUES ('::a','::a'),('::a','::b');
SET @@optimizer_switch='semijoin=off,materialization=on,in_to_exists=off,subquery_cache=off';
EXPLAIN SELECT * FROM t1 WHERE a IN (SELECT a AS a_inner FROM t1 GROUP BY a_inner);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	2	Using where
2	MATERIALIZED	t1	index	NULL	a	17	NULL	2	Using index
EXPLAIN SELECT * FROM t1 WHERE b IN (SELECT a AS a_inner FROM t1 GROUP BY a_inner);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	2	Using where
2	DEPENDENT SUBQUERY	t1	index_subquery	a	a	17	func	2	Using index; Using where
SET @@optimizer_switch=DEFAULT;
DROP TABLE t1;
#
# IS_IPV4_MAPPED(), IS_IPV4_COMPAT() now understand text notation
#
CREATE TABLE t1 (id SERIAL, a VARCHAR(32));
INSERT INTO t1 (a) VALUES ('::192.168.0.1'),('::192.168.10.111'),('::ffff:10.10.0.1'),('::ffff:192.168.0.1');
# This is a text notation
SELECT id, length(a), a, IS_IPV4_MAPPED(a) FROM t1 ORDER BY id;
id	length(a)	a	IS_IPV4_MAPPED(a)
1	13	::192.168.0.1	0
2	16	::192.168.10.111	0
3	16	::ffff:10.10.0.1	1
4	18	::ffff:192.168.0.1	1
SELECT id, length(a), a, IS_IPV4_COMPAT(a) FROM t1 ORDER BY id;
id	length(a)	a	IS_IPV4_COMPAT(a)
1	13	::192.168.0.1	1
2	16	::192.168.10.111	1
3	16	::ffff:10.10.0.1	0
4	18	::ffff:192.168.0.1	0
# This is not a text notation: it is a binary input only looking like text notation
SELECT id, length(a), a, IS_IPV4_MAPPED(BINARY a) FROM t1 ORDER BY id;
id	length(a)	a	IS_IPV4_MAPPED(BINARY a)
1	13	::192.168.0.1	0
2	16	::192.168.10.111	0
3	16	::ffff:10.10.0.1	0
4	18	::ffff:192.168.0.1	0
Warnings:
Warning	1292	Incorrect inet6 value: '::192.168.0.1'
Warning	1292	Incorrect inet6 value: '::ffff:192.168.0.1'
SELECT id, length(a), a, IS_IPV4_COMPAT(BINARY a) FROM t1 ORDER BY id;
id	length(a)	a	IS_IPV4_COMPAT(BINARY a)
1	13	::192.168.0.1	0
2	16	::192.168.10.111	0
3	16	::ffff:10.10.0.1	0
4	18	::ffff:192.168.0.1	0
Warnings:
Warning	1292	Incorrect inet6 value: '::192.168.0.1'
Warning	1292	Incorrect inet6 value: '::ffff:192.168.0.1'
DROP TABLE t1;
#
# ALTER from INET6 to INET6
#
CREATE TABLE t1 (a INET6, b INT);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329', 1);
ALTER TABLE t1 MODIFY b DECIMAL(10,2);
SELECT * FROM t1;
a	b
2001:db8::ff00:42:8329	1.00
DROP TABLE t1;
#
# ALTER to character string data types
#
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS CHAR(39)) FROM t1;
CAST(a AS CHAR(39))
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a CHAR(39);
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a VARCHAR(39);
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a TINYTEXT;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a TEXT;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a MEDIUMTEXT;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a LONGTEXT;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
#
# ALTER from character string data types
#
CREATE OR REPLACE TABLE t1 (a CHAR(64));
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a VARCHAR(64));
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a TINYTEXT);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a TEXT);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a MEDIUMTEXT);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a LONGTEXT);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS INET6) FROM t1;
CAST(a AS INET6)
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a INET6;
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
#
# ALTER to binary string data types
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a BINARY(16);
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a BINARY(17);
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF000042832900
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a BINARY(15);
ERROR 22001: Data too long for column 'a' at row 1
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a TINYBLOB;
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a BLOB;
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a MEDIUMBLOB;
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a LONGBLOB;
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
#
# ALTER from binary string data types
#
CREATE TABLE t1 (a BINARY(16));
INSERT INTO t1 VALUES (X'20010DB8000000000000FF0000428329');
ALTER TABLE t1 MODIFY a INET6;
SELECT a FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE TABLE t1 (a BINARY(17));
INSERT INTO t1 VALUES (X'20010DB8000000000000FF000042832900');
ALTER TABLE t1 MODIFY a INET6;
ERROR 22007: Incorrect inet6 value: ' \x01\x0D\xB8\x00\x00\x00\x00\x00\x00\xFF\x00\x00B\x83)\x00' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a BINARY(15));
INSERT INTO t1 VALUES (X'20010DB8000000000000FF00004283');
ALTER TABLE t1 MODIFY a INET6;
ERROR 22007: Incorrect inet6 value: ' \x01\x0D\xB8\x00\x00\x00\x00\x00\x00\xFF\x00\x00B\x83' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
CREATE TABLE t1 (a TINYBLOB);
INSERT INTO t1 VALUES (X'20010DB8000000000000FF0000428329');
ALTER TABLE t1 MODIFY a INET6;
SELECT a FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE TABLE t1 (a BLOB);
INSERT INTO t1 VALUES (X'20010DB8000000000000FF0000428329');
ALTER TABLE t1 MODIFY a INET6;
SELECT a FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE TABLE t1 (a MEDIUMBLOB);
INSERT INTO t1 VALUES (X'20010DB8000000000000FF0000428329');
ALTER TABLE t1 MODIFY a INET6;
SELECT a FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
CREATE TABLE t1 (a BLOB);
INSERT INTO t1 VALUES (X'20010DB8000000000000FF0000428329');
ALTER TABLE t1 MODIFY a INET6;
SELECT a FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
#
# SET from INET6 to INET6
#
CREATE TABLE t1 (a INET6, b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
#
# SET from INET6 to numeric
#
CREATE TABLE t1 (a INET6, b INT);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect integer value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b DOUBLE);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect double value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b DECIMAL(32,0));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect decimal value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b YEAR);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect integer value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
#
# SET from numeric to INET6
#
CREATE TABLE t1 (a INT, b INET6);
INSERT INTO t1 VALUES (1, NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '1' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a DOUBLE, b INET6);
INSERT INTO t1 VALUES (1, NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '1' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a DECIMAL(32,0), b INET6);
INSERT INTO t1 VALUES (1, NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '1' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a YEAR, b INET6);
INSERT INTO t1 VALUES (1, NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '2001' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
#
# SET from INET6 to temporal
#
CREATE TABLE t1 (a INET6, b TIME);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect time value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b DATE);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect date value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b DATETIME);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect datetime value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b TIMESTAMP NULL DEFAULT NULL);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect datetime value: 'ffff::ffff' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
#
# SET from temporal to INET6
#
CREATE TABLE t1 (a TIME, b INET6);
INSERT INTO t1 VALUES ('00:00:00', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '00:00:00' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a DATE, b INET6);
INSERT INTO t1 VALUES ('2001-01:01', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '2001-01-01' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a DATETIME, b INET6);
INSERT INTO t1 VALUES ('2001-01-01 10:20:30', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '2001-01-01 10:20:30' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
CREATE TABLE t1 (a TIMESTAMP, b INET6);
INSERT INTO t1 VALUES ('2001-01-01 10:20:30', NULL);
UPDATE t1 SET b=a;
ERROR 22007: Incorrect inet6 value: '2001-01-01 10:20:30' for column `test`.`t1`.`b` at row 1
SELECT b FROM t1;
b
NULL
DROP TABLE t1;
#
# SET from INET6 to character string
#
CREATE TABLE t1 (a INET6, b CHAR(39));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b VARCHAR(39));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b TEXT);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b ENUM('ffff::ffff'));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b SET('ffff::ffff'));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
#
# SET from character string to INET6
#
CREATE TABLE t1 (a CHAR(39), b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a VARCHAR(39), b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a TEXT, b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a ENUM('ffff::ffff'), b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a SET('ffff::ffff'), b INET6);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
#
# SET from INET6 to binary
#
CREATE TABLE t1 (a INET6, b BINARY(16));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT HEX(b) FROM t1;
HEX(b)
FFFF000000000000000000000000FFFF
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b VARBINARY(39));
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT HEX(b) FROM t1;
HEX(b)
FFFF000000000000000000000000FFFF
DROP TABLE t1;
CREATE TABLE t1 (a INET6, b BLOB);
INSERT INTO t1 VALUES ('ffff::ffff', NULL);
UPDATE t1 SET b=a;
SELECT HEX(b) FROM t1;
HEX(b)
FFFF000000000000000000000000FFFF
DROP TABLE t1;
#
# SET from binary to INET6
#
CREATE TABLE t1 (a BINARY(16), b INET6);
INSERT INTO t1 VALUES (CONCAT(0xFFFF,REPEAT(0x0000,6),0xFFFF), NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a VARBINARY(16), b INET6);
INSERT INTO t1 VALUES (CONCAT(0xFFFF,REPEAT(0x0000,6),0xFFFF), NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
CREATE TABLE t1 (a BLOB, b INET6);
INSERT INTO t1 VALUES (CONCAT(0xFFFF,REPEAT(0x0000,6),0xFFFF), NULL);
UPDATE t1 SET b=a;
SELECT b FROM t1;
b
ffff::ffff
DROP TABLE t1;
#
# Limit clause parameter
# TODO: this should fail.
# The test for a valid data type should be moved
# from parse time to fix_fields() time, and performed
# for both Item_splocal and Item_param.
#
EXECUTE IMMEDIATE 'SELECT 1 FROM DUAL LIMIT ?' USING CAST('::' AS INET6);
1
#
# MDEV-20785 Converting INET6 to CHAR(39) produces garbage without a warning
#
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT CAST(a AS CHAR(39)) FROM t1;
CAST(a AS CHAR(39))
2001:db8::ff00:42:8329
ALTER TABLE t1 MODIFY a CHAR(39);
SELECT * FROM t1;
a
2001:db8::ff00:42:8329
DROP TABLE t1;
#
# MDEV-20783 INET6 cannot be converted to BINARY(16) (requires clarification in documentation)
#
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
ALTER TABLE t1 MODIFY a BINARY(16);
SELECT HEX(a) FROM t1;
HEX(a)
20010DB8000000000000FF0000428329
DROP TABLE t1;
#
# MDEV-20795 CAST(inet6 AS BINARY) returns wrong result
#
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('2001:db8::ff00:42:8329');
SELECT HEX(CAST(a AS BINARY)) FROM t1;
HEX(CAST(a AS BINARY))
20010DB8000000000000FF0000428329
SELECT HEX(CAST(a AS BINARY(16))) FROM t1;
HEX(CAST(a AS BINARY(16)))
20010DB8000000000000FF0000428329
DROP TABLE t1;
#
# MDEV-20808 CAST from INET6 to FLOAT does not produce an error
#
CREATE TABLE t1 (a INET6);
INSERT INTO t1 VALUES ('::');
SELECT CAST(a AS FLOAT) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'float_typecast'
DROP TABLE t1;
#
# MDEV-20798 Conversion from INET6 to other types performed without errors or warnings
#
CREATE TABLE t1 (a INET6, b INT);
INSERT INTO t1 (a) VALUES ('::');
UPDATE t1 SET b=a;
ERROR 22007: Incorrect integer value: '::' for column `test`.`t1`.`b` at row 1
SELECT * FROM t1;
a	b
::	NULL
DROP TABLE t1;
SET timestamp=UNIX_TIMESTAMP('2001-01-01 10:20:30');
CREATE TABLE t1 (a INET6, b TIMESTAMP);
INSERT INTO t1 (a) VALUES ('::');
UPDATE t1 SET b=a;
ERROR 22007: Incorrect datetime value: '::' for column `test`.`t1`.`b` at row 1
SELECT * FROM t1;
a	b
::	2001-01-01 10:20:30
DROP TABLE t1;
SET timestamp=DEFAULT;
CREATE OR REPLACE TABLE t1 (a INET6);
INSERT INTO t1 (a) VALUES ('::');
ALTER TABLE t1 MODIFY a DATE;
ERROR 22007: Incorrect date value: '::' for column `test`.`t1`.`a` at row 1
DROP TABLE t1;
#
# MDEV-20818 ER_CRASHED_ON_USAGE or Assertion `length <= column->length' failed in write_block_record on temporary table
#
CREATE TABLE t1 (a INET6);
SELECT
CAST(a AS BINARY(0)),
CAST(a AS BINARY(1)),
CAST(a AS BINARY(16)),
CAST(a AS BINARY(255)),
CAST(a AS BINARY(256)),
CAST(a AS BINARY(512)),
CAST(a AS BINARY(513)),
CAST(a AS BINARY(65532)),
CAST(a AS BINARY(65533)),
CAST(a AS BINARY(65534)),
CAST(a AS BINARY(65535)),
CAST(a AS BINARY(65536)),
CAST(a AS BINARY(16777215)),
CAST(a AS BINARY(16777216))
FROM t1;
Catalog	Database	Table	Table_alias	Column	Column_alias	Type	Length	Max length	Is_null	Flags	Decimals	Charsetnr
def					CAST(a AS BINARY(0))	254	0	0	Y	128	0	63
def					CAST(a AS BINARY(1))	254	1	0	Y	128	0	63
def					CAST(a AS BINARY(16))	254	16	0	Y	128	0	63
def					CAST(a AS BINARY(255))	254	255	0	Y	128	0	63
def					CAST(a AS BINARY(256))	253	256	0	Y	128	0	63
def					CAST(a AS BINARY(512))	253	512	0	Y	128	0	63
def					CAST(a AS BINARY(513))	253	513	0	Y	128	0	63
def					CAST(a AS BINARY(65532))	253	65532	0	Y	128	0	63
def					CAST(a AS BINARY(65533))	252	65533	0	Y	128	0	63
def					CAST(a AS BINARY(65534))	252	65534	0	Y	128	0	63
def					CAST(a AS BINARY(65535))	252	65535	0	Y	128	0	63
def					CAST(a AS BINARY(65536))	250	65536	0	Y	128	0	63
def					CAST(a AS BINARY(16777215))	250	16777215	0	Y	128	0	63
def					CAST(a AS BINARY(16777216))	251	16777216	0	Y	128	0	63
CAST(a AS BINARY(0))	CAST(a AS BINARY(1))	CAST(a AS BINARY(16))	CAST(a AS BINARY(255))	CAST(a AS BINARY(256))	CAST(a AS BINARY(512))	CAST(a AS BINARY(513))	CAST(a AS BINARY(65532))	CAST(a AS BINARY(65533))	CAST(a AS BINARY(65534))	CAST(a AS BINARY(65535))	CAST(a AS BINARY(65536))	CAST(a AS BINARY(16777215))	CAST(a AS BINARY(16777216))
DROP TABLE t1;
#
# MDEV-20826 Wrong result of MIN(inet6) with GROUP BY
#
CREATE TABLE t1 (id INT, a INET6) ENGINE=MyISAM;
INSERT INTO t1 VALUES (1, 'fff::'),(1, '8888::');
SELECT MIN(a), MAX(a) FROM t1 GROUP BY id;
MIN(a)	MAX(a)
fff::	8888::
DROP TABLE t1;
#
# MDEV-20809 EXTRACT from INET6 value does not produce any warnings
#
CREATE TABLE t1 (a INET6);
SELECT EXTRACT(DAY FROM a) FROM t1;
ERROR HY000: Illegal parameter data type inet6 for operation 'extract(day)'
DROP TABLE t1;
SELECT EXTRACT(DAY FROM CAST('::' AS INET6));
ERROR HY000: Illegal parameter data type inet6 for operation 'extract(day)'
#
# MDEV-22764 Crash with a stored aggregate function returning INET6
#
CREATE OR REPLACE AGGREGATE FUNCTION aggregate_min_inet6(x INET6) RETURNS INET6
BEGIN
DECLARE res INET6 DEFAULT NULL;
DECLARE CONTINUE HANDLER FOR NOT FOUND
RETURN res;
LOOP
FETCH GROUP NEXT ROW;
IF (res IS NULL) OR (res > x) THEN
SET res= x;
END IF;
END LOOP;
END;
$$
CREATE OR REPLACE TABLE t1 (name CHAR(30), val INET6);
INSERT INTO t1 VALUES ('a', '::05');
INSERT INTO t1 VALUES ('a', '::03');
INSERT INTO t1 VALUES ('b', '::01');
INSERT INTO t1 VALUES ('b', '::02');
INSERT INTO t1 VALUES ('b', '::05');
SELECT name, aggregate_min_inet6(val) pc FROM t1 GROUP BY name;
name	pc
a	::3
b	::1
CREATE OR REPLACE TABLE t2 (name CHAR(30), val INET6);
INSERT INTO t2 SELECT name, aggregate_min_inet6(val) pc FROM t1 GROUP BY name;
SELECT * FROM t2;
name	val
a	::3
b	::1
DROP TABLE t2;
DROP TABLE t1;
DROP FUNCTION aggregate_min_inet6;
#
# MDEV-20280 PERCENTILE_DISC() rejects temporal and string input
#
CREATE TABLE t1 (name CHAR(30), star_rating INET6);
INSERT INTO t1 VALUES ('Lord of the Ladybirds', '::5');
INSERT INTO t1 VALUES ('Lord of the Ladybirds', '::3');
INSERT INTO t1 VALUES ('Lady of the Flies', '::1');
INSERT INTO t1 VALUES ('Lady of the Flies', '::2');
INSERT INTO t1 VALUES ('Lady of the Flies', '::5');
SELECT name, PERCENTILE_DISC(0.5)
WITHIN GROUP (ORDER BY star_rating)
OVER (PARTITION BY name) AS pc FROM t1;
name	pc
Lady of the Flies	::2
Lady of the Flies	::2
Lady of the Flies	::2
Lord of the Ladybirds	::3
Lord of the Ladybirds	::3
SELECT name, PERCENTILE_DISC(0)
WITHIN GROUP (ORDER BY star_rating)
OVER (PARTITION BY name) AS pc FROM t1;
name	pc
Lady of the Flies	::1
Lady of the Flies	::1
Lady of the Flies	::1
Lord of the Ladybirds	::3
Lord of the Ladybirds	::3
SELECT name, PERCENTILE_DISC(1)
WITHIN GROUP (ORDER BY star_rating)
OVER (PARTITION BY name) AS pc FROM t1;
name	pc
Lady of the Flies	::5
Lady of the Flies	::5
Lady of the Flies	::5
Lord of the Ladybirds	::5
Lord of the Ladybirds	::5
DROP TABLE t1;
#
# MDEV-22758 Assertion `!item->null_value' failed in Type_handler_inet6::make_sort_key_part
#
CREATE TABLE t1 (a VARCHAR(8) NOT NULL, b INET6 NOT NULL);
INSERT INTO t1 VALUES ('foo','::'),('bar','1::1');
SELECT * FROM t1 ORDER BY CASE WHEN a THEN b ELSE a END;
a	b
foo	::
bar	1::1
Warnings:
Warning	1292	Truncated incorrect DOUBLE value: 'foo'
Warning	1292	Incorrect inet6 value: 'foo'
Warning	1292	Truncated incorrect DOUBLE value: 'bar'
Warning	1292	Incorrect inet6 value: 'bar'
DROP TABLE t1;
CREATE OR REPLACE TABLE t1 (a VARCHAR(8) NOT NULL);
INSERT INTO t1 VALUES ('foo'),('bar');
SELECT * FROM t1 ORDER BY CAST(a AS INET6);
a
foo
bar
Warnings:
Warning	1292	Incorrect inet6 value: 'foo'
Warning	1292	Incorrect inet6 value: 'bar'
DROP TABLE t1;
CREATE TABLE t1 (a INET6 NOT NULL, b VARCHAR(32) NOT NULL);
CREATE TABLE t2 AS SELECT CAST(a AS INET6) AS ca, CAST(b AS INET6) AS cb FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `ca` inet6 NOT NULL,
  `cb` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT COALESCE(a,a), COALESCE(a,b) FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `COALESCE(a,a)` inet6 NOT NULL,
  `COALESCE(a,b)` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
CREATE TABLE t2 AS SELECT a AS ca,a AS cb FROM t1 UNION SELECT a,b FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `ca` inet6 NOT NULL DEFAULT '::',
  `cb` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
DROP TABLE t2;
DROP TABLE t1;
#
# MDEV-22758 Assertion `!item->null_value' failed in Type_handler_inet6::make_sort_key_part
#
CREATE TABLE t1 (c INET6);
INSERT INTO t1 VALUES ('::'),(NULL);
SELECT * FROM t1 ORDER BY IFNULL(c, 'foo');
c
NULL
::
Warnings:
Warning	1292	Incorrect inet6 value: 'foo'
DROP TABLE t1;
CREATE TABLE t1 (c INET6);
INSERT INTO t1 VALUES ('::'),(NULL);
CREATE TABLE t2 AS SELECT IFNULL(c, 'foo') FROM t1;
Warnings:
Warning	1292	Incorrect inet6 value: 'foo'
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `IFNULL(c, 'foo')` inet6 DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
SELECT * FROM t2;
IFNULL(c, 'foo')
::
NULL
DROP TABLE t2;
CREATE TABLE t2 AS SELECT IFNULL(c, '::1') FROM t1;
SHOW CREATE TABLE t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `IFNULL(c, '::1')` inet6 NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
SELECT * FROM t2;
IFNULL(c, '::1')
::
::1
DROP TABLE t2;
DROP TABLE t1;
