create temporary table t1 (id int auto_increment primary key, v blob not null, vector index (v));
ERROR HY000: Cannot create VECTOR index on temporary MyISAM table
create table t1 (id int auto_increment primary key,
u blob not null, vector index (u),
v blob not null, vector index (v));
ERROR 42000: This version of MariaDB doesn't yet support 'multiple VECTOR indexes'
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
show keys from t1;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
t1	0	PRIMARY	1	id	A	0	NULL	NULL		BTREE			NO
t1	1	v	1	v	A	NULL	1	NULL		VECTOR			NO
drop table t1;
set mhnsw_max_edges_per_node=@@mhnsw_max_edges_per_node+1;
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`) `max_edges_per_node`=7
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
show keys from t1;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
t1	0	PRIMARY	1	id	A	0	NULL	NULL		BTREE			NO
t1	1	v	1	v	A	NULL	1	NULL		VECTOR			NO
drop table t1;
create table t1 (id int auto_increment primary key, v blob not null,
vector index (v) max_edges_per_node=5);
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`) `max_edges_per_node`=5
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
show keys from t1;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
t1	0	PRIMARY	1	id	A	0	NULL	NULL		BTREE			NO
t1	1	v	1	v	A	NULL	1	NULL		VECTOR			NO
set mhnsw_max_edges_per_node=default;
select * from information_schema.statistics where table_name='t1';
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
NON_UNIQUE	0
INDEX_SCHEMA	test
INDEX_NAME	PRIMARY
SEQ_IN_INDEX	1
COLUMN_NAME	id
COLLATION	A
CARDINALITY	0
SUB_PART	NULL
PACKED	NULL
NULLABLE	
INDEX_TYPE	BTREE
COMMENT	
INDEX_COMMENT	
IGNORED	NO
TABLE_CATALOG	def
TABLE_SCHEMA	test
TABLE_NAME	t1
NON_UNIQUE	1
INDEX_SCHEMA	test
INDEX_NAME	v
SEQ_IN_INDEX	1
COLUMN_NAME	v
COLLATION	A
CARDINALITY	NULL
SUB_PART	1
PACKED	NULL
NULLABLE	
INDEX_TYPE	VECTOR
COMMENT	
INDEX_COMMENT	
IGNORED	NO
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
select id, hex(v) from t1;
id	hex(v)
1	E360D63EBE554F3FCDBC523F4522193F5236083D
2	F511303F72224A3FDD05FE3EB22A133FFAE86A3F
3	F09BAA3EA172763F123DEF3E0C7FE53E288BF33E
4	B97A523F2A193E3EB4F62E3F2D23583E9DD60D3F
5	F7C5DF3E984B2B3E65E59D3D7376DB3EAC63773E
6	DE01453FFA486D3F10AA4D3FDD66813C71CB163F
7	76EDFC3E4B57243F10F8423FB158713F020BDA3E
8	56926C3FDF098D3E2C8C5E3D1AD4953DAA9D0B3E
9	7B713F3E5258323F80D1113D673B2B3F66E3583F
10	6CA1D43E9DF91B3FE580DA3E1C247D3F147CF33E
flush tables;
select id,vec_distance_euclidean(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
9	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
select id,vec_distance_euclidean(x'b047263C9f87233fcfd27e3eae493e3f0329f43e', v) d from t1 order by d limit 3;
id	d
9	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
select id>0,vec_distance_euclidean(v, NULL) d from t1 order by d limit 3;
id>0	d
1	NULL
1	NULL
1	NULL
select id>0,vec_distance_euclidean(v, x'123456') d from t1 order by d limit 3;
id>0	d
1	NULL
1	NULL
1	NULL
select t1.id as id1, t2.id as id2, vec_distance_euclidean(t1.v, t2.v) from t1, t1 as t2 order by 3,1,2;
id1	id2	vec_distance_euclidean(t1.v, t2.v)
1	1	0
2	2	0
3	3	0
4	4	0
5	5	0
6	6	0
7	7	0
8	8	0
9	9	0
10	10	0
7	10	0.35209009051322937
10	7	0.35209009051322937
1	7	0.5572673082351685
7	1	0.5572673082351685
2	3	0.6065129041671753
3	2	0.6065129041671753
1	3	0.6128237843513489
3	1	0.6128237843513489
5	8	0.6219995617866516
8	5	0.6219995617866516
3	10	0.65231853723526
10	3	0.65231853723526
9	10	0.6732681393623352
10	9	0.6732681393623352
3	7	0.679989218711853
7	3	0.679989218711853
3	9	0.6820752024650574
9	3	0.6820752024650574
2	10	0.6916305422782898
10	2	0.6916305422782898
2	9	0.6966650485992432
9	2	0.6966650485992432
3	6	0.7102823853492737
6	3	0.7102823853492737
2	7	0.7120217680931091
7	2	0.7120217680931091
2	6	0.7351617813110352
6	2	0.7351617813110352
1	10	0.7386864423751831
10	1	0.7386864423751831
4	6	0.7784357666969299
6	4	0.7784357666969299
4	8	0.779583752155304
8	4	0.779583752155304
4	5	0.8132007122039795
5	4	0.8132007122039795
2	4	0.826092541217804
4	2	0.826092541217804
5	10	0.8286488652229309
10	5	0.8286488652229309
5	9	0.8769351243972778
9	5	0.8769351243972778
1	6	0.8861410617828369
6	1	0.8861410617828369
3	5	0.9224202036857605
5	3	0.9224202036857605
4	7	0.934791624546051
7	4	0.934791624546051
7	9	0.9364253282546997
9	7	0.9364253282546997
3	4	0.9757105708122253
4	3	0.9757105708122253
1	2	0.9810272455215454
2	1	0.9810272455215454
1	4	0.9965475797653198
4	1	0.9965475797653198
5	7	0.9976863861083984
7	5	0.9976863861083984
4	10	1.010934591293335
10	4	1.010934591293335
1	5	1.0208359956741333
5	1	1.0208359956741333
6	7	1.022133231163025
7	6	1.022133231163025
2	5	1.050769329071045
5	2	1.050769329071045
6	8	1.103420376777649
8	6	1.103420376777649
3	8	1.1170300245285034
8	3	1.1170300245285034
6	10	1.1523451805114746
10	6	1.1523451805114746
1	9	1.163775086402893
9	1	1.163775086402893
2	8	1.1736570596694946
8	2	1.1736570596694946
4	9	1.1746894121170044
9	4	1.1746894121170044
1	8	1.1909960508346558
8	1	1.1909960508346558
8	10	1.2093596458435059
10	8	1.2093596458435059
6	9	1.2145298719406128
9	6	1.2145298719406128
5	6	1.2272785902023315
6	5	1.2272785902023315
8	9	1.2575258016586304
9	8	1.2575258016586304
7	8	1.288239598274231
8	7	1.288239598274231
flush session status;
select id,vec_distance_euclidean(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
9	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	0
select id,vec_distance_euclidean(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 use index () order by d limit 3;
id	d
9	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	11
flush session status;
select id,vec_distance_cosine(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
10	0.059055447578430176
9	0.06546902656555176
3	0.10750287771224976
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	11
delete from t1 where v = x'7b713f3e5258323f80d1113d673b2b3f66e3583f';
select id,vec_distance_euclidean(v, x'B047263C9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
10	0.5069010853767395
3	0.5865673422813416
7	0.7344464659690857
insert t1 (v) values (x'7b713f3e5258323f80d1113d673b2b3f66e3583f');
select id,vec_distance_euclidean(v, x'b047263c9F87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
11	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
select id,vec_distance_euclidean(v, x'B047263c9F87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 5;
id	d
11	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
7	0.7344464659690857
5	0.7671033143997192
update t1 set v=x'76EDFC3E4B57243F10F8423FB158713F020BAA3E' where v=x'6CA1D43E9DF91B3FE580DA3E1C247D3F147CF33E';
select id,vec_distance_euclidean(v, x'B047263C9F87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 5;
id	d
11	0.47199761867523193
3	0.5865673422813416
7	0.7344464659690857
10	0.7468367218971252
5	0.7671033143997192
delete from t1;
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
select id,vec_distance_euclidean(v, x'b047263c9f87233Fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 5;
id	d
20	0.47199761867523193
21	0.5069010853767395
14	0.5865673422813416
18	0.7344464659690857
16	0.7671033143997192
insert t1 (v) values ('');
ERROR 22007: Incorrect vector value: '...' for column `test`.`t1`.`v` at row 1
insert t1 (v) values (x'1234');
ERROR 22007: Incorrect vector value: '...' for column `test`.`t1`.`v` at row 1
insert t1 (v) values (x'12345678');
ERROR 22007: Incorrect vector value: '...' for column `test`.`t1`.`v` at row 1
drop table t1;
db.opt
# Check if CREATE TABLE ... LIKE inherits VECTOR index
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
create table t2 like t1;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
drop table t1, t2;
db.opt
# Test insert ... select with vector index
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
create table t2 like t1;
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
insert into t2 select id+10, v from t1;
insert into t1 select * from t2;
select id, hex(v) from t1;
id	hex(v)
1	E360D63EBE554F3FCDBC523F4522193F5236083D
2	F511303F72224A3FDD05FE3EB22A133FFAE86A3F
3	F09BAA3EA172763F123DEF3E0C7FE53E288BF33E
4	B97A523F2A193E3EB4F62E3F2D23583E9DD60D3F
5	F7C5DF3E984B2B3E65E59D3D7376DB3EAC63773E
6	DE01453FFA486D3F10AA4D3FDD66813C71CB163F
7	76EDFC3E4B57243F10F8423FB158713F020BDA3E
8	56926C3FDF098D3E2C8C5E3D1AD4953DAA9D0B3E
9	7B713F3E5258323F80D1113D673B2B3F66E3583F
10	6CA1D43E9DF91B3FE580DA3E1C247D3F147CF33E
11	E360D63EBE554F3FCDBC523F4522193F5236083D
12	F511303F72224A3FDD05FE3EB22A133FFAE86A3F
13	F09BAA3EA172763F123DEF3E0C7FE53E288BF33E
14	B97A523F2A193E3EB4F62E3F2D23583E9DD60D3F
15	F7C5DF3E984B2B3E65E59D3D7376DB3EAC63773E
16	DE01453FFA486D3F10AA4D3FDD66813C71CB163F
17	76EDFC3E4B57243F10F8423FB158713F020BDA3E
18	56926C3FDF098D3E2C8C5E3D1AD4953DAA9D0B3E
19	7B713F3E5258323F80D1113D673B2B3F66E3583F
20	6CA1D43E9DF91B3FE580DA3E1C247D3F147CF33E
drop table t1, t2;
db.opt
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
truncate table t1;
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d');
truncate table t1;
select * from t1;
id	v
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
drop table t1;
db.opt
# Test RENAME TABLE with vector index
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
rename table t1 to t2;
db.opt
t2#i#01.ibd
t2.frm
t2.ibd
create database test1;
rename table test.t2 to test1.t1;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
call mtr.add_suppression('InnoDB: Cannot rename.*because the source file does not exist');
call mtr.add_suppression('InnoDB: File ./test1/t1#i#01.ibd was not found');
rename table test1.t1 to test1.t2;
Got one of the listed errors
db.opt
t1.frm
t1.ibd
drop database test1;
db.opt
#
# Cosine distance
#
create table t1 (id int auto_increment primary key, v blob not null,
vector index (v) distance_function=cosine);
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`) `distance_function`=cosine
) ENGINE=MyISAM DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
select id,vec_distance_cosine(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
10	0.059055447578430176
9	0.06546902656555176
3	0.10750287771224976
flush session status;
select id,vec_distance_cosine(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
10	0.059055447578430176
9	0.06546902656555176
3	0.10750287771224976
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	0
select id,vec_distance_cosine(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 use index () order by d limit 3;
id	d
10	0.059055447578430176
9	0.06546902656555176
3	0.10750287771224976
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	11
flush session status;
select id,vec_distance_euclidean(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from t1 order by d limit 3;
id	d
9	0.47199761867523193
10	0.5069010853767395
3	0.5865673422813416
show status like 'handler_read_rnd_next';
Variable_name	Value
Handler_read_rnd_next	11
drop table t1;
# Test ALTER TABLE, CREATE/DROP INDEX
create table t1 (id int auto_increment primary key, v blob not null, vector index (v));
insert t1 (v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
# ADD/DROP COLUMN, ALGORITHM=COPY
alter table t1 add column a int, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  `a` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
alter table t1 drop column a, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# ADD/DROP INDEX, ALGORITHM=COPY (non-vector)
alter table t1 add index a(id), algorithm=copy;
db.opt
t1#i#02.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  KEY `a` (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
alter table t1 drop index a, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# CREATE/DROP INDEX, ALGORITHM=COPY (non-vector)
create index a on t1(id) algorithm=copy;
db.opt
t1#i#02.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  KEY `a` (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
alter table t1 drop index a, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# ADD/DROP COLUMN IF [NOT] EXISTS, ALGORITHM=COPY (non-vector)
alter table t1 add column if not exists a int, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  `a` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
alter table t1 drop column if exists a, algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# ADD/DROP INDEX, ALGORITHM=COPY (vector)
alter table t1 drop index v, algorithm=copy;
db.opt
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
alter table t1 add vector index v(v), algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# CREATE/DROP INDEX, ALGORITHM=COPY (vector)
alter table t1 drop index v, algorithm=copy;
db.opt
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
create vector index v on t1(v) algorithm=copy;
db.opt
t1#i#01.ibd
t1.frm
t1.ibd
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `v` blob NOT NULL,
  PRIMARY KEY (`id`),
  VECTOR KEY `v` (`v`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
drop table t1;
