create table t1(i int);
insert t1 values(100);
create view v1 as select 1;
drop table t1;
test.t1: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
select * from t1;
i
100
# Content of dump directory
mtr
mysql
test
# Content of 'test' dump subdirectory
t1.sql
t1.txt
v1.sql
# Content of 'mysql' dump subdirectory
column_stats.sql
column_stats.txt
columns_priv.sql
columns_priv.txt
db.sql
db.txt
event.sql
func.sql
func.txt
general_log.sql
global_priv.sql
global_priv.txt
gtid_slave_pos.sql
gtid_slave_pos.txt
help_category.sql
help_category.txt
help_keyword.sql
help_keyword.txt
help_relation.sql
help_relation.txt
help_topic.sql
help_topic.txt
index_stats.sql
index_stats.txt
innodb_index_stats.sql
innodb_table_stats.sql
plugin.sql
plugin.txt
proc.sql
proc.txt
procs_priv.sql
procs_priv.txt
proxies_priv.sql
proxies_priv.txt
roles_mapping.sql
roles_mapping.txt
servers.sql
servers.txt
slow_log.sql
table_stats.sql
table_stats.txt
tables_priv.sql
tables_priv.txt
time_zone.sql
time_zone.txt
time_zone_leap_second.sql
time_zone_leap_second.txt
time_zone_name.sql
time_zone_name.txt
time_zone_transition.sql
time_zone_transition.txt
time_zone_transition_type.sql
time_zone_transition_type.txt
transaction_registry.sql
user.sql
# Content of 'mtr' dump subdirectory
global_suppressions.sql
global_suppressions.txt
test_suppressions.sql
test_suppressions.txt
Connecting to localhost
Executing SQL script vardir/tmp/dump/mysql/help_topic.sql
Executing SQL script vardir/tmp/dump/mysql/time_zone_transition.sql
Executing SQL script vardir/tmp/dump/mtr/global_suppressions.sql
Executing SQL script vardir/tmp/dump/mysql/event.sql
Executing SQL script vardir/tmp/dump/mysql/innodb_index_stats.sql
Executing SQL script vardir/tmp/dump/mysql/innodb_table_stats.sql
Executing SQL script vardir/tmp/dump/mysql/help_keyword.sql
Executing SQL script vardir/tmp/dump/mysql/help_relation.sql
Executing SQL script vardir/tmp/dump/mysql/help_category.sql
Executing SQL script vardir/tmp/dump/mysql/time_zone_transition_type.sql
Executing SQL script vardir/tmp/dump/mysql/global_priv.sql
Executing SQL script vardir/tmp/dump/mysql/time_zone_leap_second.sql
Executing SQL script vardir/tmp/dump/mysql/proxies_priv.sql
Executing SQL script vardir/tmp/dump/mysql/tables_priv.sql
Executing SQL script vardir/tmp/dump/mysql/time_zone_name.sql
Executing SQL script vardir/tmp/dump/mysql/time_zone.sql
Executing SQL script vardir/tmp/dump/test/t1.sql
Executing SQL script vardir/tmp/dump/mysql/column_stats.sql
Executing SQL script vardir/tmp/dump/mysql/columns_priv.sql
Executing SQL script vardir/tmp/dump/mysql/db.sql
Executing SQL script vardir/tmp/dump/mysql/func.sql
Executing SQL script vardir/tmp/dump/mysql/gtid_slave_pos.sql
Executing SQL script vardir/tmp/dump/mysql/index_stats.sql
Executing SQL script vardir/tmp/dump/mysql/plugin.sql
Executing SQL script vardir/tmp/dump/mysql/procs_priv.sql
Executing SQL script vardir/tmp/dump/mysql/roles_mapping.sql
Executing SQL script vardir/tmp/dump/mysql/servers.sql
Executing SQL script vardir/tmp/dump/mysql/table_stats.sql
Executing SQL script vardir/tmp/dump/mysql/user.sql
Executing SQL script vardir/tmp/dump/mysql/transaction_registry.sql
Executing SQL script vardir/tmp/dump/mysql/slow_log.sql
Executing SQL script vardir/tmp/dump/test/v1.sql
Executing SQL script vardir/tmp/dump/mysql/general_log.sql
Loading data from LOCAL file: vardir/tmp/dump/mysql/help_topic.txt into help_topic
mysql.help_topic: Records: 839  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/time_zone_transition.txt into time_zone_transition
mysql.time_zone_transition: Records: 394  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mtr/global_suppressions.txt into global_suppressions
mtr.global_suppressions: Records: 99  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/help_keyword.txt into help_keyword
mysql.help_keyword: Records: 106  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/help_relation.txt into help_relation
mysql.help_relation: Records: 202  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/help_category.txt into help_category
mysql.help_category: Records: 50  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/time_zone_transition_type.txt into time_zone_transition_type
mysql.time_zone_transition_type: Records: 32  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/global_priv.txt into global_priv
mysql.global_priv: Records: 5  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/time_zone_leap_second.txt into time_zone_leap_second
mysql.time_zone_leap_second: Records: 23  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/proxies_priv.txt into proxies_priv
mysql.proxies_priv: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/tables_priv.txt into tables_priv
mysql.tables_priv: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/time_zone_name.txt into time_zone_name
mysql.time_zone_name: Records: 7  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/time_zone.txt into time_zone
mysql.time_zone: Records: 6  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/test/t1.txt into t1
test.t1: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/column_stats.txt into column_stats
mysql.column_stats: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/columns_priv.txt into columns_priv
mysql.columns_priv: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/db.txt into db
mysql.db: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/func.txt into func
mysql.func: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/gtid_slave_pos.txt into gtid_slave_pos
mysql.gtid_slave_pos: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/index_stats.txt into index_stats
mysql.index_stats: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/plugin.txt into plugin
mysql.plugin: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/procs_priv.txt into procs_priv
mysql.procs_priv: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/roles_mapping.txt into roles_mapping
mysql.roles_mapping: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/servers.txt into servers
mysql.servers: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/mysql/table_stats.txt into table_stats
mysql.table_stats: Records: 0  Deleted: 0  Skipped: 0  Warnings: 0
drop table t1;
drop view v1;
create database db2;
use db2;
CREATE TABLE parent (
id INT NOT NULL,
PRIMARY KEY (id)
) ENGINE=INNODB;
CREATE TABLE child (
id INT,
parent_id INT,
c CHAR(4),
INDEX par_ind (parent_id),
UNIQUE INDEX(c),
FOREIGN KEY (parent_id)
REFERENCES parent(id)
ON DELETE CASCADE,
CHECK (c >= 'a')
) ENGINE=INNODB;
insert into parent values(1),(2);
insert into child values (1,1,'a'),(1,2,'b'),(2,1,'c'),(2,2,'d');
CREATE TABLE offices (
id int NOT NULL AUTO_INCREMENT,
PRIMARY KEY (id)
) ENGINE=InnoDB;
CREATE TABLE users (
id int NOT NULL AUTO_INCREMENT,
office_id int DEFAULT NULL,
slogan text GENERATED ALWAYS AS (concat('Hello world #',office_id)) STORED,
PRIMARY KEY (id),
KEY office_id (office_id),
CONSTRAINT users_ibfk_1 FOREIGN KEY (office_id) REFERENCES offices (id)
) ENGINE=InnoDB;
insert into offices values();
insert into offices values();
insert into offices values();
insert into offices values();
insert into users (office_id) values (1);
insert into users (office_id) values (2);
insert into users (office_id) values (3);
drop database db2;
use db2;
select * from parent;
id
1
2
select * from child;
id	parent_id	c
1	1	a
1	2	b
2	1	c
2	2	d
show create table parent;
Table	Create Table
parent	CREATE TABLE `parent` (
  `id` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
show create table child;
Table	Create Table
child	CREATE TABLE `child` (
  `id` int(11) DEFAULT NULL,
  `parent_id` int(11) DEFAULT NULL,
  `c` char(4) DEFAULT NULL,
  UNIQUE KEY `c` (`c`),
  KEY `par_ind` (`parent_id`),
  CONSTRAINT `1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE CASCADE,
  CONSTRAINT `CONSTRAINT_1` CHECK (`c` >= 'a')
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
drop database db2;
# Repeat import with --verbose to see "Adding secondary keys" in the output
Connecting to localhost
Executing SQL script vardir/tmp/dump/db2/users.sql
Executing SQL script vardir/tmp/dump/db2/child.sql
Executing SQL script vardir/tmp/dump/db2/offices.sql
Executing SQL script vardir/tmp/dump/db2/parent.sql
Loading data from SERVER file: vardir/tmp/dump/db2/users.txt into users
db2.users: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
Adding secondary indexes to table `users`
Loading data from SERVER file: vardir/tmp/dump/db2/child.txt into child
db2.child: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
Adding secondary indexes to table `child`
Loading data from SERVER file: vardir/tmp/dump/db2/offices.txt into offices
db2.offices: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from SERVER file: vardir/tmp/dump/db2/parent.txt into parent
db2.parent: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
# Repeat import with --verbose and --innodb-optimize-indexes=0, to "not" see "Adding secondary indexes"
Connecting to localhost
Executing SQL script vardir/tmp/dump/db2/users.sql
Executing SQL script vardir/tmp/dump/db2/child.sql
Executing SQL script vardir/tmp/dump/db2/offices.sql
Executing SQL script vardir/tmp/dump/db2/parent.sql
Loading data from SERVER file: vardir/tmp/dump/db2/users.txt into users
db2.users: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from SERVER file: vardir/tmp/dump/db2/child.txt into child
db2.child: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from SERVER file: vardir/tmp/dump/db2/offices.txt into offices
db2.offices: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from SERVER file: vardir/tmp/dump/db2/parent.txt into parent
db2.parent: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
drop database db2;
create database db2;
use db2;
set rand_seed1=1, rand_seed2=2;
create table vec (id int auto_increment primary key, v vector(5) not null,
vector index (v)) ENGINE=InnoDB;
insert vec(v) values (x'e360d63ebe554f3fcdbc523f4522193f5236083d'),
(x'f511303f72224a3fdd05fe3eb22a133ffae86a3f'),
(x'f09baa3ea172763f123def3e0c7fe53e288bf33e'),
(x'b97a523f2a193e3eb4f62e3f2d23583e9dd60d3f'),
(x'f7c5df3e984b2b3e65e59d3d7376db3eac63773e'),
(x'de01453ffa486d3f10aa4d3fdd66813c71cb163f'),
(x'76edfc3e4b57243f10f8423fb158713f020bda3e'),
(x'56926c3fdf098d3e2c8c5e3d1ad4953daa9d0b3e'),
(x'7b713f3e5258323f80d1113d673b2b3f66e3583f'),
(x'6ca1d43e9df91b3fe580da3e1c247d3f147cf33e');
create table ft(v text, fulltext(v)) ENGINE=InnoDB;
insert into ft(v) values ('Once upon a time'),
('There was a wicked witch'), ('Who ate everybody up');
create table locations (id int auto_increment primary key, geom geometry NOT NULL) ENGINE=InnoDB;
create spatial index idx_geom on locations (geom);
insert into locations (geom) values (ST_GeomFromText('POINT(40.785091 -73.968285)'));
# use --verbose to see "Adding secondary indexes" in the output
Connecting to localhost
Executing SQL script vardir/tmp/dump/db2/vec.sql
Executing SQL script vardir/tmp/dump/db2/ft.sql
Executing SQL script vardir/tmp/dump/db2/locations.sql
Loading data from SERVER file: vardir/tmp/dump/db2/vec.txt into vec
db2.vec: Records: 10  Deleted: 0  Skipped: 0  Warnings: 0
Adding secondary indexes to table `vec`
Loading data from SERVER file: vardir/tmp/dump/db2/ft.txt into ft
db2.ft: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
Adding secondary indexes to table `ft`
Loading data from SERVER file: vardir/tmp/dump/db2/locations.txt into locations
db2.locations: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
Adding secondary indexes to table `locations`
show index from vec;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
vec	0	PRIMARY	1	id	A	1	NULL	NULL		BTREE			NO
vec	1	v	1	v	A	NULL	NULL	NULL		VECTOR			NO
show index from locations;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
locations	0	PRIMARY	1	id	A	1	NULL	NULL		BTREE			NO
locations	1	idx_geom	1	geom	A	NULL	32	NULL		SPATIAL			NO
show index from ft;
Table	Non_unique	Key_name	Seq_in_index	Column_name	Collation	Cardinality	Sub_part	Packed	Null	Index_type	Comment	Index_comment	Ignored
ft	1	v	1	v	NULL	NULL	NULL	NULL	YES	FULLTEXT			NO
select id,vec_distance_euclidean(v, x'B047263c9f87233fcfd27e3eae493e3f0329f43e') d from vec order by d limit 3;
id	d
9	0.47199
10	0.50690
3	0.58656
select * from ft where match(v) against('wicked');
v
There was a wicked witch
drop database db2;
create database db2;
use db2;
CREATE TABLE animals (id mediumint(9)
NOT NULL AUTO_INCREMENT,
name char(30) NOT NULL,
PRIMARY KEY (`id`));
CREATE TABLE animal_count (animals int);
INSERT INTO animal_count (animals) VALUES(0);
CREATE TRIGGER increment_animal
AFTER INSERT ON animals
FOR EACH ROW
UPDATE animal_count SET animal_count.animals = animal_count.animals+1;
INSERT INTO animals (name) VALUES('aardvark');
INSERT INTO animals (name) VALUES('baboon');
# Content of tables before backup
select * from animals;
id	name
1	aardvark
2	baboon
select * from animal_count;
animals
2
use test;
drop database db2;
Connecting to localhost
Executing SQL script vardir/tmp/dump/db2/animals.sql
Executing SQL script vardir/tmp/dump/db2/animal_count.sql
Loading data from LOCAL file: vardir/tmp/dump/db2/animals.txt into animals
db2.animals: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
Loading data from LOCAL file: vardir/tmp/dump/db2/animal_count.txt into animal_count
db2.animal_count: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
use db2;
# Content of tables after import
select * from animals;
id	name
1	aardvark
2	baboon
select * from animal_count;
animals
2
drop table animals;
drop table animal_count;
create table t1 as select 1 as val;
create view a1 as select * from t1;
use test;
drop database db2;
Connecting to localhost
Executing SQL script vardir/tmp/dump/db2/t1.sql
Executing SQL script vardir/tmp/dump/db2/a1.sql
Loading data from LOCAL file: vardir/tmp/dump/db2/t1.txt into t1
db2.t1: Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
use db2;
select * from t1;
val
1
select * from a1;
val
1
drop database db2;
use test;
create database db;
use db;
create table t1 as select 1 as val;
use test;
drop database db;
use db;
ERROR 42000: Unknown database 'db'
use test;
# Test non-existing --dir
mariadb-import: Path 'MYSQLTEST_VARDIR/tmp/non_existing' specified by option '--dir' does not exist
# Test too many threads, builtin limit 256
Too many connections, max value for --parallel is 256
#
# Test --hex-blob option for mariadb-import
# Round-trip tests: export with mysqldump --hex-blob, import with mariadb-import --hex-blob
#
USE test;
# Test 1: Round-trip basic BLOB types with --hex-blob
CREATE TABLE t_blob_roundtrip (
id INT PRIMARY KEY,
tiny_blob TINYBLOB,
normal_blob BLOB,
medium_blob MEDIUMBLOB,
long_blob LONGBLOB
);
INSERT INTO t_blob_roundtrip VALUES
(1, 'tiny\0data', 'normal\0blob', 'medium\0blob', 'long\0blob'),
(2, NULL, NULL, NULL, NULL),
(3, '', '', '', ''),
(4, X'DEADBEEF', X'CAFEBABE', X'FEEDFACE', X'BAADF00D'),
(5, X'00FF00FF', X'A5A5A5A5', X'12345678', X'FFFFFFFF');
# Export with mysqldump --hex-blob --tab
# Save original data for comparison
CREATE TABLE t_blob_original LIKE t_blob_roundtrip;
INSERT INTO t_blob_original SELECT * FROM t_blob_roundtrip;
# Drop table and recreate from .sql file
DROP TABLE t_blob_roundtrip;
# Import with mariadb-import --hex-blob
test.t_blob_roundtrip: Records: 5  Deleted: 0  Skipped: 0  Warnings: 0
# Verify data integrity - should return 0 rows (all data matches)
SELECT * FROM t_blob_roundtrip WHERE id NOT IN (SELECT id FROM t_blob_original);
id	tiny_blob	normal_blob	medium_blob	long_blob
SELECT * FROM t_blob_original WHERE id NOT IN (SELECT id FROM t_blob_roundtrip);
id	tiny_blob	normal_blob	medium_blob	long_blob
SELECT o.id FROM t_blob_original o, t_blob_roundtrip r
WHERE o.id = r.id
AND (o.tiny_blob IS NOT NULL AND r.tiny_blob IS NOT NULL AND o.tiny_blob != r.tiny_blob);
id
# Show successful import
SELECT id, HEX(tiny_blob), HEX(normal_blob) FROM t_blob_roundtrip ORDER BY id;
id	HEX(tiny_blob)	HEX(normal_blob)
1	74696E790064617461	6E6F726D616C00626C6F62
2	NULL	NULL
3		
4	DEADBEEF	CAFEBABE
5	00FF00FF	A5A5A5A5
DROP TABLE t_blob_roundtrip;
DROP TABLE t_blob_original;
# Test 2: Round-trip BINARY and VARBINARY types
CREATE TABLE t_binary_roundtrip (
id INT PRIMARY KEY,
bin_col BINARY(10),
varbin_col VARBINARY(100)
);
INSERT INTO t_binary_roundtrip VALUES
(1, X'0102030405', 'varbinary\0test'),
(2, NULL, NULL),
(3, X'00', ''),
(4, X'FFFFFFFFFFFFFF', X'DEADBEEFCAFEBABE');
# Export with mysqldump --hex-blob --tab
CREATE TABLE t_binary_original LIKE t_binary_roundtrip;
INSERT INTO t_binary_original SELECT * FROM t_binary_roundtrip;
DROP TABLE t_binary_roundtrip;
# Import with mariadb-import --hex-blob
test.t_binary_roundtrip: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
# Verify data integrity
SELECT o.id FROM t_binary_original o, t_binary_roundtrip r
WHERE o.id = r.id
AND ((o.bin_col IS NOT NULL AND r.bin_col IS NOT NULL AND o.bin_col != r.bin_col)
OR (o.varbin_col IS NOT NULL AND r.varbin_col IS NOT NULL AND o.varbin_col != r.varbin_col));
id
# Show successful import
SELECT id, HEX(bin_col), HEX(varbin_col) FROM t_binary_roundtrip ORDER BY id;
id	HEX(bin_col)	HEX(varbin_col)
1	01020304050000000000	76617262696E6172790074657374
2	NULL	NULL
3	00000000000000000000	
4	FFFFFFFFFFFFFF000000	DEADBEEFCAFEBABE
DROP TABLE t_binary_roundtrip;
DROP TABLE t_binary_original;
# Test 3: Round-trip mixed table (BLOB and non-BLOB columns)
CREATE TABLE t_mixed_roundtrip (
id INT PRIMARY KEY,
name VARCHAR(50),
data BLOB,
description TEXT,
binary_data VARBINARY(100)
);
INSERT INTO t_mixed_roundtrip VALUES
(1, 'First', X'ABCD', 'Description 1', X'1234'),
(2, 'Second', NULL, 'Description 2', NULL),
(3, 'Third', '', 'Description 3', ''),
(4, 'Special\tChars', X'00FF00FF', 'Desc\nWith\nNewlines', X'CAFEBABE');
# Export with mysqldump --hex-blob --tab
CREATE TABLE t_mixed_original LIKE t_mixed_roundtrip;
INSERT INTO t_mixed_original SELECT * FROM t_mixed_roundtrip;
DROP TABLE t_mixed_roundtrip;
# Import with mariadb-import --hex-blob
test.t_mixed_roundtrip: Records: 4  Deleted: 0  Skipped: 0  Warnings: 0
# Verify all columns match
SELECT o.id FROM t_mixed_original o, t_mixed_roundtrip r
WHERE o.id = r.id
AND (o.name != r.name OR o.description != r.description
OR (o.data IS NOT NULL AND r.data IS NOT NULL AND o.data != r.data)
OR (o.binary_data IS NOT NULL AND r.binary_data IS NOT NULL AND o.binary_data != r.binary_data));
id
# Show successful import
SELECT id, name, HEX(data), description, HEX(binary_data) FROM t_mixed_roundtrip ORDER BY id;
id	name	HEX(data)	description	HEX(binary_data)
1	First	ABCD	Description 1	1234
2	Second	NULL	Description 2	NULL
3	Third		Description 3	
4	Special	Chars	00FF00FF	Desc
With
Newlines	CAFEBABE
DROP TABLE t_mixed_roundtrip;
DROP TABLE t_mixed_original;
# Test 4: Round-trip with --columns parameter (subset of columns)
CREATE TABLE t_columns_test (
id INT PRIMARY KEY,
name VARCHAR(50),
blob1 BLOB,
blob2 BLOB,
text_col TEXT
);
INSERT INTO t_columns_test VALUES
(1, 'Row1', X'ABCD', X'1234', 'Text1'),
(2, 'Row2', NULL, NULL, 'Text2'),
(3, 'Row3', X'BEEF', X'CAFE', 'Text3');
# Export with mysqldump --hex-blob --tab
CREATE TABLE t_columns_original LIKE t_columns_test;
INSERT INTO t_columns_original SELECT * FROM t_columns_test;
DROP TABLE t_columns_test;
# Import with --hex-blob and --columns (id, blob1, blob2)
test.t_columns_test: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
# Verify blob columns match
SELECT o.id FROM t_columns_original o, t_columns_test r
WHERE o.id = r.id
AND ((o.blob1 IS NOT NULL AND r.blob1 IS NOT NULL AND o.blob1 != r.blob1)
OR (o.blob2 IS NOT NULL AND r.blob2 IS NOT NULL AND o.blob2 != r.blob2));
id
# Show successful import
SELECT id, name, HEX(blob1), HEX(blob2), text_col FROM t_columns_test ORDER BY id;
id	name	HEX(blob1)	HEX(blob2)	text_col
1	Row1	ABCD	1234	Text1
2	Row2	NULL	NULL	Text2
3	Row3	BEEF	CAFE	Text3
DROP TABLE t_columns_test;
DROP TABLE t_columns_original;
# Test 5: Import WITHOUT --hex-blob (default behavior - should fail or produce wrong data)
CREATE TABLE t_no_hex_import (
id INT,
data BLOB
);
INSERT INTO t_no_hex_import VALUES (1, X'DEADBEEF'), (2, NULL);
CREATE TABLE t_no_hex_original LIKE t_no_hex_import;
INSERT INTO t_no_hex_original SELECT * FROM t_no_hex_import;
DROP TABLE t_no_hex_import;
# Import WITHOUT --hex-blob - data will be interpreted as ASCII string, not binary
test.t_no_hex_import: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
# Show data mismatch - imported data is ASCII "DEADBEEF" not binary 0xDEADBEEF
SELECT id, HEX(data) as hex_data, LENGTH(data) as data_length FROM t_no_hex_import ORDER BY id;
id	hex_data	data_length
1	4445414442454546	8
2	NULL	NULL
# Original was binary (4 bytes), imported is ASCII string (8 bytes)
SELECT id, HEX(data) as hex_data, LENGTH(data) as data_length FROM t_no_hex_original ORDER BY id;
id	hex_data	data_length
1	DEADBEEF	4
2	NULL	NULL
DROP TABLE t_no_hex_import;
DROP TABLE t_no_hex_original;
# Test 6: NULL and empty blob handling
CREATE TABLE t_null_empty (
id INT PRIMARY KEY,
blob_null BLOB,
blob_empty BLOB,
blob_data BLOB
);
INSERT INTO t_null_empty VALUES
(1, NULL, '', X'ABCD'),
(2, NULL, '', X'1234');
CREATE TABLE t_null_empty_original LIKE t_null_empty;
INSERT INTO t_null_empty_original SELECT * FROM t_null_empty;
DROP TABLE t_null_empty;
test.t_null_empty: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
# Verify NULL remains NULL and empty remains empty
SELECT id, blob_null IS NULL as is_null, LENGTH(blob_empty) as empty_length, HEX(blob_data) FROM t_null_empty ORDER BY id;
id	is_null	empty_length	HEX(blob_data)
1	1	0	ABCD
2	1	0	1234
SELECT o.id FROM t_null_empty_original o, t_null_empty r
WHERE o.id = r.id
AND ((o.blob_null IS NULL) != (r.blob_null IS NULL)
OR o.blob_empty != r.blob_empty
OR o.blob_data != r.blob_data);
id
DROP TABLE t_null_empty;
DROP TABLE t_null_empty_original;
# Test 7: Table with only BLOB columns
CREATE TABLE t_all_blobs (
blob1 BLOB,
blob2 TINYBLOB,
blob3 MEDIUMBLOB
);
INSERT INTO t_all_blobs VALUES
(X'ABCDEF', X'123456', X'FEDCBA'),
(NULL, NULL, NULL),
(X'FF', X'00', X'AA');
CREATE TABLE t_all_blobs_original LIKE t_all_blobs;
INSERT INTO t_all_blobs_original SELECT * FROM t_all_blobs;
DROP TABLE t_all_blobs;
test.t_all_blobs: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
# Verify all blob columns match
SELECT HEX(blob1), HEX(blob2), HEX(blob3) FROM t_all_blobs ORDER BY blob1;
HEX(blob1)	HEX(blob2)	HEX(blob3)
NULL	NULL	NULL
ABCDEF	123456	FEDCBA
FF	00	AA
SELECT o.blob1 FROM t_all_blobs_original o
WHERE NOT EXISTS (
SELECT * FROM t_all_blobs r
WHERE (o.blob1 IS NULL AND r.blob1 IS NULL) OR o.blob1 = r.blob1
);
blob1
DROP TABLE t_all_blobs;
DROP TABLE t_all_blobs_original;
# Test 8: Round-trip with --dir option
CREATE TABLE t_dir_import (
id INT PRIMARY KEY,
data BLOB
);
INSERT INTO t_dir_import VALUES
(1, X'DEADBEEF'),
(2, 'test\0data'),
(3, NULL);
CREATE TABLE t_dir_import_original LIKE t_dir_import;
INSERT INTO t_dir_import_original SELECT * FROM t_dir_import;
DROP TABLE t_dir_import;
# Import with mariadb-import --hex-blob from --dir export
test.t_dir_import: Records: 3  Deleted: 0  Skipped: 0  Warnings: 0
# Verify data integrity
SELECT o.id FROM t_dir_import_original o, t_dir_import r
WHERE o.id = r.id
AND ((o.data IS NOT NULL AND r.data IS NOT NULL AND o.data != r.data));
id
SELECT id, HEX(data) FROM t_dir_import ORDER BY id;
id	HEX(data)
1	DEADBEEF
2	746573740064617461
3	NULL
DROP TABLE t_dir_import;
DROP TABLE t_dir_import_original;
