source include/not_embedded.inc;
--echo #
--echo #  MDEV-31466 Add optional correlation column list for derived tables
--echo #

create table t1 (c1 int, c2 int, c3 int);
insert into t1 values (1,2,3),(4,5,6);
create table t2 like t1;
insert into t2 values (7,8,9),(10,11,12);

--source include/analyze-format.inc
explain format=json
  select * from
    ( select c1, c2, c3 from t1 ) as d1 (a1, a2, a3)
    join ( values (1, 2, 3), (4, 5, 6) ) as d2 (b1, b2, b3)
      on a1=b1;

set optimizer_trace='enabled=on';

--source include/analyze-format.inc
explain format=json
  select * from
    ( select c1, c2, c3 from t1 ) as d1 (a1, a2, a3)
    where a1=1
  union
  select * from
    ( select c1, c2, c3 from t2 ) as d2 (b1, b2, b3)
    where b1=1;

select JSON_DETAILED(JSON_EXTRACT(trace, '$**.expanded_query')) 
  from INFORMATION_SCHEMA.OPTIMIZER_TRACE;

drop table t1, t2;

--echo #
--echo # End of 11.3 tests
--echo #
