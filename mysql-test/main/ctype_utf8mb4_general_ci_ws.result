#
# Start of 10.7 tests
#
#
# MDEV-30716 Wrong casefolding in xxx_unicode_520_ci for U+0700..U+07FF
#
SET NAMES utf8mb4 COLLATE utf8mb4_general_ci;
EXECUTE IMMEDIATE SFORMAT('
CREATE VIEW v_bmp AS
SELECT
  seq AS codepoint,
  LPAD(HEX(seq),4,''0'') AS codepoint_hex4,
  CONVERT(CHAR(seq USING utf32) USING {}) COLLATE {} AS c
FROM
  seq_0_to_65535', @@character_set_connection, @@collation_connection);
SELECT COLLATION(c) FROM v_bmp LIMIT 1;
COLLATION(c)
utf8mb4_general_ci
SELECT HEX(codepoint) FROM v_bmp WHERE HEX(WEIGHT_STRING(c))='FFFD';
HEX(codepoint)
FFFD
SELECT
SUM(codepoint_hex4=HEX(WEIGHT_STRING(c))) AS count_bmp_weight_is_codepoint,
SUM(codepoint_hex4<>HEX(WEIGHT_STRING(c))) AS count_bmp_weight_is_not_codepoint
FROM v_bmp;
count_bmp_weight_is_codepoint	count_bmp_weight_is_not_codepoint
64428	1108
SELECT codepoint_hex4,HEX(WEIGHT_STRING(c))
FROM v_bmp
WHERE codepoint_hex4<>HEX(WEIGHT_STRING(c));
codepoint_hex4	HEX(WEIGHT_STRING(c))
0061	0041
0062	0042
0063	0043
0064	0044
0065	0045
0066	0046
0067	0047
0068	0048
0069	0049
006A	004A
006B	004B
006C	004C
006D	004D
006E	004E
006F	004F
0070	0050
0071	0051
0072	0052
0073	0053
0074	0054
0075	0055
0076	0056
0077	0057
0078	0058
0079	0059
007A	005A
00B5	039C
00C0	0041
00C1	0041
00C2	0041
00C3	0041
00C4	0041
00C5	0041
00C7	0043
00C8	0045
00C9	0045
00CA	0045
00CB	0045
00CC	0049
00CD	0049
00CE	0049
00CF	0049
00D1	004E
00D2	004F
00D3	004F
00D4	004F
00D5	004F
00D6	004F
00D9	0055
00DA	0055
00DB	0055
00DC	0055
00DD	0059
00DF	0053
00E0	0041
00E1	0041
00E2	0041
00E3	0041
00E4	0041
00E5	0041
00E6	00C6
00E7	0043
00E8	0045
00E9	0045
00EA	0045
00EB	0045
00EC	0049
00ED	0049
00EE	0049
00EF	0049
00F0	00D0
00F1	004E
00F2	004F
00F3	004F
00F4	004F
00F5	004F
00F6	004F
00F8	00D8
00F9	0055
00FA	0055
00FB	0055
00FC	0055
00FD	0059
00FE	00DE
00FF	0059
0100	0041
0101	0041
0102	0041
0103	0041
0104	0041
0105	0041
0106	0043
0107	0043
0108	0043
0109	0043
010A	0043
010B	0043
010C	0043
010D	0043
010E	0044
010F	0044
0111	0110
0112	0045
0113	0045
0114	0045
0115	0045
0116	0045
0117	0045
0118	0045
0119	0045
011A	0045
011B	0045
011C	0047
011D	0047
011E	0047
011F	0047
0120	0047
0121	0047
0122	0047
0123	0047
0124	0048
0125	0048
0127	0126
0128	0049
0129	0049
012A	0049
012B	0049
012C	0049
012D	0049
012E	0049
012F	0049
0130	0049
0131	0049
0133	0132
0134	004A
0135	004A
0136	004B
0137	004B
0139	004C
013A	004C
013B	004C
013C	004C
013D	004C
013E	004C
0140	013F
0142	0141
0143	004E
0144	004E
0145	004E
0146	004E
0147	004E
0148	004E
014B	014A
014C	004F
014D	004F
014E	004F
014F	004F
0150	004F
0151	004F
0153	0152
0154	0052
0155	0052
0156	0052
0157	0052
0158	0052
0159	0052
015A	0053
015B	0053
015C	0053
015D	0053
015E	0053
015F	0053
0160	0053
0161	0053
0162	0054
0163	0054
0164	0054
0165	0054
0167	0166
0168	0055
0169	0055
016A	0055
016B	0055
016C	0055
016D	0055
016E	0055
016F	0055
0170	0055
0171	0055
0172	0055
0173	0055
0174	0057
0175	0057
0176	0059
0177	0059
0178	0059
0179	005A
017A	005A
017B	005A
017C	005A
017D	005A
017E	005A
017F	0053
0183	0182
0185	0184
0188	0187
018C	018B
0192	0191
0195	01F6
0199	0198
01A0	004F
01A1	004F
01A3	01A2
01A5	01A4
01A8	01A7
01AD	01AC
01AF	0055
01B0	0055
01B4	01B3
01B6	01B5
01B9	01B8
01BD	01BC
01BF	01F7
01C5	01C4
01C6	01C4
01C8	01C7
01C9	01C7
01CB	01CA
01CC	01CA
01CD	0041
01CE	0041
01CF	0049
01D0	0049
01D1	004F
01D2	004F
01D3	0055
01D4	0055
01D5	0055
01D6	0055
01D7	0055
01D8	0055
01D9	0055
01DA	0055
01DB	0055
01DC	0055
01DD	018E
01DE	0041
01DF	0041
01E0	0041
01E1	0041
01E2	00C6
01E3	00C6
01E5	01E4
01E6	0047
01E7	0047
01E8	004B
01E9	004B
01EA	004F
01EB	004F
01EC	004F
01ED	004F
01EE	01B7
01EF	01B7
01F0	004A
01F2	01F1
01F3	01F1
01F4	0047
01F5	0047
01F8	004E
01F9	004E
01FA	0041
01FB	0041
01FC	00C6
01FD	00C6
01FE	00D8
01FF	00D8
0200	0041
0201	0041
0202	0041
0203	0041
0204	0045
0205	0045
0206	0045
0207	0045
0208	0049
0209	0049
020A	0049
020B	0049
020C	004F
020D	004F
020E	004F
020F	004F
0210	0052
0211	0052
0212	0052
0213	0052
0214	0055
0215	0055
0216	0055
0217	0055
0218	0053
0219	0053
021A	0054
021B	0054
021D	021C
021E	0048
021F	0048
0223	0222
0225	0224
0226	0041
0227	0041
0228	0045
0229	0045
022A	004F
022B	004F
022C	004F
022D	004F
022E	004F
022F	004F
0230	004F
0231	004F
0232	0059
0233	0059
0253	0181
0254	0186
0256	0189
0257	018A
0259	018F
025B	0190
0260	0193
0263	0194
0268	0197
0269	0196
026F	019C
0272	019D
0275	019F
0280	01A6
0283	01A9
0288	01AE
028A	01B1
028B	01B2
0292	01B7
0345	0399
0386	0391
0388	0395
0389	0397
038A	0399
038C	039F
038E	03A5
038F	03A9
0390	0399
03AA	0399
03AB	03A5
03AC	0391
03AD	0395
03AE	0397
03AF	0399
03B0	03A5
03B1	0391
03B2	0392
03B3	0393
03B4	0394
03B5	0395
03B6	0396
03B7	0397
03B8	0398
03B9	0399
03BA	039A
03BB	039B
03BC	039C
03BD	039D
03BE	039E
03BF	039F
03C0	03A0
03C1	03A1
03C2	03A3
03C3	03A3
03C4	03A4
03C5	03A5
03C6	03A6
03C7	03A7
03C8	03A8
03C9	03A9
03CA	0399
03CB	03A5
03CC	039F
03CD	03A5
03CE	03A9
03D0	0392
03D1	0398
03D3	03D2
03D4	03D2
03D5	03A6
03D6	03A0
03DB	03DA
03DD	03DC
03DF	03DE
03E1	03E0
03E3	03E2
03E5	03E4
03E7	03E6
03E9	03E8
03EB	03EA
03ED	03EC
03EF	03EE
03F0	039A
03F1	03A1
03F2	03A3
0400	0415
0401	0415
0403	0413
0407	0406
040C	041A
040D	0418
040E	0423
0430	0410
0431	0411
0432	0412
0433	0413
0434	0414
0435	0415
0436	0416
0437	0417
0438	0418
0439	0419
043A	041A
043B	041B
043C	041C
043D	041D
043E	041E
043F	041F
0440	0420
0441	0421
0442	0422
0443	0423
0444	0424
0445	0425
0446	0426
0447	0427
0448	0428
0449	0429
044A	042A
044B	042B
044C	042C
044D	042D
044E	042E
044F	042F
0450	0415
0451	0415
0452	0402
0453	0413
0454	0404
0455	0405
0456	0406
0457	0406
0458	0408
0459	0409
045A	040A
045B	040B
045C	041A
045D	0418
045E	0423
045F	040F
0461	0460
0463	0462
0465	0464
0467	0466
0469	0468
046B	046A
046D	046C
046F	046E
0471	0470
0473	0472
0475	0474
0476	0474
0477	0474
0479	0478
047B	047A
047D	047C
047F	047E
0481	0480
048D	048C
048F	048E
0491	0490
0493	0492
0495	0494
0497	0496
0499	0498
049B	049A
049D	049C
049F	049E
04A1	04A0
04A3	04A2
04A5	04A4
04A7	04A6
04A9	04A8
04AB	04AA
04AD	04AC
04AF	04AE
04B1	04B0
04B3	04B2
04B5	04B4
04B7	04B6
04B9	04B8
04BB	04BA
04BD	04BC
04BF	04BE
04C1	0416
04C2	0416
04C4	04C3
04C8	04C7
04CC	04CB
04D0	0410
04D1	0410
04D2	0410
04D3	0410
04D5	04D4
04D6	0415
04D7	0415
04D9	04D8
04DA	04D8
04DB	04D8
04DC	0416
04DD	0416
04DE	0417
04DF	0417
04E1	04E0
04E2	0418
04E3	0418
04E4	0418
04E5	0418
04E6	041E
04E7	041E
04E9	04E8
04EA	04E8
04EB	04E8
04EC	042D
04ED	042D
04EE	0423
04EF	0423
04F0	0423
04F1	0423
04F2	0423
04F3	0423
04F4	0427
04F5	0427
04F8	042B
04F9	042B
0561	0531
0562	0532
0563	0533
0564	0534
0565	0535
0566	0536
0567	0537
0568	0538
0569	0539
056A	053A
056B	053B
056C	053C
056D	053D
056E	053E
056F	053F
0570	0540
0571	0541
0572	0542
0573	0543
0574	0544
0575	0545
0576	0546
0577	0547
0578	0548
0579	0549
057A	054A
057B	054B
057C	054C
057D	054D
057E	054E
057F	054F
0580	0550
0581	0551
0582	0552
0583	0553
0584	0554
0585	0555
0586	0556
1E00	0041
1E01	0041
1E02	0042
1E03	0042
1E04	0042
1E05	0042
1E06	0042
1E07	0042
1E08	0043
1E09	0043
1E0A	0044
1E0B	0044
1E0C	0044
1E0D	0044
1E0E	0044
1E0F	0044
1E10	0044
1E11	0044
1E12	0044
1E13	0044
1E14	0045
1E15	0045
1E16	0045
1E17	0045
1E18	0045
1E19	0045
1E1A	0045
1E1B	0045
1E1C	0045
1E1D	0045
1E1E	0046
1E1F	0046
1E20	0047
1E21	0047
1E22	0048
1E23	0048
1E24	0048
1E25	0048
1E26	0048
1E27	0048
1E28	0048
1E29	0048
1E2A	0048
1E2B	0048
1E2C	0049
1E2D	0049
1E2E	0049
1E2F	0049
1E30	004B
1E31	004B
1E32	004B
1E33	004B
1E34	004B
1E35	004B
1E36	004C
1E37	004C
1E38	004C
1E39	004C
1E3A	004C
1E3B	004C
1E3C	004C
1E3D	004C
1E3E	004D
1E3F	004D
1E40	004D
1E41	004D
1E42	004D
1E43	004D
1E44	004E
1E45	004E
1E46	004E
1E47	004E
1E48	004E
1E49	004E
1E4A	004E
1E4B	004E
1E4C	004F
1E4D	004F
1E4E	004F
1E4F	004F
1E50	004F
1E51	004F
1E52	004F
1E53	004F
1E54	0050
1E55	0050
1E56	0050
1E57	0050
1E58	0052
1E59	0052
1E5A	0052
1E5B	0052
1E5C	0052
1E5D	0052
1E5E	0052
1E5F	0052
1E60	0053
1E61	0053
1E62	0053
1E63	0053
1E64	0053
1E65	0053
1E66	0053
1E67	0053
1E68	0053
1E69	0053
1E6A	0054
1E6B	0054
1E6C	0054
1E6D	0054
1E6E	0054
1E6F	0054
1E70	0054
1E71	0054
1E72	0055
1E73	0055
1E74	0055
1E75	0055
1E76	0055
1E77	0055
1E78	0055
1E79	0055
1E7A	0055
1E7B	0055
1E7C	0056
1E7D	0056
1E7E	0056
1E7F	0056
1E80	0057
1E81	0057
1E82	0057
1E83	0057
1E84	0057
1E85	0057
1E86	0057
1E87	0057
1E88	0057
1E89	0057
1E8A	0058
1E8B	0058
1E8C	0058
1E8D	0058
1E8E	0059
1E8F	0059
1E90	005A
1E91	005A
1E92	005A
1E93	005A
1E94	005A
1E95	005A
1E96	0048
1E97	0054
1E98	0057
1E99	0059
1E9B	0053
1EA0	0041
1EA1	0041
1EA2	0041
1EA3	0041
1EA4	0041
1EA5	0041
1EA6	0041
1EA7	0041
1EA8	0041
1EA9	0041
1EAA	0041
1EAB	0041
1EAC	0041
1EAD	0041
1EAE	0041
1EAF	0041
1EB0	0041
1EB1	0041
1EB2	0041
1EB3	0041
1EB4	0041
1EB5	0041
1EB6	0041
1EB7	0041
1EB8	0045
1EB9	0045
1EBA	0045
1EBB	0045
1EBC	0045
1EBD	0045
1EBE	0045
1EBF	0045
1EC0	0045
1EC1	0045
1EC2	0045
1EC3	0045
1EC4	0045
1EC5	0045
1EC6	0045
1EC7	0045
1EC8	0049
1EC9	0049
1ECA	0049
1ECB	0049
1ECC	004F
1ECD	004F
1ECE	004F
1ECF	004F
1ED0	004F
1ED1	004F
1ED2	004F
1ED3	004F
1ED4	004F
1ED5	004F
1ED6	004F
1ED7	004F
1ED8	004F
1ED9	004F
1EDA	004F
1EDB	004F
1EDC	004F
1EDD	004F
1EDE	004F
1EDF	004F
1EE0	004F
1EE1	004F
1EE2	004F
1EE3	004F
1EE4	0055
1EE5	0055
1EE6	0055
1EE7	0055
1EE8	0055
1EE9	0055
1EEA	0055
1EEB	0055
1EEC	0055
1EED	0055
1EEE	0055
1EEF	0055
1EF0	0055
1EF1	0055
1EF2	0059
1EF3	0059
1EF4	0059
1EF5	0059
1EF6	0059
1EF7	0059
1EF8	0059
1EF9	0059
1F00	0391
1F01	0391
1F02	0391
1F03	0391
1F04	0391
1F05	0391
1F06	0391
1F07	0391
1F08	0391
1F09	0391
1F0A	0391
1F0B	0391
1F0C	0391
1F0D	0391
1F0E	0391
1F0F	0391
1F10	0395
1F11	0395
1F12	0395
1F13	0395
1F14	0395
1F15	0395
1F18	0395
1F19	0395
1F1A	0395
1F1B	0395
1F1C	0395
1F1D	0395
1F20	0397
1F21	0397
1F22	0397
1F23	0397
1F24	0397
1F25	0397
1F26	0397
1F27	0397
1F28	0397
1F29	0397
1F2A	0397
1F2B	0397
1F2C	0397
1F2D	0397
1F2E	0397
1F2F	0397
1F30	0399
1F31	0399
1F32	0399
1F33	0399
1F34	0399
1F35	0399
1F36	0399
1F37	0399
1F38	0399
1F39	0399
1F3A	0399
1F3B	0399
1F3C	0399
1F3D	0399
1F3E	0399
1F3F	0399
1F40	039F
1F41	039F
1F42	039F
1F43	039F
1F44	039F
1F45	039F
1F48	039F
1F49	039F
1F4A	039F
1F4B	039F
1F4C	039F
1F4D	039F
1F50	03A5
1F51	03A5
1F52	03A5
1F53	03A5
1F54	03A5
1F55	03A5
1F56	03A5
1F57	03A5
1F59	03A5
1F5B	03A5
1F5D	03A5
1F5F	03A5
1F60	03A9
1F61	03A9
1F62	03A9
1F63	03A9
1F64	03A9
1F65	03A9
1F66	03A9
1F67	03A9
1F68	03A9
1F69	03A9
1F6A	03A9
1F6B	03A9
1F6C	03A9
1F6D	03A9
1F6E	03A9
1F6F	03A9
1F70	0391
1F71	1FBB
1F72	0395
1F73	1FC9
1F74	0397
1F75	1FCB
1F76	0399
1F77	1FDB
1F78	039F
1F79	1FF9
1F7A	03A5
1F7B	1FEB
1F7C	03A9
1F7D	1FFB
1F80	0391
1F81	0391
1F82	0391
1F83	0391
1F84	0391
1F85	0391
1F86	0391
1F87	0391
1F88	0391
1F89	0391
1F8A	0391
1F8B	0391
1F8C	0391
1F8D	0391
1F8E	0391
1F8F	0391
1F90	0397
1F91	0397
1F92	0397
1F93	0397
1F94	0397
1F95	0397
1F96	0397
1F97	0397
1F98	0397
1F99	0397
1F9A	0397
1F9B	0397
1F9C	0397
1F9D	0397
1F9E	0397
1F9F	0397
1FA0	03A9
1FA1	03A9
1FA2	03A9
1FA3	03A9
1FA4	03A9
1FA5	03A9
1FA6	03A9
1FA7	03A9
1FA8	03A9
1FA9	03A9
1FAA	03A9
1FAB	03A9
1FAC	03A9
1FAD	03A9
1FAE	03A9
1FAF	03A9
1FB0	0391
1FB1	0391
1FB2	0391
1FB3	0391
1FB4	0391
1FB6	0391
1FB7	0391
1FB8	0391
1FB9	0391
1FBA	0391
1FBC	0391
1FBE	0399
1FC2	0397
1FC3	0397
1FC4	0397
1FC6	0397
1FC7	0397
1FC8	0395
1FCA	0397
1FCC	0397
1FD0	0399
1FD1	0399
1FD2	0399
1FD6	0399
1FD7	0399
1FD8	0399
1FD9	0399
1FDA	0399
1FE0	03A5
1FE1	03A5
1FE2	03A5
1FE4	03A1
1FE5	03A1
1FE6	03A5
1FE7	03A5
1FE8	03A5
1FE9	03A5
1FEA	03A5
1FEC	03A1
1FF2	03A9
1FF3	03A9
1FF4	03A9
1FF6	03A9
1FF7	03A9
1FF8	039F
1FFA	03A9
1FFC	03A9
2170	2160
2171	2161
2172	2162
2173	2163
2174	2164
2175	2165
2176	2166
2177	2167
2178	2168
2179	2169
217A	216A
217B	216B
217C	216C
217D	216D
217E	216E
217F	216F
24D0	24B6
24D1	24B7
24D2	24B8
24D3	24B9
24D4	24BA
24D5	24BB
24D6	24BC
24D7	24BD
24D8	24BE
24D9	24BF
24DA	24C0
24DB	24C1
24DC	24C2
24DD	24C3
24DE	24C4
24DF	24C5
24E0	24C6
24E1	24C7
24E2	24C8
24E3	24C9
24E4	24CA
24E5	24CB
24E6	24CC
24E7	24CD
24E8	24CE
24E9	24CF
FF41	FF21
FF42	FF22
FF43	FF23
FF44	FF24
FF45	FF25
FF46	FF26
FF47	FF27
FF48	FF28
FF49	FF29
FF4A	FF2A
FF4B	FF2B
FF4C	FF2C
FF4D	FF2D
FF4E	FF2E
FF4F	FF2F
FF50	FF30
FF51	FF31
FF52	FF32
FF53	FF33
FF54	FF34
FF55	FF35
FF56	FF36
FF57	FF37
FF58	FF38
FF59	FF39
FF5A	FF3A
DROP VIEW v_bmp;
EXECUTE IMMEDIATE SFORMAT('
CREATE VIEW v_supplementary AS
SELECT
  seq AS codepoint,
  CONVERT(CHAR(seq USING utf32) USING {}) COLLATE {} AS c
FROM
  seq_65536_to_1114111', @@character_set_connection, @@collation_connection);
SELECT COLLATION(c) FROM v_supplementary LIMIT 1;
COLLATION(c)
utf8mb4_general_ci
SELECT
SUM(HEX(WEIGHT_STRING(c))<>'FFFD'),
SUM(HEX(WEIGHT_STRING(c))='FFFD')
FROM v_supplementary;
SUM(HEX(WEIGHT_STRING(c))<>'FFFD')	SUM(HEX(WEIGHT_STRING(c))='FFFD')
0	1048576
DROP VIEW v_supplementary;
#
# End of 10.7 tests
#
