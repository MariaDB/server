#
# MDEV 20257 Server crashes in Grant_table_base::init_read_record
# upon crash-upgrade
#
rename table mysql.global_priv to mysql.global_priv_bak;
rename table mysql.user to mysql.user_bak;
rename table mysql.proxies_priv to mysql.proxies_priv_bak;
rename table mysql.roles_mapping to mysql.roles_mapping_bak;
#
# Server crashes in the Aria locking code
#
flush privileges;
alter table mysql.db ENGINE=MyISAM;
drop table mysql.user;
#
# All tables are MyISAM
# Server crashes in Grant_tables::init_read_record
#
flush privileges;
call mtr.add_suppression("Table \'\..mysql\.user\' is marked as crashed and should be repaired");
call mtr.add_suppression("Checking table:   \'\..mysql\.user\'");
call mtr.add_suppression("mysql.user: 1 client is using or hasn't closed the table properly");
call mtr.add_suppression("Missing system table mysql..*; please run mysql_upgrade to create it");
drop table mysql.user;
alter table mysql.db ENGINE=Aria;
rename table mysql.global_priv_bak to mysql.global_priv;
rename table mysql.user_bak to mysql.user;
rename table mysql.proxies_priv_bak to mysql.proxies_priv;
rename table mysql.roles_mapping_bak to mysql.roles_mapping;
