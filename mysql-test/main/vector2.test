#
# tests that don't need to be run on many engines
#

--echo # Aria doesn't support VECTOR yet
--error ER_ILLEGAL_HA_CREATE_OPTION
create table t1(v blob not null, vector index(v)) engine=aria;

--echo #
--echo # MDEV-35038 Server crash in Index_statistics::get_avg_frequency upon EITS collection for vector index
--echo #
create table t (a int, v blob not null, vector index (v));
analyze table t persistent for columns() indexes (v);
drop table t;

--echo #
--echo # MDEV-35033 LeakSanitizer errors in my_malloc / safe_mutex_lazy_init_deadlock_detection / MHNSW_Context::alloc_node and alike
--echo #
call mtr.add_suppression('mariadbd: Can''t find record in ''t''');
create table t (a int, v blob not null, vector index (v));
insert into t values (1,vec_fromtext('[0]'));

--error ER_TRUNCATED_WRONG_VALUE_FOR_FIELD
update t set v = vec_fromtext('[0,0]');

--error ER_KEY_NOT_FOUND
update t set a = 2;

set global mhnsw_cache_size = 1048576;
insert into t  values (2,x'00000000');

drop table t;
set global mhnsw_cache_size = default;

--echo #
--echo # MDEV-35029 ASAN errors in Lex_ident<Compare_ident_ci>::is_valid_ident upon DDL on table with vector index
--echo #
create table t (a int, v blob not null, vector key (v) distance_function=euclidean);
show create table t;
set session mhnsw_max_edges_per_node = @@mhnsw_max_edges_per_node + 1;
create table t2 like t;
alter table t force;
drop table t, t2;
