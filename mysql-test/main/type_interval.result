#
# Start of 10.4 tests
#
#
# MDEV-17776 CAST(x AS INTERVAL DAY_SECOND(N))
#
CREATE TABLE t1 (a VARCHAR(128));
INSERT INTO t1 VALUES
('00:00:00'),
('+00:00:01'),
('-00:00:01'),
('838:59:59'),
('839:00:00'),
('2018:01:02'),
('87649415:59:59'),
('3652058 23:59:59'),
('87649416:00:00'),
('3652059 00:00:00');
SELECT
EXTRACT(DAY FROM a) AS d,
EXTRACT(HOUR FROM a) AS h,
a,
CAST(a AS INTERVAL DAY_SECOND(6)) AS cast_itds
FROM t1;
d	h	a	cast_itds
0	0	00:00:00	00:00:00.000000
0	0	+00:00:01	00:00:01.000000
0	0	-00:00:01	-00:00:01.000000
34	22	838:59:59	34 22:59:59.000000
34	23	839:00:00	34 23:00:00.000000
84	2	2018:01:02	84 02:01:02.000000
3652058	23	87649415:59:59	3652058 23:59:59.000000
3652058	23	3652058 23:59:59	3652058 23:59:59.000000
NULL	NULL	87649416:00:00	NULL
NULL	NULL	3652059 00:00:00	NULL
Warnings:
Warning	1292	Incorrect interval value: '87649416:00:00'
Warning	1292	Incorrect interval value: '87649416:00:00'
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '87649416:00:00'
Warning	1292	Incorrect interval value: '3652059 00:00:00'
Warning	1292	Incorrect interval value: '3652059 00:00:00'
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '3652059 00:00:00'
DROP TABLE t1;
CREATE TABLE t1 (a DECIMAL(32,9));
INSERT INTO t1 VALUES
(0),
(1),
(-1),
(8385959),
(8390000),
(20180102),
(876494155959),
(876494160000);
SELECT
EXTRACT(DAY FROM a) AS d,
EXTRACT(HOUR FROM a) AS h,
a,
CAST(a AS INTERVAL DAY_SECOND(6)) AS cast_itds
FROM t1;
d	h	a	cast_itds
0	0	0.000000000	00:00:00.000000
0	0	1.000000000	00:00:01.000000
0	0	-1.000000000	-00:00:01.000000
34	22	8385959.000000000	34 22:59:59.000000
34	23	8390000.000000000	34 23:00:00.000000
84	2	20180102.000000000	84 02:01:02.000000
3652058	23	876494155959.000000000	3652058 23:59:59.000000
NULL	NULL	876494160000.000000000	NULL
Warnings:
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '0.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '1.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '-1.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '8385959.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '8390000.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '20180102.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '876494155959.000000000'
Warning	1292	Incorrect interval value: '876494160000.000000000' for column `test`.`t1`.`a` at row 8
Warning	1292	Incorrect interval value: '876494160000.000000000' for column `test`.`t1`.`a` at row 8
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '876494160000.000000000'
DROP TABLE t1;
#
# End of 10.4 tests
#
#
# MDEV-12513: Support for INTERVAL data types in MariaDB
#
Parser Validation - Unsupported Interval Types & Invalid combination of INTERVAL Range.
CREATE PROCEDURE sp_invalid1(IN a INTERVAL QUARTER) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL QUARTER'
CREATE PROCEDURE sp_invalid2(IN a INTERVAL WEEK) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL WEEK'
CREATE PROCEDURE sp_invalid3(IN a INTERVAL MICROSECOND) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL MICROSECOND'
CREATE PROCEDURE sp_invalid4(IN a INTERVAL DAY TO MICROSECOND) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL DAY TO MICROSECOND'
CREATE PROCEDURE sp_invalid5(IN a INTERVAL HOUR TO MICROSECOND) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL HOUR TO MICROSECOND'
CREATE PROCEDURE sp_invalid6(IN a INTERVAL MINUTE TO MICROSECOND) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL MINUTE TO MICROSECOND'
CREATE PROCEDURE sp_invalid7(IN a INTERVAL SECOND TO MICROSECOND) BEGIN END;
ERROR 42000: This version of MariaDB doesn't yet support 'INTERVAL SECOND TO MICROSECOND'
CREATE PROCEDURE sp_invalid8(IN a INTERVAL MICROSECOND TO SECOND) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid11(IN a INTERVAL MICROSECOND TO MINUTE) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid12(IN a INTERVAL YEAR TO SECOND) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid13(IN a INTERVAL MONTH TO DAY) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid14(IN a INTERVAL SECOND TO HOUR) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid15(IN a INTERVAL WEEK TO DAY) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
CREATE PROCEDURE sp_invalid16(IN a INTERVAL YEAR TO SECOND) BEGIN END;
ERROR 42000: Invalid INTERVAL range combination near '\0014' at line 0
Precision validation â€“ ensuring valid start and end precisions
CREATE PROCEDURE sp_invalid_1(IN a INTERVAL YEAR(5)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 4
CREATE PROCEDURE sp_invalid_2(IN a INTERVAL MONTH(7)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 6
CREATE PROCEDURE sp_invalid_3(IN a INTERVAL DAY(8)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 7
CREATE PROCEDURE sp_invalid_4(IN a INTERVAL HOUR(10)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 8
CREATE PROCEDURE sp_invalid_5(IN a INTERVAL MINUTE(11)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 10
CREATE PROCEDURE sp_invalid_6(IN a INTERVAL SECOND(13)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 12
CREATE PROCEDURE sp_invalid_7(IN a INTERVAL YEAR(8)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 4
CREATE PROCEDURE sp_invalid_8(IN a INTERVAL SECOND(13)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 12
CREATE PROCEDURE sp_invalid_9(IN a INTERVAL DAY(9) TO SECOND(3)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 7
CREATE PROCEDURE sp_invalid_10(IN a INTERVAL HOUR(4) TO SECOND(13)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 12
CREATE PROCEDURE sp_invalid_11(IN a INTERVAL MINUTE(11) TO SECOND(2)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 10
CREATE PROCEDURE sp_invalid_12(IN a INTERVAL DAY(12) TO SECOND(2)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 7
CREATE PROCEDURE sp_invalid_13(IN a INTERVAL HOUR(3) TO SECOND(13)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 12
CREATE PROCEDURE sp_invalid_14(IN a INTERVAL DAY(12) TO SECOND(3)) BEGIN END;
ERROR 42000: Too big precision specified for 'a'. Maximum is 7
CREATE PROCEDURE sp_valid_1(IN a INTERVAL YEAR(4))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_2(IN a INTERVAL MONTH(6))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_3(IN a INTERVAL DAY(7))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_4(IN a INTERVAL HOUR(8))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_5(IN a INTERVAL MINUTE(10))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_6(IN a INTERVAL SECOND(12))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_7(IN a INTERVAL YEAR(2))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_8(IN a INTERVAL MONTH(1))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_9(IN a INTERVAL DAY(3))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_10(IN a INTERVAL MINUTE(7))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_11(IN a INTERVAL DAY(2) TO SECOND(3))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_12(IN a INTERVAL HOUR(3) TO SECOND(6))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_13(IN a INTERVAL MINUTE(5) TO SECOND(4))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_14(IN a INTERVAL DAY(1) TO MINUTE(3))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_15(IN a INTERVAL HOUR(8) TO MINUTE(2))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_16(IN a INTERVAL DAY TO SECOND(6))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_17(IN a INTERVAL HOUR(4) TO SECOND(0))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_18(IN a INTERVAL MINUTE(9) TO SECOND(2))
BEGIN
SELECT a;
END;
/
CREATE PROCEDURE sp_valid_19(IN a INTERVAL HOUR TO SECOND(5))
BEGIN
SELECT a;
END;
/
CALL sp_valid_1('9999');
a
9999
CALL sp_valid_2('119988');
a
119988
CALL sp_valid_3('3719628');
a
3719628
CALL sp_valid_4('89271072');
a
89271072
CALL sp_valid_5('5266993248');
a
5266993248
CALL sp_valid_6('310752601632');
a
310752601632
CALL sp_valid_7('99');
a
99
CALL sp_valid_8('1');
a
1
CALL sp_valid_9('999');
a
999
CALL sp_valid_10('9999999');
a
9999999
CALL sp_valid_11('99 23:59:59');
a
99 23:59:59
CALL sp_valid_12('999:59:999999');
a
1277:45:39
CALL sp_valid_13('99999:59');
a
99999:59
CALL sp_valid_14('9 23:59');
a
9 23:59
CALL sp_valid_15('99999999:59');
a
99999999:59
CALL sp_valid_16('9 23:59:59');
a
9 23:59:59
CALL sp_valid_17('9999:59:59');
a
9999:59:59
CALL sp_valid_18('999999999:59');
a
999999999:59
CALL sp_valid_19('23:59:59');
a
23:59:59
CALL sp_valid_1('10000');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_2('1200000');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_3('40000000');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_4('100000000');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_5('99999999999');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_6('9999999999999');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_7('1234');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_8('99999');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_9('10000');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_10('12345678');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_11('100 23:59:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_12('1000 23:59:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_13('100000:59:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_14('99 23:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_15('100000000:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_16('100 23:59:599999999');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_17('10000:59:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_18('1000000000:59:59');
ERROR HY000: Default/ignore value is not supported for such parameter usage
CALL sp_valid_19('1000 232');
ERROR HY000: Default/ignore value is not supported for such parameter usage
