#
# Start of 10.4 tests
#
#
# MDEV-17776 CAST(x AS INTERVAL DAY_SECOND(N))
#
CREATE TABLE t1 (a VARCHAR(128));
INSERT INTO t1 VALUES
('00:00:00'),
('+00:00:01'),
('-00:00:01'),
('838:59:59'),
('839:00:00'),
('2018:01:02'),
('87649415:59:59'),
('3652058 23:59:59'),
('87649416:00:00'),
('3652059 00:00:00');
SELECT
EXTRACT(DAY FROM a) AS d,
EXTRACT(HOUR FROM a) AS h,
a,
CAST(a AS INTERVAL DAY_SECOND(6)) AS cast_itds
FROM t1;
d	h	a	cast_itds
0	0	00:00:00	00:00:00.000000
0	0	+00:00:01	00:00:01.000000
0	0	-00:00:01	-00:00:01.000000
34	22	838:59:59	34 22:59:59.000000
34	23	839:00:00	34 23:00:00.000000
84	2	2018:01:02	84 02:01:02.000000
3652058	23	87649415:59:59	3652058 23:59:59.000000
3652058	23	3652058 23:59:59	3652058 23:59:59.000000
NULL	NULL	87649416:00:00	NULL
NULL	NULL	3652059 00:00:00	NULL
Warnings:
Warning	1292	Incorrect interval value: '87649416:00:00'
Warning	1292	Incorrect interval value: '87649416:00:00'
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '87649416:00:00'
Warning	1292	Incorrect interval value: '3652059 00:00:00'
Warning	1292	Incorrect interval value: '3652059 00:00:00'
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '3652059 00:00:00'
DROP TABLE t1;
CREATE TABLE t1 (a DECIMAL(32,9));
INSERT INTO t1 VALUES
(0),
(1),
(-1),
(8385959),
(8390000),
(20180102),
(876494155959),
(876494160000);
SELECT
EXTRACT(DAY FROM a) AS d,
EXTRACT(HOUR FROM a) AS h,
a,
CAST(a AS INTERVAL DAY_SECOND(6)) AS cast_itds
FROM t1;
d	h	a	cast_itds
0	0	0.000000000	00:00:00.000000
0	0	1.000000000	00:00:01.000000
0	0	-1.000000000	-00:00:01.000000
34	22	8385959.000000000	34 22:59:59.000000
34	23	8390000.000000000	34 23:00:00.000000
84	2	20180102.000000000	84 02:01:02.000000
3652058	23	876494155959.000000000	3652058 23:59:59.000000
NULL	NULL	876494160000.000000000	NULL
Warnings:
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '0.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '1.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '-1.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '8385959.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '8390000.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '20180102.000000000'
Note	1292	Truncated incorrect INTERVAL DAY TO SECOND value: '876494155959.000000000'
Warning	1292	Incorrect interval value: '876494160000.000000000' for column `test`.`t1`.`a` at row 8
Warning	1292	Incorrect interval value: '876494160000.000000000' for column `test`.`t1`.`a` at row 8
Warning	1292	Incorrect INTERVAL DAY TO SECOND value: '876494160000.000000000'
DROP TABLE t1;
#
# MDEV-12513: Support for INTERVAL data types in MariaDB
#
CREATE PROCEDURE sp_interval_parameters(
IN in_ym INTERVAL YEAR(4) TO MONTH,        -- Max: 9999-11
IN in_y INTERVAL YEAR(4),                  -- Max: 9999
IN in_m INTERVAL MONTH(2),                 -- Max: 99
IN in_ds INTERVAL DAY(3) TO SECOND(6),     -- Max: 999 23:59:59.999999
IN in_d INTERVAL DAY(3),                   -- Max: 999
IN in_h INTERVAL HOUR(3),                  -- Max: 999
IN in_n INTERVAL MINUTE(2),                -- Max: 99
IN in_s INTERVAL SECOND(6),                -- Max: 59.999999
IN in_dh INTERVAL DAY(3) TO HOUR,          -- Max: 999 23
IN in_dm INTERVAL DAY(3) TO MINUTE,        -- Max: 999 23:59
IN in_hs INTERVAL HOUR(3) TO SECOND(6),    -- Max: 999:59:59.999999
IN in_hm INTERVAL HOUR(3) TO MINUTE,       -- Max: 999:59
IN in_ms INTERVAL MINUTE(2) TO SECOND(6),  -- Max: 99:59.999999
OUT out_ym INTERVAL YEAR(4) TO MONTH,
OUT out_y INTERVAL YEAR(4),
OUT out_m INTERVAL MONTH(2),
OUT out_ds INTERVAL DAY(3) TO SECOND(6),
OUT out_d INTERVAL DAY(3),
OUT out_h INTERVAL HOUR(3),
OUT out_n INTERVAL MINUTE(2),
OUT out_s INTERVAL SECOND(6),
OUT out_dh INTERVAL DAY(3) TO HOUR,
OUT out_dm INTERVAL DAY(3) TO MINUTE,
OUT out_hs INTERVAL HOUR(3) TO SECOND(6),
OUT out_hm INTERVAL HOUR(3) TO MINUTE,
OUT out_ms INTERVAL MINUTE(2) TO SECOND(6)
)
BEGIN
-- Simple passthrough logic
SET out_ym = in_ym;
SET out_y = in_y;
SET out_m = in_m;
SET out_ds = in_ds;
SET out_d = in_d;
SET out_h = in_h;
SET out_n = in_n;
SET out_s = in_s;
SET out_dh = in_dh;
SET out_dm = in_dm;
SET out_hs = in_hs;
SET out_hm = in_hm;
SET out_ms = in_ms;
END;
/
CALL sp_interval_parameters(
'5-3',
'10',
'12',
'100 12:30:45.123456',
'100',
'120',
'90',
'45.123456',
'100 12',
'100 12:30',
'120:30:45.123456',
'120:30',
'90:45.123456',
@out_ym, @out_y, @out_m, @out_ds, @out_d,
@out_h, @out_n, @out_s, @out_dh, @out_dm,
@out_hs, @out_hm, @out_ms
);
SELECT
@out_ym,
@out_y,
@out_m,
@out_ds,
@out_d,
@out_h,
@out_n,
@out_s,
@out_dh,
@out_dm,
@out_hs,
@out_hm,
@out_ms;
@out_ym	@out_y	@out_m	@out_ds	@out_d	@out_h	@out_n	@out_s	@out_dh	@out_dm	@out_hs	@out_hm	@out_ms
5-03	10	12	100 12:30:45.123456	100	120	90	45	100 12	100 12:30	120:30:45.123456	120:30	90:45.123456
#
# End of 10.4 tests
#
