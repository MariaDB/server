*
* MDEV-30302 Value changed caused by DISTINCT and WITH [10.5.11,10.11.1]
*

drop table if exists t;
CREATE TABLE t (c1 CHAR(20));
INSERT INTO t VALUES ('0');
 
WITH `MYWITH` 
  AS (SELECT (BINARY f2-UNIX_TIMESTAMP('2011-12-22 14:22:02')) 
  AS f1 FROM (SELECT (~COERCIBILITY(c1))
  AS f2 FROM t) AS t1 WHERE (DATE_ADD(BIN(f2), INTERVAL 1 WEEK) NOT IN (SELECT 1 FROM t)) 
  AND (f2 BETWEEN '1' AND f2))
SELECT * FROM `MYWITH`; -- sql1
  
WITH `MYWITH`
  AS (SELECT DISTINCT (BINARY f2-UNIX_TIMESTAMP('2011-12-22 14:22:02'))
  AS f1 FROM (SELECT (~COERCIBILITY(c1)) AS f2 FROM t)
  AS t1 WHERE (DATE_ADD(BIN(f2), INTERVAL 1 WEEK) NOT IN (SELECT 1 FROM t))
  AND (f2 BETWEEN '1' AND f2))
SELECT * FROM `MYWITH`; -- sql2