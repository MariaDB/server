#
# MDEV-33830 Support for cursors on prepared statements
#
SET global log_output='TABLE';
SET log_slow_disabled_statements='';
CREATE PROCEDURE p1()
BEGIN
DECLARE c0 CURSOR FOR SELECT SLEEP(0.1);
OPEN c0;
CLOSE c0;
END;
$$
TRUNCATE mysql.slow_log;
SET long_query_time=0.01;
CALL p1;
SELECT sql_text FROM mysql.slow_log;;
sql_text	SELECT SLEEP(0.1)
sql_text	CALL p1
SET long_query_time=default;
DROP PROCEDURE p1;
TRUNCATE mysql.slow_log;
CREATE PROCEDURE p1()
BEGIN
DECLARE c0 SYS_REFCURSOR;
OPEN c0 FOR SELECT SLEEP(0.1);
CLOSE c0;
END;
$$
TRUNCATE mysql.slow_log;
SET long_query_time=0.01;
CALL p1;
SELECT sql_text FROM mysql.slow_log;;
sql_text	SELECT SLEEP(0.1)
sql_text	CALL p1
SET long_query_time=default;
DROP PROCEDURE p1;
TRUNCATE mysql.slow_log;
CREATE PROCEDURE p1()
BEGIN
DECLARE c0 CURSOR FOR stmt0;
PREPARE stmt0 FROM 'SELECT SLEEP(0.1)';
OPEN c0;
CLOSE c0;
DEALLOCATE PREPARE stmt0;
END;
$$
TRUNCATE mysql.slow_log;
SET long_query_time=0.01;
CALL p1;
SELECT sql_text FROM mysql.slow_log;;
sql_text	SELECT SLEEP(0.1)
sql_text	DEALLOCATE PREPARE stmt0
sql_text	CALL p1
SET long_query_time=default;
DROP PROCEDURE p1;
TRUNCATE mysql.slow_log;
CREATE PROCEDURE p1()
BEGIN
DECLARE c0 SYS_REFCURSOR;
OPEN c0 FOR 'SELECT SLEEP(0.1)';
CLOSE c0;
END;
$$
TRUNCATE mysql.slow_log;
SET long_query_time=0.01;
CALL p1;
SELECT sql_text FROM mysql.slow_log;;
sql_text	SELECT SLEEP(0.1)
sql_text	CALL p1
SET long_query_time=default;
DROP PROCEDURE p1;
TRUNCATE mysql.slow_log;
SET log_slow_disabled_statements=default;
SET global log_output=default;
