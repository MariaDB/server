--source include/not_embedded.inc

--echo #
--echo # Test DENY representation as JSON in mysql.global_priv table
--echo #

SET @q_show_denies =
  'SELECT User, Host,
          JSON_PRETTY(JSON_EXTRACT(Priv, ''$.denies'')) AS denies_pretty
   FROM mysql.global_priv
   WHERE JSON_LENGTH(JSON_EXTRACT(Priv, ''$.denies'')) > 0
   ORDER BY User, Host';
   
PREPARE show_denies FROM @q_show_denies;

CREATE USER u;
CREATE DATABASE d;

DENY SELECT,INSERT ON mysql.* TO u;
DENY UPDATE on d.* to u;

EXECUTE show_denies;

REVOKE DENY SELECT  ON mysql.* FROM u;

EXECUTE show_denies;

REVOKE DENY INSERT  ON mysql.* FROM u;
EXECUTE show_denies;

REVOKE DENY UPDATE ON d.* FROM u;

EXECUTE show_denies;

#Table level
DENY SELECT,INSERT on mysql.global_priv to u;
EXECUTE show_denies;
REVOKE DENY INSERT,SELECT  ON mysql.global_priv FROM u;
EXECUTE show_denies;

DENY SELECT(USER) on mysql.global_priv to u;
execute show_denies;

DENY UPDATE(user) on mysql.global_priv to u;
EXECUTE show_denies;



DENY SELECT on *.* to u;
EXECUTE show_denies;

DEALLOCATE PREPARE show_denies;
DROP USER u;
DROP DATABASE d;

