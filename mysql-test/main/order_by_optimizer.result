drop table if exists t0,t1,t2,t3;
# 
# MDEV-7885: EXPLAIN shows wrong info for ORDER BY query
# 
create table t0(a int);
insert into t0 values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
create table t1(a int);
insert into t1 select A.a + B.a* 10 + C.a * 100 from t0 A, t0 B, t0 C;
create table t2 (key1 int, col1 int, key(key1));
insert into t2 select a,a from t0;
insert into t2 select 15,15 from t1;
alter table t2 add key2 int, add key(key2);
# This must show "Using filesort":
explain 
select * from t2 ignore index for order by (key1) where col1<0 order by key1 limit 10;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t2	ALL	NULL	NULL	NULL	NULL	1010	Using where; Using filesort
drop table t0, t1, t2;
# 
# MDEV-8857: [Upstream too] EXPLAIN incorrectly shows Distinct for tables using join buffer
# 
create table t0(a int);
insert into t0 values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
create table t1 (a int, filler char(200), key(a));
insert into t1 select A.a + B.a* 10, 'AAAAAAAAAAAAAAAAAAAA' from t0 A, t0 B where B.a in (0,1);
explain select distinct A.a from t0 A, t1 B where A.a+B.a> 0;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	A	ALL	NULL	NULL	NULL	NULL	10	Using temporary
1	SIMPLE	B	index	NULL	a	5	NULL	20	Using where; Using index; Using join buffer (flat, BNL join)
drop table t0, t1;
#
# Truncate ORDER BY list to the first unique index
# https://bugs.mysql.com/bug.php?id=93049
#
CREATE TABLE t1 (
a int NOT NULL AUTO_INCREMENT,
b int DEFAULT NULL,
c int DEFAULT NULL,
d varchar(255) NOT NULL,
PRIMARY KEY (a),
KEY b_c (b,c),
UNIQUE KEY (d),
UNIQUE KEY (c,b)
);
INSERT INTO t1(b,c,d) VALUES (1,2,'blue'),(2,4,'green'),(7,8,'Cerulean');
EXPLAIN SELECT a FROM t1 ORDER BY a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	4	NULL	3	Using index
EXPLAIN SELECT a FROM t1 ORDER BY a, b;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	4	NULL	3	Using index
EXPLAIN SELECT d FROM t1 ORDER BY d;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	d	257	NULL	3	Using index
EXPLAIN SELECT d FROM t1 ORDER BY d, c;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	d	257	NULL	3	Using index
EXPLAIN SELECT b FROM t1 ORDER BY c, b, d;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	3	Using filesort
EXPLAIN SELECT c FROM t1 ORDER BY c, d;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	3	Using filesort
EXPLAIN SELECT y.a AS y,x.a AS x FROM t1 x, t1 y ORDER BY y.a, x.a;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	x	index	NULL	PRIMARY	4	NULL	3	Using index; Using temporary; Using filesort
1	SIMPLE	y	index	NULL	PRIMARY	4	NULL	3	Using index; Using join buffer (flat, BNL join)
SELECT y.a AS y,x.a AS x FROM t1 x, t1 y ORDER BY y.a, x.a;
y	x
1	1
1	2
1	3
2	1
2	2
2	3
3	1
3	2
3	3
DROP TABLE t1;
