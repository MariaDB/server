create table t1(x int GENERATED BY DEFAULT AS IDENTITY CACHE 3, source text) engine=innodb;
connect con1,localhost,root,,,,;
set debug_sync= "ha_write_row_start signal write1 wait_for step1 execute 12";
insert t1(source) select 'first' from seq_1_to_12;
connect con2,localhost,root,,;
set debug_sync= "ha_write_row_start signal write2 wait_for step2 execute 12";
insert t1(source) select 'second' from seq_1_to_12;
connection default;
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
set debug_sync= "now wait_for write1";
set debug_sync= "now wait_for write2";
set debug_sync= "now signal step1";
set debug_sync= "now signal step2";
connection con1;
connection con2;
connection default;
select * from t1 order by x;
x	source
1	first
2	first
3	first
4	second
5	second
6	second
7	first
8	first
9	first
10	second
11	second
12	second
13	first
14	first
15	first
16	second
17	second
18	second
19	second
20	second
21	second
22	first
23	first
24	first
drop table t1;
disconnect con1;
disconnect con2;
