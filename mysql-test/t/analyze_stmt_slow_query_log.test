--disable_warnings
drop table if exists t1;
--enable_warnings

#
# Remove old log file
#
let SLOW_LOG_FILE= `select @@slow_query_log_file`;

SET @@global.slow_query_log = OFF;

perl;
  my $slow_log_file= $ENV{'SLOW_LOG_FILE'} or die "SLOW_LOG_FILE not set";
  unlink($slow_log_file);
EOF

FLUSH SLOW LOGS;
SET @@global.slow_query_log = ON;

create table t1 (a int);
INSERT INTO t1 VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
select * from t1 where a<3;
drop table t1;
let SLOW_LOG_FILE= `select @@slow_query_log_file`;

# select @@slow_query_log_file;

perl;

  my $slow_log_file= $ENV{'SLOW_LOG_FILE'} or die "SLOW_LOG_FILE not set";
  open(FILE, $slow_log_file) or die "Failed to open $slow_log_file";
  while(<FILE>) {
    next if 1../create table t1/; # skip entries generated by mtr prelude
    print if /explain:/;
  }
  close(FILE);

EOF
