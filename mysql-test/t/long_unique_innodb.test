-- source include/have_innodb.inc
--echo #test for concurrent insert of long unique in innodb 
create table t1(a blob unique) engine= InnoDB;
show create table t1;
connect ('con1', localhost, root,,);
connect ('con2', localhost, root,,);

--connection con1
set  transaction isolation level READ UNCOMMITTED;
start transaction;
insert into t1 values('RUC');
--connection con2
set  transaction isolation level READ UNCOMMITTED;
start transaction;
insert into t1 values ('RUC');

--connection con1
commit;
set  transaction isolation level READ COMMITTED;
start transaction;
insert into t1 values('RC');
--connection con2
commit;
set  transaction isolation level READ COMMITTED;
start transaction;
insert into t1 values ('RC');
commit;

--connection con1
commit;
set  transaction isolation level REPEATABLE READ;
start transaction;
insert into t1 values('RR');
--connection con2
commit;
set  transaction isolation level REPEATABLE READ;
start transaction;
--error ER_LOCK_WAIT_TIMEOUT
insert into t1 values ('RR');

--connection con1
commit;
set  transaction isolation level SERIALIZABLE;
start transaction;
insert into t1 values('S');
--connection con2
commit;
set  transaction isolation level SERIALIZABLE;
start transaction;
--error ER_LOCK_WAIT_TIMEOUT
insert into t1 values ('S');
commit;

--connection con1
commit;

connection default;
disconnect con1;
disconnect con2;
select * from t1;
drop table t1;