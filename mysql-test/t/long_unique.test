create table z_1(abc blob unique);
insert into z_1 values(112);
insert into z_1 values(NULL);
insert into z_1 values(NULL);
insert into z_1 values('5666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666');
insert into z_1 values('sachin');
--error 1022
insert into z_1 values('sachin');
select * from z_1;
--error 1054
select db_row_hash_1 from z_1;
desc z_1;
select * from information_schema.columns where table_schema='mtr' and table_name='z_1';
create table tst_1(xyz blob unique , x2 blob unique);
insert into tst_1 values(1,22);
--error 1022
insert into tst_1 values(2,22);
select * from tst_1;
--error 1054
select db_row_hash_1 from tst_1;
--error 1054
select db_row_hash_2 from tst_1;
--error 1054 
select db_row_hash_1,db_row_hash_2 from tst_1;
desc tst_1;
select * from information_schema.columns where table_schema='mtr' and table_name='tst_1';
create table t1 (empnum smallint, grp int);
create table t2 (empnum int, name char(5));
insert into t1 values(1,1);
insert into t2 values(1,'bob');
create view v1 as select * from t2 inner join t1 using (empnum);
select * from v1;
#test on create table with column db_row_hash
create table c_1(abc blob unique, db_row_hash_1 int unique);
desc c_1;
insert into c_1 values(1,1);
--error 1022
insert into c_1 values(1,2);
create table c_2(abc blob unique,xyz blob unique, db_row_hash_2
int,db_row_hash_1 int unique);
desc c_2;
insert into c_2 values(1,1,1,1);
--error 1022
insert into c_2 values(1,23,4,5);
#update table
create table u_1(abc int primary key , xyz blob unique);
insert into u_1 values(1,2);
insert into u_1 values(2,3);
update u_1 set xyz=2 where abc=1;
#alter table drop column
--error 1091
alter table z_1 drop db_row_hash_1;
--error 1091
alter table c_1 drop db_row_hash_2;
alter table c_1 drop db_row_hash_1;
#add column
alter table z_1 add column  db_row_hash_1 int unique;
show create table z_1;
#insert should not break
--error 1022
insert into z_1 values('sachin',1);
alter table c_1 add column db_row_hash_2 int;
show create table c_1;
#modify db_row_hash
--error 1054
alter table z_1 change db_row_hash_2 temp int;
--error 1054
alter table c_1 change db_row_hash_3 temp int;
--error 1054
alter table c_1 change db_row_hash_4 temp int;
alter table c_2 change db_row_hash_1 temp int;
# now try to index db_row_hash
create table c_3(abc blob unique, xyz blob);
--error 1072
alter table c_3 add index(db_row_hash_1);
create table i_1(x1 int );
alter table i_1 add column x2 blob unique;
insert into i_1 value(1,1);
--error 1022
insert into i_1 value(2,1);
alter table i_1 drop index x2;
insert into i_1 value(2,1);
create table i_2(abc blob);
insert into i_2 values(1);
alter table i_2 add  unique index(abc);
select * from i_2;
insert into i_2 values(22);
--error 1022
insert into i_2 values(22);
alter table i_2 drop key abc;
insert into i_2 values(22);
drop table i_2;
create table i_2(abc blob);
insert into i_2 values(1);
alter table i_2 add constraint  unique(abc);
select * from i_2;
insert into i_2 values(22);
--error 1022
insert into i_2 values(22);
alter table i_2 drop key abc;
insert into i_2 values(22);
# now some indexes on blob these should allow 
# duplicates these will be used in where clause
create table di_1(abc blob , xyz int , index(abc,xyz));
show create table di_1;
insert into di_1 values(1,1);
insert into di_1 values(1,1);
insert into di_1 values(2,1);
create table di_2 (abc blob);
insert into di_2 values(1);
insert into di_2 values(1);
alter table di_2 add index(abc);
show create table di_2;
insert into di_2 values(1);
alter table di_2 drop index abc;
show create table di_2;

#some more insert tests with muliple unique

create table s_1(abc blob , xyz text ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
insert into s_1 values('sachin',NULL);
insert into s_1 values('sachin',NULL);
# alter
alter table s_1 add column a1 blob;
--error 1022
insert into s_1 values(12,'sachin','maria');
alter table s_1 add  unique key(a1);
--error 1022
insert into s_1 values(1,'sachin','maria');
alter table s_1 drop key a1;
insert into s_1 values(2,'sachin','maria');
--error 
alter table s_1 add index(a1);
insert into s_1 values(55,'sachin','maria');
show create table s_1;
alter table s_1 drop index(a1);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc blob , xyz blob ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc text , xyz text ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc text , xyz blob ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;


create table s_1(abc tinyblob , xyz tinytext ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc longblob , xyz mediumblob ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc mediumtext , xyz longtext ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;
create table s_1(abc longtext , xyz tinyblob ,unique(abc,xyz));
insert into s_1 values(12,'sachin');
--error 1022
insert into s_1 values(12,'sachin');
insert into s_1 values('sachin',12);
select * from s_1;
show create table s_1;
drop s_1;