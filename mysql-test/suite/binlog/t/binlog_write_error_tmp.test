# This test case check if the error of writing binlog file is properly
# reported and handled when executing statements with temporary tables.

--source include/have_binlog_format_statement.inc
--source include/have_sequence.inc

--echo #
--echo # MDEV-25292 Atomic CREATE OR REPLACE TABLE
--echo #

create temporary table t2 (b int);

let $query= CREATE TEMPORARY TABLE t1 (a int);
source include/binlog_inject_error.inc;

--error ER_NO_SUCH_TABLE
INSERT INTO t1 VALUES (1),(2),(3);

# Check that the create tempory will delete the old table
CREATE TEMPORARY TABLE t1 (b int);
let $query= CREATE OR REPLACE TEMPORARY TABLE t1 (c int);
source include/binlog_inject_error.inc;

--error ER_NO_SUCH_TABLE
SELECT * from t1;

let $query= CREATE TEMPORARY TABLE t1 like t2;
source include/binlog_inject_error.inc;

--error ER_NO_SUCH_TABLE
SELECT * from t1;

let $query= CREATE TEMPORARY TABLE t1 select seq as b from seq_1_to_2;
source include/binlog_inject_error.inc;

--error ER_NO_SUCH_TABLE
SELECT * from t1;
