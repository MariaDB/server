# Check binlog properties of various DDL:s.
# Motivated by MDEV-27365.
#
--source include/have_log_bin.inc
--source include/have_binlog_format_mixed.inc

CREATE TABLE t1 (i1 int, i2 int, pk int);
CREATE TABLE t2 (i1 int, i2 int, pk int);
CREATE TABLE t3 LIKE t1;

RESET MASTER;
# MDEV-38623 ALTER TABLE ... ENGINE = MERGE is binlogged w/o ddl tag.
# Prove the DDL tag is in place.
ALTER TABLE t3 ENGINE = MERGE UNION (t1,t2);

# MDEV-27365 CREATE-or-REPLACE SEQUENCE bilogged without DDL flag
# Prove it is logged with the DDL flag.
CREATE OR REPLACE SEQUENCE s1;

# This one has been always correct.
DROP SEQUENCE s1;
FLUSH LOGS;

# cleanup
DROP TABLE t3,t2,t1;

--let $MYSQLD_DATADIR= `select @@datadir`
--exec $MYSQL_BINLOG --base64-output=decode-rows $MYSQLD_DATADIR/master-bin.000001 > $MYSQLTEST_VARDIR/tmp/mysqlbinlog.sql

--let SEARCH_PATTERN= GTID [0-9]+-[0-9]+-[0-9]+
--let SEARCH_FILE= $MYSQLTEST_VARDIR/tmp/mysqlbinlog.sql
--source include/search_pattern_in_file.inc

--echo The same as above number of samples must be found:
--let SEARCH_PATTERN= GTID [0-9]+-[0-9]+-[0-9]+ ddl
--let SEARCH_FILE= $MYSQLTEST_VARDIR/tmp/mysqlbinlog.sql
--source include/search_pattern_in_file.inc
--remove_file $MYSQLTEST_VARDIR/tmp/mysqlbinlog.sql

--echo End of the tests
