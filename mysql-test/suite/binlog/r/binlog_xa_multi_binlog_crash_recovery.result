RESET MASTER;
CREATE TABLE t1 (a INT PRIMARY KEY, b MEDIUMTEXT) ENGINE=Innodb;
CALL mtr.add_suppression("Found 1 prepared XA transactions");
connect con1,localhost,root,,;
XA START 'xa1';
INSERT INTO t1 SET a=1;
SET DEBUG_SYNC= "simulate_hang_after_binlog_prepare SIGNAL con1_ready WAIT_FOR con1_go";
SET GLOBAL DEBUG_DBUG="d,simulate_crash_after_binlog_prepare";
XA END 'xa1';
XA PREPARE 'xa1';;
connection default;
SET DEBUG_SYNC= "now WAIT_FOR con1_ready";
FLUSH LOGS;
FLUSH LOGS;
FLUSH LOGS;
show binary logs;
Log_name	File_size
master-bin.000001	#
master-bin.000002	#
master-bin.000003	#
master-bin.000004	#
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000004	#	Format_desc	#	#	SERVER_VERSION, BINLOG_VERSION
master-bin.000004	#	Gtid_list	#	#	[#-#-#]
master-bin.000004	#	Binlog_checkpoint	#	#	master-bin.000001
SET DEBUG_SYNC= "now SIGNAL con1_go";
connection con1;
ERROR HY000: Lost connection to MySQL server during query
connection default;
XA RECOVER;
formatID	gtrid_length	bqual_length	data
1	3	0	xa1
XA COMMIT 'xa1';
SELECT * FROM t1;
a	b
1	NULL
connection default;
DROP TABLE t1;
