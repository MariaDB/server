#
# Test read key from named pipe
#
write_file $MYSQL_TMP_DIR/fifo.key;
1;11111111111111111111111111111111
2;00000000000000000000000000000000
3;22222222222222222222222222222222
EOF
--sleep 3

--source include/have_innodb.inc
--replace_result $MYSQL_TMP_DIR   MYSQL_TMP_DIR
INSTALL SONAME 'file_key_management';

CREATE TABLE t1(c1 BIGINT NOT NULL, b CHAR(200))  ENGINE=INNODB ENCRYPTED=YES ENCRYPTION_KEY_ID=1;
SHOW CREATE TABLE t1;
INSERT t1 VALUES (12345, REPEAT('1234567890', 20));

ALTER TABLE t1 ENCRYPTION_KEY_ID=2;
SHOW CREATE TABLE t1;
ALTER TABLE t1 ENCRYPTION_KEY_ID=3;
SHOW CREATE TABLE t1;

--echo # Reset mysqld
DROP TABLE t1;
remove_file $MYSQL_TMP_DIR/fifo.key;
UNINSTALL SONAME 'file_key_management';

--source include/restart_mysqld.inc

