source include/have_innodb.inc;
source include/master-slave.inc;

use test;
create table t1 (id int primary key, c1 int default 10, c2 varchar(20) default 'holiday') engine = innodb;

insert into t1 values(1, 12345, 'abcde'), (2, default, default), (3, 23456, 'xyzab');

set time_zone='+03:00';
set timestamp = 1;
alter table t1 add column d1 timestamp not null default current_timestamp;

select * from t1;
sync_slave_with_master;

connection slave;
set time_zone='+03:00';
select * from t1;

connection master;
alter table t1 add column d2 timestamp not null default current_timestamp, ALGORITHM=copy;

sync_slave_with_master;

connection slave;
select * from t1;

connection master;
drop table t1;


# datetime
create table t4 (id int primary key, c2 int);
insert into t4 values(1,1),(2,2),(3,3);
set timestamp = 1000;
alter table t4 add column (c3 datetime default current_timestamp(), c4 timestamp not null default current_timestamp());
select * from t4;
alter table t4 add column c5 time not null default current_timestamp();
alter table t4 add column c6 date not null default current_timestamp();

select * from t4;
sync_slave_with_master;

connection slave;
select * from t4;

connection master;
drop table t4;

--source include/rpl_end.inc
