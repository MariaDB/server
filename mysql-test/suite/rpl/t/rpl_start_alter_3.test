#
# Start Alter with Parallel Replication
# 1 domain id
# |Concurrent alters| > |W|
#
--source include/have_log_bin.inc
--source include/have_innodb.inc
--source include/master-slave.inc
--source include/have_debug.inc
set global binlog_split_alter=true;
--connection slave
set global gtid_strict_mode=1;

--connection slave
--source include/stop_slave.inc
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
change master to master_use_gtid=slave_pos;
--source include/start_slave.inc

--echo #Parallel Slave
--connection master
--let $master_server= "master"
--let $domain_1=0
--let $domain_2=0
--let $M_port= $MASTER_MYPORT
--let $S_port= $SLAVE_MYPORT
--let $sync_slave=1
--source include/start_alter_include.test
--source include/save_master_gtid.inc

--connection slave
--source include/sync_with_master_gtid.inc

--echo #cleanup
--source include/stop_slave.inc
SET GLOBAL slave_parallel_threads=0;
set global slave_domain_parallel_threads=0;
set global slave_parallel_mode=conservative;
set global gtid_strict_mode=0;
set global gtid_domain_id= 0;
--source include/start_slave.inc

--connection master
set global binlog_split_alter=false;
--source include/rpl_end.inc
