--source include/have_debug.inc
--source include/have_innodb.inc
--source include/master-slave.inc
--source include/not_embedded.inc

connection master;
create table t1(id int, c1 int) engine=innodb;
insert into t1 values(1,1);
set debug_dbug='+d,non_blocking_binlog_ignore_cache_size';
update t1 set c1=2;
set debug_dbug='-d,non_blocking_binlog_ignore_cache_size';

--let $assert_count = 1
--let $assert_file = $MYSQLTEST_VARDIR/log/mysqld.1.err
--let $assert_text = write non-blocking binlog succeed should be logged
--let $assert_select = write non-blocking binlog succeed
--let $assert_only_after = CURRENT_TEST
--source include/assert_grep.inc

insert into t1 values(3,3);
checksum table t1;

--source include/sync_slave_sql_with_master.inc
connection slave;
checksum table t1;

connection master;
drop table t1;
--source include/sync_slave_sql_with_master.inc

--source include/rpl_end.inc
