include/master-slave.inc
[connection master]
connection slave;
include/stop_slave.inc
connection master;
include/kill_binlog_dump_threads.inc
reset master;
connection slave;
set @restore_slave_net_timeout= @@global.slave_net_timeout;
set @@global.slave_net_timeout= 10;
set @@global.slave_net_timeout= 5;
change master to master_host='127.0.0.1',master_port=MASTER_PORT, master_user='root', master_heartbeat_period= 5.001;
Warnings:
Warning	1704	The requested value for the heartbeat period exceeds the value of `slave_net_timeout' seconds. A sensible value for the period should be less than the timeout
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	5.001
reset slave;
set @@global.slave_net_timeout= 5;
change master to master_host='127.0.0.1',master_port=MASTER_PORT, master_user='root', master_heartbeat_period= 4;
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	4.000
set @@global.slave_net_timeout= 3 /* must be a warning */;
reset slave;
connection master;
drop table if exists t1;
connection slave;
set @@global.slave_net_timeout= 10;
change master to master_host='127.0.0.1',master_port=MASTER_PORT, master_user='root', master_ssl_verify_server_cert=0, master_heartbeat_period= 0.5;
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	0.500
start slave;
connection master;
create table t1 (f1 int);
connection master;
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
include/check_slave_param.inc [Relay_Log_File]
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	0.500
A heartbeat has been received by the slave
connection master;
drop table t1;
connection master;
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
set @@global.slave_net_timeout= @restore_slave_net_timeout;
include/rpl_end.inc
End of tests
