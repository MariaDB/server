include/master-slave.inc
[connection master]
connection master;
reset master;
connection slave;
include/stop_slave.inc
set @restore_slave_net_timeout= @@global.slave_net_timeout;
set @@global.slave_net_timeout= 10;
set @@global.slave_net_timeout= 5;
change master to master_host='127.0.0.1',master_port=MASTER_PORT, master_user='root', master_heartbeat_period= 4;
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	4.000
set @@global.slave_net_timeout= 3 /* must be a warning */;
reset slave;
connection master;
drop table if exists t1;
connection slave;
set @@global.slave_net_timeout= 10;
change master to master_host='127.0.0.1',master_port=MASTER_PORT, master_user='root', master_ssl_verify_server_cert=0, master_heartbeat_period= 0.5;
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	0.500
start slave;
connection master;
create table t1 (f1 int);
connection slave;
include/check_slave_param.inc [Relay_Log_File]
show status like 'Slave_heartbeat_period';;
Variable_name	Slave_heartbeat_period
Value	0.500
A heartbeat has been received by the slave
connection master;
drop table t1;
connection slave;
set @@global.slave_net_timeout= @restore_slave_net_timeout;
include/rpl_end.inc
End of tests
