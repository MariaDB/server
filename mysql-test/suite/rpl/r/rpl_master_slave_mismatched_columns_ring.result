include/rpl_init.inc [topology=1->2->1]
#
# Initialize test data
connection server_1;
create table t1 ( id int, a int, b int) engine=innodb;
include/rpl_sync.inc
# Change table layouts between servers
connection server_1;
set session sql_log_bin=0;
alter table t1 add column m1col int after a;
set session sql_log_bin=1;
connection server_2;
set session sql_log_bin=0;
alter table t1 add column m2col int after a;
set session sql_log_bin=1;
# Populate data on different servers
connection server_1;
insert into t1 values(10,10,10,10);
insert into t1 values(11,11,11,11);
connection server_2;
insert into t1 values(20,20,20,20);
insert into t1 values(21,21,21,21);
include/rpl_sync.inc
# Server_1 should have full data rows for self-inserted rows, and
# replicated rows should have NULL for its mismatched column..
connection server_1;
# ..PASS
# Server_2 should have full data rows for self-inserted rows, and
# replicated rows should have NULL for its mismatched column..
connection server_2;
# ..PASS
#
# Test that UPDATE can replicate..
connection server_1;
update t1 set a=14 where m1col=10;
include/rpl_sync.inc
connection server_1;
# ..PASS
#
# Test that DELETE can replicate
connection server_1;
delete from t1 where m1col is NULL;
include/rpl_sync.inc
# ..PASS
#
# Cleanup
connection server_1;
drop table t1;
include/rpl_end.inc
