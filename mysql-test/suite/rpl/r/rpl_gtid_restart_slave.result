include/master-slave.inc
[connection master]
CREATE TABLE t (a TINYTEXT UNIQUE);
RENAME TABLE t TO t1;
INSERT INTO t1 VALUES ('initial state');
connection slave;
include/stop_slave_sql.inc
connection master;
RENAME TABLE t1 TO t;
INSERT INTO t VALUES ('before restart');
include/save_master_gtid.inc
$master_pos= 0-1-5
include/sync_slave_io_with_master.inc
include/rpl_restart_server.inc [server_number=2]
SET @@GLOBAL.relay_log_purge= OFF;
Gtid_IO_Pos = '0-1-5'
include/start_slave.inc
include/sync_with_master_gtid.inc
include/show_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
slave-relay-bin.000002	#	Rotate	#	#	master-bin.000001;pos=POS
slave-relay-bin.000002	#	Format_desc	#	#	SERVER_VERSION, BINLOG_VERSION
slave-relay-bin.000002	#	Gtid_list	#	#	[]
slave-relay-bin.000002	#	Binlog_checkpoint	#	#	master-bin.000001
slave-relay-bin.000002	#	Gtid	#	#	GTID #-#-#
slave-relay-bin.000002	#	Query	#	#	use `test`; CREATE TABLE t (a TINYTEXT UNIQUE)
slave-relay-bin.000002	#	Gtid	#	#	GTID #-#-#
slave-relay-bin.000002	#	Query	#	#	use `test`; RENAME TABLE t TO t1
slave-relay-bin.000002	#	Gtid	#	#	BEGIN GTID #-#-#
slave-relay-bin.000002	#	Query	#	#	use `test`; INSERT INTO t1 VALUES ('initial state')
slave-relay-bin.000002	#	Query	#	#	COMMIT
slave-relay-bin.000002	#	Gtid	#	#	GTID #-#-#
slave-relay-bin.000002	#	Query	#	#	use `test`; RENAME TABLE t1 TO t
slave-relay-bin.000002	#	Gtid	#	#	BEGIN GTID #-#-#
slave-relay-bin.000002	#	Query	#	#	use `test`; INSERT INTO t VALUES ('before restart')
slave-relay-bin.000002	#	Query	#	#	COMMIT
slave-relay-bin.000002	#	Stop	#	#	
SELECT * FROM t;
a
initial state
before restart
connection master;
FOUND 1 matches in mysqld.log
DROP TABLE t;
connection slave;
SET @@GLOBAL.relay_log_purge= ON;
include/rpl_end.inc
