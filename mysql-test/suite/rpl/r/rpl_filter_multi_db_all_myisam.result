include/master-slave.inc
[connection master]
connection master;
SET @@default_storage_engine='MyISAM';
# On master: create two tables and insert data
CREATE TABLE t1 (id INT PRIMARY KEY, data VARCHAR(50));
INSERT INTO t1 VALUES (1, 'row in t1');
CREATE DATABASE sample_db;
use sample_db;
CREATE TABLE t2 (id INT PRIMARY KEY, data VARCHAR(50));
INSERT INTO t2 VALUES (1, 'row in t2');
# This query should affect multiple tables at the same time
UPDATE test.t1, sample_db.t2
SET test.t1.data = 'updated t1', sample_db.t2.data = 'updated t2';
# Capture current binlog file name
# Find relay log file on slave
connection slave;
# Dump master binlog to file
# Dump slave relay log to file
# Validate that 'update t1' is in the master binlog
include/assert_grep.inc [updated t1 must be present in master binlog]
# Validate that 'update t2' is in the master binlog
include/assert_grep.inc [updated t2 must be present in master binlog]
# Validate that 'update t1' is not in the slave relaylog
include/assert_grep.inc [updated t1 must not be present in the Slave's relaylog]
# Validate that 'update t2' is not in the slave relaylog
include/assert_grep.inc [updated t2 must not be present in the Slave's relaylog]
# Cleanup
connection master;
DROP TABLE test.t1;
DROP TABLE sample_db.t2;
DROP DATABASE sample_db;
include/rpl_end.inc
# End of rpl_filter_multi_db_all_myisam.test
