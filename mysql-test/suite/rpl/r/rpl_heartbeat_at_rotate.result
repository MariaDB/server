# Binlog format independent
include/master-slave.inc
[connection master]
#
# Initialize test data
connection slave;
include/stop_slave.inc
change master to master_heartbeat_period=2;
include/start_slave.inc
# Rotating master logs and pausing after Rotate_event is written..
connection master;
set @old_dbug= @@global.debug_dbug;
set @@global.debug_dbug= "+d,stop_after_rotate_written";
flush binary logs;
# Waiting for Rotate event to write/sync to disk
connection server_1;
set debug_sync="now wait_for rotate_written";
# Sleep 3s so the master sends a heartbeat event to the slave
connection server_1;
set debug_sync="now signal finish_rotate";
connection master;
set @@global.debug_dbug= @old_dbug;
#
# Ensure replication continues without error..
connection master;
create table t1 (a int);
insert into t1 values (1);
connection slave;
include/diff_tables.inc [master:test.t1,slave:test.t1]
#
# Cleanup
connection master;
drop table t1;
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
include/rpl_end.inc
# End of rpl_heartbeat_at_rotate.test
