include/rpl_init.inc [topology=1->2, 2->3]
# binlog_row_image=FULL
connection server_1;
set @save_binlog_row_image= @@global.binlog_row_image;
set @@global.binlog_row_image=FULL;
connection server_2;
set @save_binlog_row_image= @@global.binlog_row_image;
set @@global.binlog_row_image=FULL;
# No NULL columns
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column a value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column b value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column c value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# binlog_row_image=MINIMAL
connection server_1;
set @@global.binlog_row_image=MINIMAL;
connection server_2;
set @@global.binlog_row_image=MINIMAL;
# No NULL columns
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column a value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column b value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column c value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# binlog_row_image=FULL
connection server_1;
set @@global.binlog_row_image= @save_binlog_row_image;
connection server_2;
set @@global.binlog_row_image= @save_binlog_row_image;
# No NULL columns
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
a	b	c
1000	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column a value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	NULL	99	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	NULL	aaa	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b	c
1	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	a	b
1	NULL	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
a	b	c
NULL	aaa	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = NULL WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	NULL	aaa	2000
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column b value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	NULL	2000	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b	c
1	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	c
1	1000	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	a	b
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
a	b	c
1000	NULL	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, NULL, 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	NULL	2000
connection server_2;
select * from t1;
pk	b
1	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
# Column c value is NULL
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_3;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ALL_NON_LOSSY';
connection server_1;
# No type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Simple type conversion
# ALTER ADD COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 first;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
new_col	pk	a	b	c
99	1	1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	new_col	b	c
1	1000	99	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b	c	new_col
1	1000	aaa	NULL	99
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# ALTER DROP COLUMN tests
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b	c
1	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	c
1	1000	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	a	b
1	1000	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column pk;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
a	b	c
1000	aaa	NULL
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column pk was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b TINYBLOB,
c int
) engine=MyISAM ;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 drop column a;
alter table t1 drop column c;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', NULL);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	NULL
connection server_2;
select * from t1;
pk	b
1	aaa
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column a was dropped, skipping its validation
# Column c was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
connection server_3;
set global slave_type_conversions= @saved_slave_type_conversions;
#
# Test system versioned tables
connection server_2;
connection server_1;
create table t1(
pk int not null primary key,
a int,
b BLOB,
c int
) engine=innodb with system versioning;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
alter table t1 modify b BLOB;
alter table t1 add column new_col int default 99 after a;
alter table t1 drop column b;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
connection server_1;
INSERT INTO t1 (pk, a, b, c) VALUES(1, 999, 'aaa', 2000);
UPDATE t1 set a = 1000 WHERE pk = 1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
# Ensure server_2 and server_3 are consistent with one another..
include/diff_tables.inc [server_2:test.t1, server_3:test.t1]
connection server_1;
select * from t1;
pk	a	b	c
1	1000	aaa	2000
connection server_2;
select * from t1;
pk	a	new_col	c
1	1000	99	2000
# Ensure server_2 state is correct (server_3 is proven to be
#   consistent, so we don't validate its data)..
# Column b was dropped, skipping its validation
# ..done
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
#
# ERROR_IF_MISSING_FIELD Error Checking
#
# Error 1: When row events are binlogged without metadata, if the logged
# event has more fields than the slave's table has, the slave should
# stop in error (mentioning the missing column number).
connection server_2;
set @saved_slave_type_conversions = @@global.slave_type_conversions;
set global slave_type_conversions='ERROR_IF_MISSING_FIELD';
connection server_1;
set @@global.binlog_row_metadata=FULL;
create table t1(
pk int not null primary key,
a int,
b int
) engine=innodb;
include/save_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
set statement sql_log_bin=0 for alter ignore table t1 drop b;
connection server_1;
insert into t1 values (10, 20, 30);
select * from t1;
pk	a	b
10	20	30
include/save_master_gtid.inc
connection server_2;
include/wait_for_slave_sql_error.inc [errno=4242]
Last_SQL_Error = 'Table structure for binlog event is not compatible with the table definition on this slave: Column 'b' missing from table 'test.t1''
set sql_slave_skip_counter= 1;
include/start_slave.inc
include/sync_with_master_gtid.inc
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
#
# Error 2: When row events are binlogged with metadata, if the slave's
# version of the table doesn't have a column with the same name that
# the binlogged event has, the slave should stop in error (mentioning
# the missing column name).
connection server_1;
set @@global.binlog_row_metadata=FULL;
create table t1(
pk int not null primary key,
a int,
b int
) engine=innodb;
include/save_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
set statement sql_log_bin=0 for alter ignore table t1 drop b;
set statement sql_log_bin=0 for alter ignore table t1 add column z int;
connection server_1;
insert into t1 values (11, 21, 31);
select * from t1;
pk	a	b
11	21	31
include/save_master_gtid.inc
connection server_2;
include/wait_for_slave_sql_error.inc [errno=4242]
Last_SQL_Error = 'Table structure for binlog event is not compatible with the table definition on this slave: Column 'b' missing from table 'test.t1''
set sql_slave_skip_counter= 1;
include/start_slave.inc
include/sync_with_master_gtid.inc
connection server_1;
drop table t1;
include/save_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
connection server_2;
set global slave_type_conversions= @saved_slave_type_conversions;
include/rpl_end.inc
# End of rpl_master_slave_mismatched_columns_full.test
