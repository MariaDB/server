include/master-slave.inc
[connection master]
connection master;
CREATE TABLE t1 (a INT PRIMARY KEY);
INSERT INTO t1 VALUES (1);
FLUSH BINARY LOGS;
INSERT INTO t1 VALUES (2);
*** Test that RESET MASTER fails when a slave is connected.
RESET MASTER;
ERROR HY000: Cannot execute RESET MASTER as the binlog is in use by a connected slave or other RESET MASTER or binlog reader. Check SHOW PROCESSLIST for "Binlog Dump" commands and use KILL to stop such readers
connection master;
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
include/stop_slave.inc
connection master;
*** Test that RESET MASTER fails on concurrent SHOW BINLOG EVENTS.
include/kill_binlog_dump_threads.inc
connection master1;
SET debug_sync= 'after_show_binlog_events SIGNAL waiting WAIT_FOR go';
SHOW BINLOG EVENTS in 'master-bin.000001';
connection master;
SET debug_sync= 'now WAIT_FOR waiting';
RESET MASTER;
SET debug_sync= 'now SIGNAL go';
connection master1;
connection master;
*** RESET MASTER works when no concurrent reader.
RESET MASTER;
DROP TABLE t1;
include/save_master_gtid.inc
connection slave;
SET GLOBAL gtid_slave_pos= '';
include/start_slave.inc
include/sync_with_master_gtid.inc
include/rpl_end.inc
