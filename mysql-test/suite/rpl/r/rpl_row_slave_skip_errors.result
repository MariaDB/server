include/master-slave.inc
[connection master]
CREATE TABLE t (name VARCHAR(25) DEFAULT NULL);
include/sync_slave_sql_with_master.inc
call mtr.add_suppression("Slave SQL.*Error executing row event: .Table .test.t. doesn.t exist., Error_code: 1146");
call mtr.add_suppression("Slave SQL.*Column 0 of table .test.t. cannot be converted from type.* Error_code: 1677");
call mtr.add_suppression("The slave coordinator and worker threads are stopped, possibly leaving data in inconsistent state");
call mtr.add_suppression("Got error 1 during COMMIT");
ALTER TABLE t MODIFY name VARCHAR(255);
connection master;
INSERT INTO t VALUE ('Omar');
# Sync should be successful. Slave should not stop with an error
# ER_SLAVE_CONVERSION_FAILED. It should be up and running in spite
# of errors as we have set slave_skip_error=1677.
include/sync_slave_sql_with_master.inc
include/check_slave_no_error.inc
# Verify master has one row and slave has none, row events from master should be skipped.
connection master;
SELECT * FROM t;
name
Omar
connection slave;
SELECT * FROM t;
name
connection master;
SELECT COUNT(*) AS master_count FROM t;
master_count
1
connection slave;
SELECT COUNT(*) AS slave_count FROM t;
slave_count
0
==== Clean up ====
include/stop_slave.inc
RESET MASTER;
RESET SLAVE;
include/start_slave.inc
connection master;
include/sync_slave_sql_with_master.inc
connection master;
DROP TABLE t;
include/rpl_end.inc
