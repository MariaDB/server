call mtr.add_suppression("InnoDB: innodb_log_archive_start=1234567 is after innodb_log_recovery_start=12345");
call mtr.add_suppression("InnoDB: innodb_log_archive=ON disallows innodb_log_file_size>4G");
call mtr.add_suppression("InnoDB: innodb_log_archive=ON but .*/ib_logfile0 exists");
call mtr.add_suppression("InnoDB: No matching file found for innodb_log_recovery_start=");
call mtr.add_suppression("InnoDB: File .*/ib_logfile0 was not found");
call mtr.add_suppression("InnoDB: innodb_log_archive_start=\\d+ is after innodb_log_recovery_start=\\d+");
call mtr.add_suppression("InnoDB: Did not find innodb_log_recovery_start=\\d+ ");
SET GLOBAL innodb_log_file_size=4194304;
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	4194304
SELECT global_value FROM information_schema.system_variables
WHERE variable_name = 'innodb_log_file_size';
global_value
4194304
CREATE TABLE t (
a INT PRIMARY KEY AUTO_INCREMENT,
b CHAR(255) NOT NULL)
ENGINE=INNODB;
INSERT INTO t SELECT NULL, REPEAT('a', 255) FROM seq_1_to_20000;
# restart: --innodb-log-file-size=4194304 --skip-innodb-log-archive
SELECT COUNT(*) FROM t;
COUNT(*)
20000
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	4194304
FOUND 1 /InnoDB: Resized log to 4\.000MiB/ in mysqld.1.err
SET @save=@@global.innodb_log_file_buffering;
SET GLOBAL innodb_log_file_buffering=OFF;
SET GLOBAL innodb_log_file_buffering=ON;
SET GLOBAL innodb_log_file_buffering=@save;
SET GLOBAL innodb_log_file_mmap=OFF;
Got one of the listed errors
connect con1,localhost,root;
SET GLOBAL innodb_log_file_size=7340032;
connection default;
SET GLOBAL innodb_log_archive=ON;
SET GLOBAL innodb_log_archive=OFF;
KILL QUERY @id;
connection con1;
SET GLOBAL innodb_log_archive=ON, innodb_log_file_size=10485760;
SELECT @@GLOBAL.innodb_log_file_size!=10485760;
@@GLOBAL.innodb_log_file_size!=10485760
1
SET GLOBAL innodb_log_file_size=4294971392;
ERROR HY000: Failed to create specific handler file
SELECT @@GLOBAL.innodb_log_file_size<=10485760;
@@GLOBAL.innodb_log_file_size<=10485760
1
SET GLOBAL innodb_log_file_size=4294967296;
SELECT @@GLOBAL.innodb_log_file_size<=10485760;
@@GLOBAL.innodb_log_file_size<=10485760
1
SET GLOBAL innodb_log_archive=OFF;
connection default;
SET GLOBAL innodb_log_file_size=5242880;
connection con1;
UPDATE t SET b='' WHERE a<10;
connection default;
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	5242880
SELECT global_value FROM information_schema.system_variables
WHERE variable_name = 'innodb_log_file_size';
global_value
5242880
connection con1;
disconnect con1;
connection default;
# restart: --innodb-log-recovery-start=12345 --innodb-log-archive-start=1234567
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
FOUND 1 /InnoDB: innodb_log_archive_start=1234567 is after innodb_log_recovery_start=12345/ in mysqld.1.err
# restart: --innodb-log-archive --innodb-log-file-size=5g
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
FOUND 1 /InnoDB: innodb_log_archive=ON disallows innodb_log_file_size>4G/ in mysqld.1.err
# restart: --innodb-log-archive --innodb-log-file-size=4g
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
FOUND 1 /InnoDB: innodb_log_archive=ON but .*/ib_logfile0 exists/ in mysqld.1.err
# restart
SELECT * FROM t WHERE a<10;
a	b
1	
2	
3	
4	
5	
6	
7	
8	
9	
SELECT COUNT(*),LENGTH(b) FROM t GROUP BY b;
COUNT(*)	LENGTH(b)
9	0
19991	255
SET GLOBAL innodb_log_archive=ON;
# restart: --innodb-log-recovery-start=12290
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
FOUND 1 /InnoDB: No matching file found for innodb_log_recovery_start=12290/ in mysqld.1.err
# restart: with restart_parameters
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
NOT FOUND /InnoDB: File .*/ib_logfile0 as not found/ in mysqld.1.err
FOUND 2 /InnoDB: innodb_log_archive_start=\d+ is after innodb_log_recovery_start=\d+/ in mysqld.1.err
# restart: with restart_parameters
$check_no_innodb;
ENGINE	SUPPORT	COMMENT	TRANSACTIONS	XA	SAVEPOINTS
# restart: with restart_parameters
SET GLOBAL innodb_log_archive=OFF;
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	5242880
SET GLOBAL innodb_log_file_size=6291456;
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	6291456
SET GLOBAL innodb_log_file_size=5242880;
SHOW VARIABLES LIKE 'innodb_log_file_size';
Variable_name	Value
innodb_log_file_size	5242880
FOUND 1 /InnoDB: Resized log to 6\.000MiB/ in mysqld.1.err
DROP TABLE t;
