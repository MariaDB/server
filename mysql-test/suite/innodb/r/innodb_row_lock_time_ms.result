CREATE TABLE `t`(`id` INT, PRIMARY KEY(`id`)) ENGINE=InnoDB;
INSERT INTO t VALUES (1);
BEGIN;
SELECT * FROM t FOR UPDATE;
id
1
connect con1,localhost,root,,;
SET innodb_lock_wait_timeout = 1;
SELECT * FROM t FOR UPDATE;
ERROR HY000: Lock wait timeout exceeded; try restarting transaction
SELECT * FROM t FOR UPDATE;
ERROR HY000: Lock wait timeout exceeded; try restarting transaction
disconnect con1;
connection default;
SELECT variable_value > 500 FROM information_schema.global_status
WHERE LOWER(variable_name) = 'innodb_row_lock_time';
variable_value > 500
1
SELECT variable_value > 500 FROM information_schema.global_status
WHERE LOWER(variable_name) = 'innodb_row_lock_time_max';
variable_value > 500
1
SELECT variable_value > 500 FROM information_schema.global_status
WHERE LOWER(variable_name) = 'innodb_row_lock_time_avg';
variable_value > 500
1
SELECT COUNT > 500, MAX_COUNT > 500, AVG_COUNT > 500 FROM INFORMATION_SCHEMA.INNODB_METRICS
WHERE NAME="lock_row_lock_time";
COUNT > 500	MAX_COUNT > 500	AVG_COUNT > 500
1	1	1
SELECT COUNT > 500, MAX_COUNT > 500, MIN_COUNT > 500 FROM INFORMATION_SCHEMA.INNODB_METRICS
WHERE NAME="lock_row_lock_time_max";
COUNT > 500	MAX_COUNT > 500	MIN_COUNT > 500
1	1	1
SELECT COUNT > 500, MAX_COUNT > 500, MIN_COUNT > 500 FROM INFORMATION_SCHEMA.INNODB_METRICS
WHERE NAME="lock_row_lock_time_avg";
COUNT > 500	MAX_COUNT > 500	MIN_COUNT > 500
1	1	1
DROP TABLE t;
