#
# MDEV-28800 SIGABRT due to running out of memory for InnoDB locks
#
SET @save_ahi=@@GLOBAL.innodb_adaptive_hash_index;
SET GLOBAL innodb_adaptive_hash_index=OFF;
CREATE TABLE t1 (col1 INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1),(2),(3),(4);
INSERT INTO t1 SELECT * FROM t1;
INSERT INTO t1 SELECT * FROM t1;
START TRANSACTION;
INSERT INTO t1 SELECT a.* FROM t1 a, t1 b, t1 c, t1 d;
SELECT CASE WHEN (POOL_SIZE - (FREE_BUFFERS + DATABASE_PAGES)) <= 10 THEN "PASSED"
            ELSE (POOL_SIZE - (FREE_BUFFERS + DATABASE_PAGES)) END
FROM information_schema.innodb_buffer_pool_stats;
CASE WHEN (POOL_SIZE - (FREE_BUFFERS + DATABASE_PAGES)) <= 10 THEN "PASSED"
            ELSE (POOL_SIZE - (FREE_BUFFERS + DATABASE_PAGES)) END
PASSED
COMMIT;
SELECT COUNT(*) FROM t1;
COUNT(*)
65552
DROP TABLE t1;
SET GLOBAL innodb_adaptive_hash_index=@save_ahi;
