CREATE TABLE t(a INT PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t VALUES (3);
BEGIN;
UPDATE t SET a = 2;
connect con1,localhost,root;
SET DEBUG_SYNC="lock_wait_start SIGNAL del_locked";
DELETE FROM t;
connection default;
SET DEBUG_SYNC="now WAIT_FOR del_locked";
UPDATE t SET a = 1;
COMMIT;
connection con1;
disconnect con1;
connection default;
# The UPDATE changes the PK from 3 to 2 to 1, moving the row behind
# the DELETE scan cursor. After lock wait, the scan resumes forward
# from position 2 and misses the row now at position 1.
SELECT count(*) FROM t;
count(*)
1
SET DEBUG_SYNC="reset";
DROP TABLE t;
