CREATE TABLE t_2_9(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_9 SET a = 10;
CREATE TABLE t_2_8(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_8 SET a = 10;
CREATE TABLE t_2_7(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_7 SET a = 10;
CREATE TABLE t_2_6(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_6 SET a = 10;
CREATE TABLE t_2_5(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_5 SET a = 10;
CREATE TABLE t_2_4(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_4 SET a = 10;
CREATE TABLE t_2_3(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_3 SET a = 10;
CREATE TABLE t_2_2(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_2 SET a = 10;
CREATE TABLE t_2_1(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_1 SET a = 10;
CREATE TABLE t_1_0(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_1_0 SET a = 10;
CREATE TABLE t_2_0(a INT primary key) Engine=InnoDB STATS_PERSISTENT=0;
INSERT INTO t_2_0 SET a = 10;
InnoDB		0 transactions not purged
connect  prevent_purge,localhost,root,,;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
SET GLOBAL DEBUG_DBUG ="+d,assign_same_rseg";
connection default;
UPDATE t_2_1 SET a=150;
connect  con_1_0, localhost,root,,;
BEGIN;
UPDATE t_1_0 SET a=15;
connect  con_2_0, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_0 WAIT_FOR cont_0";
SET DEBUG_SYNC="after_undo_log_trx_id_write SIGNAL after_0";
UPDATE t_2_0 SET a=15;
connection con_1_0;
SET DEBUG_SYNC="now WAIT_FOR before_0";
connect  con_2_1, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_1 WAIT_FOR cont_1";
UPDATE t_2_1 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_1";
connect  con_2_2, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_2 WAIT_FOR cont_2";
UPDATE t_2_2 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_2";
connect  con_2_3, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_3 WAIT_FOR cont_3";
UPDATE t_2_3 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_3";
connect  con_2_4, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_4 WAIT_FOR cont_4";
UPDATE t_2_4 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_4";
connect  con_2_5, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_5 WAIT_FOR cont_5";
UPDATE t_2_5 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_5";
connect  con_2_6, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_6 WAIT_FOR cont_6";
UPDATE t_2_6 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_6";
connect  con_2_7, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_7 WAIT_FOR cont_7";
UPDATE t_2_7 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_7";
connect  con_2_8, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_8 WAIT_FOR cont_8";
UPDATE t_2_8 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_8";
connect  con_2_9, localhost,root,,;
BEGIN;
SET DEBUG_SYNC="before_undo_log_trx_id_write SIGNAL before_9 WAIT_FOR cont_9";
UPDATE t_2_9 SET a=15;
connection default;
SET DEBUG_SYNC="now WAIT_FOR before_9";
connection con_1_0;
COMMIT;
SET DEBUG_SYNC="now SIGNAL cont_0";
SET DEBUG_SYNC="now WAIT_FOR after_0";
# Kill and restart
INSERT INTO t_2_1 SET a = 20;
INSERT INTO t_2_1 SET a = 30;
INSERT INTO t_2_1 SET a = 40;
INSERT INTO t_2_1 SET a = 50;
INSERT INTO t_2_1 SET a = 60;
SET GLOBAL innodb_max_purge_lag_wait=0;
DROP TABLE t_2_9;
DROP TABLE t_2_8;
DROP TABLE t_2_7;
DROP TABLE t_2_6;
DROP TABLE t_2_5;
DROP TABLE t_2_4;
DROP TABLE t_2_3;
DROP TABLE t_2_2;
DROP TABLE t_2_1;
DROP TABLE t_1_0;
DROP TABLE t_2_0;
