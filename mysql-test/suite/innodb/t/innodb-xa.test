--source include/have_innodb.inc

--error ER_XAER_NOTA
xa rollback 'xid2';
drop table if exists t1;
create table t1(a int)engine=innodb;
rollback;
xa start 'xid2';
insert into `t1` values (1);
savepoint `sv1`;
xa end 'xid2';
--error ER_XAER_RMFAIL
start transaction;
xa prepare 'xid2';
release savepoint `sv1`;
xa commit 'xid2';
drop table t1;

-- echo #
-- echo # MDEV-31928 Assertion xid ... < 128 failed in trx_undo_write_xid()
-- echo #

CREATE TABLE t (a INT PRIMARY KEY) ENGINE=INNODB;
--error ER_PARSE_ERROR
XA START 'gtrid_67890123456789012345678901234567890123456789012345678901234','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA START 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_67890123456789012345678901234567890123456789012345678901234',1234567890;
XA START 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;

INSERT INTO t VALUES(1);

--error ER_PARSE_ERROR
XA END 'gtrid_67890123456789012345678901234567890123456789012345678901234','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA END 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_67890123456789012345678901234567890123456789012345678901234',1234567890;
XA END 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA PREPARE 'gtrid_67890123456789012345678901234567890123456789012345678901234','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA PREPARE 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_67890123456789012345678901234567890123456789012345678901234',1234567890;
XA PREPARE 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA COMMIT 'gtrid_67890123456789012345678901234567890123456789012345678901234','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;
--error ER_PARSE_ERROR
XA COMMIT 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_67890123456789012345678901234567890123456789012345678901234',1234567890;
XA COMMIT 'gtrid_6789012345678901234567890123456789012345678901234567890123','bqual_6789012345678901234567890123456789012345678901234567890123',1234567890;

DROP TABLE t;

-- echo # End of 10.4 tests
