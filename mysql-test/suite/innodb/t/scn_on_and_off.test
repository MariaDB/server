--source include/not_embedded.inc
--source include/have_innodb.inc
--source include/have_innodb_scn.inc

--echo #
--echo # Test different value of innodb_use_scn
--echo #

create table t1(id int, c1 int) engine=innodb;
insert into t1 value(1,1);
insert into t1 value(2,1);
insert into t1 value(3,1);
update t1 set c1=2 where id=1;
update t1 set c1=2 where id=2;
check table t1;
SET GLOBAL innodb_fast_shutdown=0;

--source include/shutdown_mysqld.inc
--let $restart_parameters= --innodb-use-scn=ON
--source include/start_mysqld.inc
show variables like '%use_scn%';

insert into t1 values(4,1);
update t1 set c1=2 where id=3;
update t1 set c1=4 where id=3;
check table t1;
--source include/wait_all_purged.inc

--source include/shutdown_mysqld.inc
--let $restart_parameters= --innodb-use-scn=OFF
--source include/start_mysqld.inc
show variables like '%use_scn%';
insert into t1 values(5,1);
update t1 set c1=2 where id=4;
check table t1 extended;
--source include/wait_all_purged.inc

--source include/shutdown_mysqld.inc
--let $restart_parameters= --innodb-use-scn=ON
--source include/start_mysqld.inc
show variables like '%use_scn%';
insert into t1 values(6,1);
update t1 set c1=2 where id=5;
check table t1;
--source include/wait_all_purged.inc

--source include/shutdown_mysqld.inc
--let $restart_parameters=
--source include/start_mysqld.inc
insert into t1 values(7,1);
update t1 set c1=2 where id=6;
check table t1;

drop table t1;
--source include/wait_all_purged.inc
