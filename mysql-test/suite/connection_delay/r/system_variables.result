#-----------------------------------------------------------------------
# Setup
CREATE USER no_privs@localhost IDENTIFIED BY 'abcd';
connect conn_no_privs, localhost, no_privs, abcd,,,,;
connection default;
#-----------------------------------------------------------------------
# Case 1 : failed_connections_threshold
SET @saved_value = @@global.failed_connections_threshold;
SELECT @saved_value;
@saved_value
0
SET @@global.failed_connections_threshold = @saved_value;
# 1.1 : Setting failed_connections_threshold to valid
#       value
SET @@global.failed_connections_threshold = 20;
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
20
SET @@global.failed_connections_threshold = 2000;
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
2000
SET @@global.failed_connections_threshold = 2147483647;
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
2147483647
SET @@global.failed_connections_threshold = DEFAULT;
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
SET @@global.failed_connections_threshold = -20;
Warnings:
Warning	1292	Truncated incorrect failed_connections_threshold value: '-20'
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
SET @@global.failed_connections_threshold = 9223372036854775808;
Warnings:
Warning	1292	Truncated incorrect failed_connections_threshold value: '9223372036854775808'
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
4294967295
SET @@global.failed_connections_threshold = -9223372036854775808;
Warnings:
Warning	1292	Truncated incorrect failed_connections_threshold value: '-9223372036854775808'
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
# 1.2 : Setting failed_connections_threshold to
#       invalid value
SET @@global.failed_connections_threshold = NULL;
ERROR 42000: Incorrect argument type to variable 'failed_connections_threshold'
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
SET @@global.failed_connections_threshold = `SELECT * FROM mysql.user`;
ERROR 42000: Incorrect argument type to variable 'failed_connections_threshold'
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
# Switch to conn_no_privs
connection conn_no_privs;
# 1.3 : Use no_privs@localhost to set
#       failed_connections_threshold to valid value
SET @@global.failed_connections_threshold = 2147483647;
ERROR 42000: Access denied; you need (at least one of) the SUPER privilege(s) for this operation
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
SET @@global.failed_connections_threshold = DEFAULT;
ERROR 42000: Access denied; you need (at least one of) the SUPER privilege(s) for this operation
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
# 1.4 : Use no_privs@localhost to set
#       failed_connections_threshold to invalid value
SET @@global.failed_connections_threshold = NULL;
ERROR 42000: Access denied; you need (at least one of) the SUPER privilege(s) for this operation
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
SET @@global.failed_connections_threshold = 9223372036854775808;
ERROR 42000: Access denied; you need (at least one of) the SUPER privilege(s) for this operation
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
connection default;
SET @@global.failed_connections_threshold = @saved_value;
SELECT @@global.failed_connections_threshold;
@@global.failed_connections_threshold
0
#-----------------------------------------------------------------------
# Cleanup
disconnect conn_no_privs;
DROP USER no_privs@localhost;
#-----------------------------------------------------------------------
