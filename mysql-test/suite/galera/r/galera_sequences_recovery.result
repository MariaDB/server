connection node_2;
connection node_1;
connection node_1;
CREATE SEQUENCE s INCREMENT=0 CACHE=5 ENGINE=InnoDB;
CREATE TABLE t1 (f1 INT PRIMARY KEY DEFAULT NEXTVAL(s), f2 INT) ENGINE=InnoDB;
connection node_1;
BEGIN;
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
connection node_2;
BEGIN;
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
Killing server ...
SELECT NEXTVAL(s);
NEXTVAL(s)
12
connection node_1;
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
COMMIT;
SELECT LASTVAL(s);
LASTVAL(s)
29
SELECT * FROM t1;
f1	f2
1	1
3	1
5	1
7	1
9	1
21	1
23	1
25	1
27	1
29	1
connection node_2;
SELECT LASTVAL(s);
LASTVAL(s)
12
SELECT NEXTVAL(s);
NEXTVAL(s)
32
SELECT * FROM t1;
f1	f2
1	1
3	1
5	1
7	1
9	1
21	1
23	1
25	1
27	1
29	1
connection node_1;
DROP TABLE t1;
DROP SEQUENCE s;
connection node_1;
CREATE SEQUENCE s INCREMENT=0 CACHE=5 ENGINE=InnoDB;
CREATE TABLE t1 (f1 INT PRIMARY KEY DEFAULT NEXTVAL(s), f2 INT) ENGINE=InnoDB;
connection node_1;
BEGIN;
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
connection node_2;
BEGIN;
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
INSERT INTO t1(f2) values (2);
Killing server ...
connection node_1;
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
INSERT INTO t1(f2) values (1);
COMMIT;
SELECT LASTVAL(s);
LASTVAL(s)
19
SELECT * FROM t1;
f1	f2
1	1
3	1
5	1
7	1
9	1
11	1
13	1
15	1
17	1
19	1
connection node_2;
SELECT NEXTVAL(s);
NEXTVAL(s)
22
SELECT * FROM t1;
f1	f2
1	1
3	1
5	1
7	1
9	1
11	1
13	1
15	1
17	1
19	1
connection node_1;
SELECT LASTVAL(s);
LASTVAL(s)
19
SELECT NEXTVAL(s);
NEXTVAL(s)
33
connection node_1;
DROP TABLE t1;
DROP SEQUENCE s;
