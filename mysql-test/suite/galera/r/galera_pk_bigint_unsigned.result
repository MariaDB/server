CREATE TABLE t1 (f1 BIGINT UNSIGNED PRIMARY KEY, f2 VARCHAR(5)) ENGINE=InnoDB;
INSERT INTO t1 VALUES
(18446744073709551615, 'max')
;
connection node_2;
SELECT f1 = 18446744073709551615 FROM t1;
f1 = 18446744073709551615
1
UPDATE t1 SET f2 = CONCAT(f2, '_');
connection node_1;
SELECT f1 = 18446744073709551615 FROM t1;
f1 = 18446744073709551615
1
connection node_1;
SET AUTOCOMMIT=OFF;
START TRANSACTION;
UPDATE t1 SET f2 = 'foo' WHERE f1 = 18446744073709551615;
connection node_2;
SET AUTOCOMMIT=OFF;
START TRANSACTION;
UPDATE t1 SET f2 = 'bar' WHERE f1 = 18446744073709551615;
connection node_1;
COMMIT;
SET AUTOCOMMIT=ON;
connection node_2;
COMMIT;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
SET AUTOCOMMIT=ON;
DROP TABLE t1;
