connection node_2;
connection node_1;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) ENGINE=InnoDB;
connection node_1;
SET SESSION wsrep_retry_autocommit = 0;
SET SESSION DEBUG_SYNC = "wsrep_after_trans_register_ha SIGNAL reached WAIT_FOR continue";
INSERT INTO t1 VALUES (1);
connect node_1_ctrl, 127.0.0.1, root, , test, $NODE_MYPORT_1;
SET DEBUG_SYNC = "now WAIT_FOR reached";
SET GLOBAL DEBUG_DBUG = "+d,sync.wsrep_abort_transaction_read_only";
connection node_2;
ALTER TABLE t1 ADD COLUMN f2 INT;
connection node_1_ctrl;
SET DEBUG_SYNC = "now WAIT_FOR sync.wsrep_abort_transaction_read_only_reached";
SET DEBUG_SYNC = "now SIGNAL continue";
SET DEBUG_SYNC = "now SIGNAL signal.wsrep_abort_transaction_read_only";
connection node_1;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
SET DEBUG_SYNC = "RESET";
DROP TABLE t1;
