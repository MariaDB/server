connection node_2;
connection node_1;
connection node_2;
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
10240
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
204800
CREATE TABLE t1(a int not null primary key auto_increment, count int) engine=innodb;
# Change file size larger
SET GLOBAL wsrep_buffered_error_log_file_size=262144;
# List error log files - should have 4 files
galera_buffered_error_log.err
galera_buffered_error_log.err.1
galera_buffered_error_log.err.2
galera_buffered_error_log.err.3
Testing that old log contains something logged
FOUND 1 /WSREP: Loading provider/ in galera_buffered_error_log.err.3
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
10240
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
262144
SELECT COUNT(*) AS EXPECT_2000 FROM t1;
EXPECT_2000
2000
DROP TABLE t1;
# Change file size smaller
SET GLOBAL wsrep_buffered_error_log_file_size=131072;
# List error log files - should be 6 files
galera_buffered_error_log.err
galera_buffered_error_log.err.1
galera_buffered_error_log.err.2
galera_buffered_error_log.err.3
galera_buffered_error_log.err.4
galera_buffered_error_log.err.5
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
10240
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
131072
# Try to change buffer size to unsupported size i.e too small
SET GLOBAL wsrep_buffered_error_log_file_size=1024;
ERROR 42000: Variable 'wsrep_buffered_error_log_file_size' can't be set to the value of '1024'
# Reset file size to original size
SET GLOBAL wsrep_buffered_error_log_file_size=204800;
# List error log files - should be 6 files
galera_buffered_error_log.err
galera_buffered_error_log.err.1
galera_buffered_error_log.err.2
galera_buffered_error_log.err.3
galera_buffered_error_log.err.4
galera_buffered_error_log.err.5
