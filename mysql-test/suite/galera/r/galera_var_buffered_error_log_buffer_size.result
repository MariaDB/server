connection node_2;
connection node_1;
connection node_2;
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
32768
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
4194304
CREATE TABLE t1(a int not null primary key) engine=innodb;
INSERT INTO t1 SELECT * FROM seq_1_to_1000;
# Change buffer size larger
SET GLOBAL wsrep_buffered_error_log_buffer_size=65536;
Testing that old log contains something logged
FOUND 1 /WSREP: Loading provider/ in galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
65536
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
4194304
SELECT COUNT(*) AS EXPECT_1000 FROM t1;
EXPECT_1000
1000
DROP TABLE t1;
# Change buffer size smaller
SET GLOBAL wsrep_buffered_error_log_buffer_size=32768;
Testing that log contains something logged
FOUND 4 /DROP TABLE/ in galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
32768
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
4194304
# Try to change buffer size to unsupported size i.e too large
SET GLOBAL wsrep_buffered_error_log_buffer_size=4194400;
ERROR 42000: Variable 'wsrep_buffered_error_log_buffer_size' can't be set to the value of '4194400'
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
32768
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
4194304
# Try to change buffer size to unsupported size i.e too small
SET GLOBAL wsrep_buffered_error_log_buffer_size=8196;
ERROR 42000: Variable 'wsrep_buffered_error_log_buffer_size' can't be set to the value of '8196'
SELECT @@global.wsrep_buffered_error_log_filename;
@@global.wsrep_buffered_error_log_filename
galera_buffered_error_log.err
SELECT @@global.wsrep_buffered_error_log_buffer_size;
@@global.wsrep_buffered_error_log_buffer_size
32768
SELECT @@global.wsrep_buffered_error_log_file_size;
@@global.wsrep_buffered_error_log_file_size
4194304
# Reset buffer size to original size
SET GLOBAL wsrep_buffered_error_log_buffer_size=32768;
