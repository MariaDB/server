connection node_2;
connection node_1;
connect bf_trx, 127.0.0.1, root, , test, $NODE_MYPORT_1;
connect victim_trx, 127.0.0.1, root, , test, $NODE_MYPORT_2;
connect node_2_ctrl, 127.0.0.1, root, , test, $NODE_MYPORT_2;
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) ENGINE=InnoDB;
connection victim_trx;
START TRANSACTION;
INSERT INTO t1 VALUES (2), (1);
connection node_2_ctrl;
SET GLOBAL debug_dbug = '+d,sync.wsrep_apply_cb';
connection bf_trx;
INSERT INTO t1 VALUES (1), (2);
connection node_2_ctrl;
SET DEBUG_SYNC = "now WAIT_FOR sync.wsrep_apply_cb_reached";
SET GLOBAL debug_dbug = '';
connection victim_trx;
SET DEBUG_SYNC = "wsrep_at_dispatch_end_before_result SIGNAL signal.wsrep_apply_cb WAIT_FOR bf_abort";
COMMIT;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
SET DEBUG_SYNC = 'RESET';
DROP TABLE t1;
