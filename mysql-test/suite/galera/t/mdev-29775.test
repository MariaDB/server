--source include/galera_cluster.inc

#
# MDEV-29775 : Assertion `0' failed in void Protocol::end_statement() when adding data to the MyISAM table after setting wsrep_mode=replicate_myisam
#
SET GLOBAL wsrep_replicate_myisam=ON;
CREATE TABLE t (f0 CHAR(0)) ENGINE=MyISAM;
INSERT INTO t VALUES();
SELECT * FROM t;
--connection node_2
SELECT * FROM t;
DROP TABLE t;

--connection node_1
SET GLOBAL wsrep_replicate_myisam=ON;
SET GLOBAL wsrep_forced_binlog_format=ROW;
CREATE TABLE t (f0 CHAR(0)) ENGINE=MyISAM;
INSERT INTO t VALUES();
SELECT * FROM t;
--connection node_2
SELECT * FROM t;
DROP TABLE t;

--connection node_1
SET GLOBAL wsrep_forced_binlog_format=DEFAULT;
SET GLOBAL wsrep_replicate_myisam=OFF;

SET GLOBAL wsrep_forced_binlog_format=MIXED;
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_replicate_myisam=ON;
SET GLOBAL wsrep_forced_binlog_format=STATEMENT;
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_replicate_myisam=ON;

SET GLOBAL wsrep_forced_binlog_format=NONE;
SET GLOBAL wsrep_replicate_myisam=OFF;

SET GLOBAL wsrep_replicate_myisam=ON;
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_forced_binlog_format=MIXED;
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_forced_binlog_format=STATEMENT;

SET GLOBAL wsrep_forced_binlog_format=NONE;
SET GLOBAL wsrep_replicate_myisam=OFF;
