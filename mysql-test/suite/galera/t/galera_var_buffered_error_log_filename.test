--source include/galera_cluster.inc
--source include/have_sequence.inc

--connection node_2
--replace_regex /.*galera_buffered_error_log.err.*/galera_buffered_error_log.err/
SELECT @@global.wsrep_buffered_error_log_filename;
SELECT @@global.wsrep_buffered_error_log_buffer_size;
SELECT @@global.wsrep_buffered_error_log_file_size;

CREATE TABLE t1(a int not null primary key) engine=innodb;
INSERT INTO t1 SELECT * FROM seq_1_to_1000;

--echo # Change file name
--disable_query_log
--eval SET GLOBAL wsrep_buffered_error_log_filename="galera_buffered_error_log2.err"
--enable_query_log

--echo Testing that old log contains something logged
--let SEARCH_FILE= $MYSQLTEST_VARDIR/mysqld.2/data/galera_buffered_error_log.err
--let ABORT_ON = NOT_FOUND
--let SEARCH_PATTERN=WSREP: Loading provider
--source include/search_pattern_in_file.inc

--replace_regex /.*galera_buffered_error_log2.err.*/galera_buffered_error_log2.err/
SELECT @@global.wsrep_buffered_error_log_filename;
SELECT @@global.wsrep_buffered_error_log_buffer_size;
SELECT @@global.wsrep_buffered_error_log_file_size;

SELECT COUNT(*) AS EXPECT_1000 FROM t1;
DROP TABLE t1;

--echo # Change file name back to original
--disable_query_log
--eval SET GLOBAL wsrep_buffered_error_log_filename="galera_buffered_error_log.err"
--enable_query_log

--echo Testing that second log contains something logged
--let SEARCH_FILE= $MYSQLTEST_VARDIR/mysqld.2/data/galera_buffered_error_log2.err
--let ABORT_ON = NOT_FOUND
--let SEARCH_PATTERN=DROP TABLE
--source include/search_pattern_in_file.inc
