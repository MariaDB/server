--source include/galera_cluster.inc
--source include/have_innodb.inc

CREATE TABLE t1 (a INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1),(2);
CREATE TABLE t2 (a INT) ENGINE=Aria;
CREATE TRIGGER trg AFTER UPDATE ON t1 FOR EACH ROW INSERT INTO t2 VALUES (NEW.a);
SET GLOBAL wsrep_mode=replicate_aria;
--error ER_ERROR_DURING_COMMIT
UPDATE t1 SET a=10;
SELECT * FROM t1;
SELECT * FROM t2;

--connection node_2
SELECT * FROM t1;
SELECT * FROM t2;

--connection node_1
DROP TRIGGER trg;
DROP TABLE t1,t2;

CREATE TABLE t1 (a INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1),(2);
CREATE TABLE t2 (a INT) ENGINE=InnoDB;
CREATE TRIGGER trg AFTER UPDATE ON t1 FOR EACH ROW INSERT INTO t2 VALUES (NEW.a);
UPDATE t1 SET a=10;
SELECT * FROM t1;
SELECT * FROM t2;

--connection node_2
SELECT * FROM t1;
SELECT * FROM t2;

--connection node_1
DROP TRIGGER trg;
DROP TABLE t1,t2;

call mtr.add_suppression("WSREP: Replication of non-transactional engines is experimental. Storage engine Aria for table \'test\'\.\'t2\' is not supported in Galera");
SET GLOBAL wsrep_mode=DEFAULT;
