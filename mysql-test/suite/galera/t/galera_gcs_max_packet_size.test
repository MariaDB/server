#
# Test fragmentation by setting gcs.max_packet_size to a low value
# The actual setting is performed in galera_gcs_max_packet_size.cnf
# as gcs.max_packet_size is not a dynamic variable
#

--source include/galera_cluster.inc
--source include/have_innodb.inc
--source include/big_test.inc

CREATE TABLE ten (f1 INTEGER);
INSERT INTO ten VALUES (1), (2), (3), (4), (5), (6), (7), (8), (9), (10);

CREATE TABLE t1 (f1 INT PRIMARY KEY AUTO_INCREMENT, f2 INTEGER) ENGINE=InnoDB;
CREATE TABLE t2 (f1 VARCHAR(512) UNIQUE) ENGINE=InnoDB;

INSERT INTO t1 (f2) SELECT 1 FROM ten AS a1, ten AS a2, ten AS a3, ten AS a4;
INSERT INTO t2 VALUES (REPEAT('x', 512));

--connection node_2
SELECT COUNT(*) = 10000 FROM t1;
SELECT LENGTH(f1) = 512 FROM t2 WHERE f1 = REPEAT('x', 512);

DROP TABLE t1;
DROP TABLE t2;
DROP TABLE ten;
