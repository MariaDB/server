#
# Test multi-table DELETE in the presence of FKs
#

--source include/galera_cluster.inc
--source include/have_innodb.inc

CREATE TABLE t0 (
    f0 INT PRIMARY KEY
);

CREATE TABLE t1 (
    f1 INT PRIMARY KEY,
    f0 INTEGER,
    FOREIGN KEY (f0)
        REFERENCES t0(f0)
        ON DELETE CASCADE
);

INSERT INTO t0 VALUES (0), (1);
INSERT INTO t1 VALUES (0, 0);
INSERT INTO t1 VALUES (1, 0);

--connection node_2
DELETE t0.*, t1.* FROM t0, t1 WHERE t0.f0 = 0 AND t1.f1 = 0;

--connection node_1
SELECT COUNT(*) = 1 FROM t0;
SELECT COUNT(*) = 0 FROM t1;

DROP TABLE t1;
DROP TABLE t0;
