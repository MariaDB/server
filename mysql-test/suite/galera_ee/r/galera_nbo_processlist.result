SELECT COUNT(*) = 3 FROM INFORMATION_SCHEMA.PROCESSLIST WHERE USER = 'system user';
COUNT(*) = 3
1
SET GLOBAL debug = 'd,sync.alter_opened_table';
SET SESSION wsrep_sync_wait = 0;
CREATE TABLE t1 (f1 INTEGER) ENGINE=InnoDB;
CREATE TABLE t2 (f1 INTEGER) ENGINE=InnoDB;
SET SESSION wsrep_osu_method='NBO';
ALTER TABLE t1 LOCK=SHARED, ADD COLUMN f2 INTEGER;;
SELECT COUNT(*) = 1 FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE USER = 'system user'
AND STATE = 'debug sync point: now'
AND INFO = 'ALTER TABLE t1 LOCK=SHARED, ADD COLUMN f2 INTEGER';
COUNT(*) = 1
1
SELECT COUNT(*) = 1 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 't1';
COUNT(*) = 1
1
ERROR HYN: You are not owner of thread N
ERROR HYN: You are not owner of thread N
SET DEBUG_SYNC= 'now SIGNAL signal.alter_opened_table';
SET SESSION wsrep_sync_wait = 7;
SELECT COUNT(*) = 0 FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE USER = 'system user'
AND STATE = 'debug sync point: now'
AND INFO = 'ALTER TABLE t1 ADD COLUMN f2 INTEGER';
COUNT(*) = 0
1
SELECT COUNT(*) = 2 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 't1';
COUNT(*) = 2
1
INSERT INTO t1 VALUES (1,2);
ALTER TABLE t1 LOCK=SHARED, ADD COLUMN t3 INTEGER;
DROP TABLE t1;
DROP TABLE t2;
