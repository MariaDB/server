CREATE TABLE t1 (f1 INTEGER PRIMARY KEY, f2 BLOB) ENGINE=InnoDB;
SET SESSION wsrep_on=OFF;
INSERT INTO t1 VALUES (5, 'X');
SET SESSION wsrep_on=ON;
DELETE FROM t1 WHERE f1 = 2;
SET AUTOCOMMIT=OFF;
SET SESSION wsrep_trx_fragment_size = 131070;
START TRANSACTION;
INSERT INTO t1 VALUES (1, REPEAT('A', 65535));
INSERT INTO t1 VALUES (2, REPEAT('A', 65535));
INSERT INTO t1 VALUES (3, REPEAT('A', 65535));
INSERT INTO t1 VALUES (4, REPEAT('A', 65535));
INSERT INTO t1 VALUES (5, REPEAT('A', 65535));
COMMIT;
SELECT COUNT(*) = 0 FROM mysql.wsrep_streaming_log;
COUNT(*) = 0
1
START TRANSACTION;
INSERT INTO t1 VALUES (11, REPEAT('A', 65535));
INSERT INTO t1 VALUES (12, REPEAT('A', 65535));
INSERT INTO t1 VALUES (13, REPEAT('A', 65535));
INSERT INTO t1 VALUES (14, REPEAT('A', 65535));
INSERT INTO t1 VALUES (15, REPEAT('A', 65535));
SET SESSION wsrep_on=OFF;
Starting mysqld
SELECT COUNT(*) > 0 FROM mysql.wsrep_streaming_log;
COUNT(*) > 0
1
COMMIT;
SELECT COUNT(*) = 0 FROM mysql.wsrep_streaming_log;
COUNT(*) = 0
1
SELECT COUNT(*) = 10 FROM t1;
COUNT(*) = 10
1
SELECT COUNT(*) = 0 FROM mysql.wsrep_streaming_log;
COUNT(*) = 0
1
SELECT COUNT(*) = 10 FROM t1;
COUNT(*) = 10
1
CALL mtr.add_suppression("Slave SQL: Could not execute Write_rows event on table test.t1; Duplicate entry '5' for key 'PRIMARY'");
CALL mtr.add_suppression("Write_rows apply failed");
CALL mtr.add_suppression("Inconsistent by consensus");
CALL mtr.add_suppression("no THD for trx");
SELECT COUNT(*) = 0 FROM mysql.wsrep_streaming_log;
COUNT(*) = 0
1
SELECT COUNT(*) = 10 FROM t1;
COUNT(*) = 10
1
DROP TABLE t1;
