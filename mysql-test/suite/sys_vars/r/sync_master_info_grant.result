#
# MDEV-21969 Bind REPLICATION SLAVE ADMIN to relay_log_*, sync_master_info, sync_relay_log, sync_relay_log_info
#
SET @global=@@global.sync_master_info;
# Test that "SET sync_master_info" is not allowed without REPLICATION SLAVE ADMIN or SUPER
CREATE USER user1@localhost;
GRANT ALL PRIVILEGES ON *.* TO user1@localhost;
REVOKE REPLICATION SLAVE ADMIN, SUPER ON *.* FROM user1@localhost;
connect user1,localhost,user1,,;
connection user1;
SET GLOBAL sync_master_info=20000;
ERROR 42000: Access denied; you need (at least one of) the SUPER, REPLICATION SLAVE ADMIN privilege(s) for this operation
SET sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
SET SESSION sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
disconnect user1;
connection default;
DROP USER user1@localhost;
# Test that "SET sync_master_info" is allowed with REPLICATION SLAVE ADMIN
CREATE USER user1@localhost;
GRANT REPLICATION SLAVE ADMIN ON *.* TO user1@localhost;
connect user1,localhost,user1,,;
connection user1;
SET GLOBAL sync_master_info=20000;
SET sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
SET SESSION sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
disconnect user1;
connection default;
DROP USER user1@localhost;
# Test that "SET sync_master_info" is allowed with SUPER
CREATE USER user1@localhost;
GRANT SUPER ON *.* TO user1@localhost;
connect user1,localhost,user1,,;
connection user1;
SET GLOBAL sync_master_info=20000;
SET sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
SET SESSION sync_master_info=20000;
ERROR HY000: Variable 'sync_master_info' is a GLOBAL variable and should be set with SET GLOBAL
disconnect user1;
connection default;
DROP USER user1@localhost;
SET @@global.sync_master_info=@global;
