# MDEV-18983: @@rpl_semi_sync_master_wait_for_slave_count privilege test
SET @global=@@global.rpl_semi_sync_master_wait_for_slave_count;
# Test that "SET rpl_semi_sync_master_wait_for_slave_count" is not allowed without REPLICATION MASTER ADMIN
CREATE USER user1@localhost;
GRANT ALL PRIVILEGES ON *.* TO user1@localhost;
REVOKE REPLICATION MASTER ADMIN ON *.* FROM user1@localhost;
connect user1,localhost,user1,,;
connection user1;
SET GLOBAL rpl_semi_sync_master_wait_for_slave_count=2;
ERROR 42000: Access denied; you need (at least one of) the REPLICATION MASTER ADMIN privilege(s) for this operation
SET rpl_semi_sync_master_wait_for_slave_count=2;
ERROR HY000: Variable 'rpl_semi_sync_master_wait_for_slave_count' is a GLOBAL variable and should be set with SET GLOBAL
SET SESSION rpl_semi_sync_master_wait_for_slave_count=2;
ERROR HY000: Variable 'rpl_semi_sync_master_wait_for_slave_count' is a GLOBAL variable and should be set with SET GLOBAL
disconnect user1;
connection default;
DROP USER user1@localhost;
# Test that "SET rpl_semi_sync_master_wait_for_slave_count" is allowed with REPLICATION MASTER ADMIN
CREATE USER user1@localhost;
GRANT REPLICATION MASTER ADMIN ON *.* TO user1@localhost;
connect user1,localhost,user1,,;
connection user1;
SET GLOBAL rpl_semi_sync_master_wait_for_slave_count=2;
SET rpl_semi_sync_master_wait_for_slave_count=2;
ERROR HY000: Variable 'rpl_semi_sync_master_wait_for_slave_count' is a GLOBAL variable and should be set with SET GLOBAL
SET SESSION rpl_semi_sync_master_wait_for_slave_count=2;
ERROR HY000: Variable 'rpl_semi_sync_master_wait_for_slave_count' is a GLOBAL variable and should be set with SET GLOBAL
disconnect user1;
connection default;
DROP USER user1@localhost;
SET @@global.rpl_semi_sync_master_wait_for_slave_count=@global;
