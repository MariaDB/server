CREATE TABLE t1 (a INT) ENGINE=InnoDB;
#
# Test that SET @@session.server_id fails inside explicit transaction
#
BEGIN;
INSERT INTO t1 VALUES (1);
SET @@session.server_id = 100;
ERROR 25000: You are not allowed to execute this command in a transaction
ROLLBACK;
#
# Test that SET @@session.server_id works outside transaction
#
SET @@session.server_id = 100;
SELECT @@session.server_id;
@@session.server_id
100
#
# Test that SET @@session.server_id fails with autocommit=0
#
SET autocommit = 0;
INSERT INTO t1 VALUES (2);
SET @@session.server_id = 200;
ERROR 25000: You are not allowed to execute this command in a transaction
ROLLBACK;
SET autocommit = 1;
#
# Test that SET @@session.server_id works after COMMIT
#
BEGIN;
INSERT INTO t1 VALUES (3);
COMMIT;
SET @@session.server_id = 300;
SELECT @@session.server_id;
@@session.server_id
300
#
# Cleanup
#
DROP TABLE t1;
