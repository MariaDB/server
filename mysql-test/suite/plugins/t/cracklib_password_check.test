--source include/not_embedded.inc

if (!$CRACKLIB_PASSWORD_CHECK_SO) {
  skip No CRACKLIB_PASSWORD_CHECK plugin;
}

install soname "cracklib_password_check";

--vertical_results
--replace_result .dll .so
select * from information_schema.plugins where plugin_name='cracklib_password_check';
--horizontal_results

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foobar identified by 'foobar';
show warnings;

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foobar identified by 'raboof';
show warnings;

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foo@barbar identified by 'barbar';
show warnings;

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foo@foobar identified by 'foobar';
show warnings;

--error ER_NOT_VALID_PASSWORD
grant select on *.* to foobar identified by 'qwerty';
show warnings;

grant select on *.* to foobar identified by 'q$%^&*rty';
drop user foobar;

uninstall plugin cracklib_password_check;

create user foo1 identified by 'pwd';
drop user foo1;

