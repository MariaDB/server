#
# MDEV-34391 Path resolution
# Stored procedure tests with embedded PATH
#
SET sql_mode=ORACLE;
CREATE DATABASE test2;
CREATE FUNCTION test2.func2() RETURN TEXT
AS
BEGIN
RETURN 'test2.func2';
END;
/
CREATE DATABASE test3;
CREATE FUNCTION test3.func2() RETURN TEXT
AS
BEGIN
RETURN 'test3.func2';
END;
/
CREATE DATABASE test4;
CREATE FUNCTION test4.func4() RETURN TEXT
AS
BEGIN
RETURN 'test4.func4';
END;
/
#
# Embed a path in a stored procedure
#
CREATE PROCEDURE proc()
PATH 'test2'
AS
BEGIN
SELECT func2();
END;
/
CALL proc;
func2()
test2.func2
SET PATH 'test3';
CALL test.proc;
func2()
test2.func2
SET PATH 'CURRENT_SCHEMA,test3';
CALL proc;
func2()
test2.func2
DROP PROCEDURE proc;
SET PATH 'CURRENT_SCHEMA';
#
# Ensure that multiple references are resolved properly
#
CREATE PROCEDURE proc()
PATH 'test2'
AS
BEGIN
SELECT func2() || '+' || func2();
END;
/
CALL proc();
func2() || '+' || func2()
test2.func2+test2.func2
SET PATH 'test3';
CALL test.proc;
func2() || '+' || func2()
test2.func2+test2.func2
DROP PROCEDURE proc;
SET PATH 'CURRENT_SCHEMA';
#
# Use multiple schemas in embedded PATH
#
CREATE PROCEDURE proc()
PATH 'test2,test3,test4'
AS
BEGIN
SELECT func2() || '+' || func2() || '+' || func4();
END;
/
CALL proc();
func2() || '+' || func2() || '+' || func4()
test2.func2+test2.func2+test4.func4
SET PATH 'test3';
CALL test.proc;
func2() || '+' || func2() || '+' || func4()
test2.func2+test2.func2+test4.func4
DROP PROCEDURE proc;
SET PATH 'CURRENT_SCHEMA';
#
# Use empty PATH in stored routine (resolution should fail)
#
CREATE PROCEDURE proc()
PATH ''
AS
BEGIN
SELECT func2();
END;
/
CALL proc;
ERROR 42000: FUNCTION test.func2 does not exist
#
# ALTER PROCEDURE's previously empty PATH
#
ALTER PROCEDURE proc PATH 'test2';
CALL proc;
func2()
test2.func2
DROP PROCEDURE proc;
SET PATH 'CURRENT_SCHEMA';
DROP DATABASE test2;
DROP DATABASE test3;
DROP DATABASE test4;
