# Test script for an Oracle TO_DATE() function
# Testing of all format elements and various edge cases.

--enable_prepare_warnings

SET NAMES utf8;
SET time_zone=_latin1'+03:00';
# Ensure all date parts are consistent and different
SET timestamp=1100000000;
SELECT NOW();
select weekday(NOW());

SELECT TO_DATE('2025/10/26', 'YYYY/MM/DD') AS result;
SELECT TO_DATE('26-OCT-25', 'DD-MON-RR') AS result;
SELECT TO_DATE('October 26, 2025', 'MONTH DD, YYYY') AS result;

--echo # Two-Digit Year (RR)
SELECT TO_DATE('26-OCT-60', 'DD-MON-RR') AS result;
SELECT TO_DATE('26-OCT-25', 'DD-MON-RR') AS result;

--echo # Day of Year (DDD)
SELECT TO_DATE('2025-300', 'YYYY-DDD') AS result;

--echo # Time Formats (HH24, MI, SS)
SELECT TO_DATE('14:30:25', 'HH24:MI:SS') AS result;
SELECT TO_DATE('08:30:25', 'HH:MI:SS') AS result;
SELECT TO_DATE('08:30:25 PM', 'HH:MI:SS AM') AS result;

--echo # Day of Week (DAY, DY). Uses current day
SELECT TO_DATE('Tuesday', 'DAY') AS result;
SELECT TO_DATE('26-OCT-25 Sunday', 'DD-MON-YY DAY') AS result;

--echo # Month of Year (MONTH, MON)
SELECT TO_DATE('October', 'MONTH') AS result;
SELECT TO_DATE('Oct', 'MON') AS result;

--echo # Fractional Seconds (FF)
SELECT TO_DATE('2025-10-26 10:30:25.123456', 'YYYY-MM-DD HH:MI:SS.FF') AS result
;
SELECT TO_DATE('2025-10-26 10:30:25.123456', 'YYYY-MM-DD HH:MI:SS.FF6') AS result;
SELECT TO_DATE('2025-10-26 10:30:25.123', 'YYYY-MM-DD HH:MI:SS.FF') AS result;
SELECT TO_DATE('2025-10-26 10:30:25.12', 'YYYY-MM-DD HH:MI:SS.FF2') AS result;
SELECT TO_DATE('2025-10-26 10:30:25.129', 'YYYY-MM-DD HH:MI:SS.FF2') AS result;
SELECT TO_DATE('2025-10-26 10:30:123:34', 'YYYY-MM-DD HH:MI:FF3:SS') AS result;

# Tests to increase coverage
SELECT TO_DATE('0', 'YYY') AS result;
SELECT TO_DATE('25', 'YYY') AS result;
SELECT TO_DATE('1000', 'YYY') AS result;

SELECT TO_DATE('0', 'RRRR') AS result;
SELECT TO_DATE('25', 'RRRR') AS result;
SELECT TO_DATE('999', 'RRRR') AS result;
SELECT TO_DATE('1000-12', 'RRRR-MM') AS result;
SELECT TO_DATE('10000', 'RRRR') AS result;

SELECT TO_DATE('0', 'Y') AS result;
SELECT TO_DATE('1', 'Y') AS result;
SELECT TO_DATE('10', 'Y') AS result;

SELECT TO_DATE('Tue', 'DY');
SELECT TO_DATE('tue', 'DY');
SELECT TO_DATE('Mon', 'DY');

SET STATEMENT timestamp = UNIX_TIMESTAMP('2025-12-19') FOR SELECT TO_DATE('FRI', 'DY');

SET timestamp = DEFAULT;
CREATE TABLE t (d DATETIME, vd VARCHAR(32) AS (TO_DATE(d DEFAULT '2000-01-01' ON CONVERSION ERROR, 'YYYY-MM-DD')));
SHOW CREATE TABLE t;
DROP TABLE t;
# Restore test timestamp
SET timestamp=1100000000;

--echo #AD
SELECT TO_DATE('26-10-1000 AD', 'DD-MM-YYYY AD') AS result;
SELECT TO_DATE('26-10-1000 A.D.', 'DD-MM-YYYY A.D.') AS result;

--echo NULL
SELECT TO_DATE(NULL, 'YYYY-MM-DD') AS result;

--echo #
--echo # Fuzzy string
--echo

SELECT TO_DATE('0207','MM/YY');
SELECT TO_DATE('02#07','MM/YY');
SELECT TO_DATE('2001 -- 10','YYYY - MM');
SELECT TO_DATE('1920-12','YYYY--MM');
SELECT TO_DATE('1920--12','YYYY"--"MM');
SELECT TO_DATE('-','-');

--echo # Tab and space
SELECT TO_DATE('25	05 3','YY MM DD');

--echo # Quotes
select TO_DATE('2023-01-02 hello 03:04:05', 'YYYY-MM-DD "hello" HH24:MI:SS');
select TO_DATE('2023-01-02 "03:04:05"', 'YYYY-MM-DD #HH24:MI:SS#');
select TO_DATE('2023X', 'YYYY"x"');

--echo # Quotes with non-ASCII characters
SELECT TO_DATE('2023-01-02 ПРИвет 03:04:05', 'YYYY-MM-DD "приВЕТ" HH24:MI:SS');
SELECT TO_DATE('2023-01-02 가 03:04:05', 'YYYY-MM-DD "가" HH24:MI:SS') AS c;
SELECT TO_DATE('2023-01-02 豈 03:04:05', 'YYYY-MM-DD "豈" HH24:MI:SS') AS c;
SELECT TO_DATE('2023-01-02 Ａ03:04:05', 'YYYY-MM-DD "ａ" HH24:MI:SS') AS c;

SELECT TO_DATE('2023-01-02 à 03:04:05' COLLATE utf8mb3_general_ci,
               'YYYY-MM-DD "a" HH24:MI:SS') AS c;
SELECT TO_DATE('2023-01-02 à 03:04:05' COLLATE utf8mb3_general_ci,
               'YYYY-MM-DD "A" HH24:MI:SS') AS c;

SELECT TO_DATE('2023-01-02 à 03:04:05' COLLATE utf8mb3_bin,
               'YYYY-MM-DD "a" HH24:MI:SS') AS c;
SELECT TO_DATE('2023-01-02 à 03:04:05' COLLATE utf8mb3_bin,
               'YYYY-MM-DD "à" HH24:MI:SS') AS c;

--echo # NULL handling
SELECT TO_DATE('2026-01-01', NULL);
SELECT TO_DATE(NULL, "YYYY") as x;
SELECT TO_DATE('1921', '') as x;
SELECT TO_DATE('','');

--echo #
--echo # Not allowed fuzzy string
--echo #

SELECT TO_DATE('2001 - - 10','YYYY - MM');
SELECT TO_DATE('02#/07','MM/YY');
SELECT TO_DATE('2023-01-02 helloa 03:04:05', 'YYYY-MM-DD "hello" HH24:MI:SS');

--echo #
--echo # Error Handling (Invalid/not supported formats)
--echo

SELECT TO_DATE('Not a date', 'YYYY-MM-DD') AS result;
SELECT TO_DATE('2025-02-30', 'YYYY-MM-DD') AS result;
SELECT TO_DATE('26-10-1000 BC', 'DD-MM-YYYY BC') AS result;
SELECT TO_DATE('Monday', 'DAY') AS result;

SET timestamp=unix_timestamp("2025-01-31");
SELECT TO_DATE('January', 'MONTH') AS result;
SELECT TO_DATE('February', 'MONTH') AS result;

--echo # Wrong quoting
select TO_DATE('2023-01-02 "03:04:05"', 'YYYY-MM-DD """"HH24:MI:SS""""');
select TO_DATE('2023-01-02 hello 03:04:05', 'YYYY-MM-DD HH24:MI:SS');
select TO_DATE('2023-01-02 03:04:05', 'YYYY-MM-DD "hello" HH24:MI:SS');
select TO_DATE('2023-01-02 "03:04:05"', 'YYYY-MM-DD ""HH24:MI:SS""');
SELECT TO_DATE('1920-12','YYYY"--"MM');
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('1920-12','YYYY"-MM');
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('2023-01-02 helloa 03:04:05', 'YYYY-MM-DD "hello HH24:MI:SS');


--error ER_STD_INVALID_ARGUMENT
select TO_DATE('2023-01-02 hello 03:04:05', 'YYYY-MM-DD hello HH24:MI:SS');
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('2025-10-26 10:30:25.123456', 'YYYY-MM-DD HH:MI:SS.FF0') AS result;
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('2025-10-26 26', 'YYYY-MM-DD DD') AS result;
--error ER_PARSE_ERROR
SELECT TO_DATE() AS x;
--error ER_PARSE_ERROR
SELECT TO_DATE(NULL) AS x;
--error ER_PARSE_ERROR
SELECT TO_DATE('2026-01-01') AS x;
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('2','IW') AS x;
--error ER_STD_INVALID_ARGUMENT
SELECT TO_DATE('','hello') as x;
SELECT TO_DATE('','"hello"') as x;
SELECT TO_DATE('abc','"hello"') as x;

CREATE TABLE t (c GEOMETRYCOLLECTION);
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT TO_DATE(c,'YYYY-MM-DD') FROM t;
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT TO_DATE('2025-01-02',c) FROM t;
--error ER_PARSE_ERROR
SELECT TO_DATE('2025-01-02', DEFAULT c ON CONVERSION ERROR, 'YYYY-MM-DD') from t;
DROP TABLE t;


--echo #
--echo # Default handling
--echo #

SELECT TO_DATE(NULL DEFAULT '2024-01-02' ON CONVERSION ERROR, 'YYYY-MM-DD') AS result;
SELECT TO_DATE('not a date' DEFAULT '2024-01-02' ON CONVERSION ERROR, 'YYYY-MM-DD') AS result;

SELECT TO_DATE('2025' DEFAULT NULL ON CONVERSION ERROR, 'YYYY-MM-DD') AS result;

SELECT TO_DATE('2025-13-02' DEFAULT '2025-12-02' ON CONVERSION ERROR, 'YYYY-MM-DD') AS result;
SELECT TO_DATE('2025-13-02' DEFAULT '2025-14-02' ON CONVERSION ERROR, 'YYYY-MM-DD') AS result;

--echo #
--echo # Check virtual functions with TO_DATE
--echo #

--error ER_GENERATED_COLUMN_FUNCTION_IS_NOT_ALLOWED
create or replace table t1 (
c1 varchar(10),
c2 datetime as (to_date(c1,'MM')) virtual,
key(c2));

--error ER_GENERATED_COLUMN_FUNCTION_IS_NOT_ALLOWED
create or replace table t1 (
c1 varchar(10),
c2 datetime as (to_date(c1, "YYYY-MM-DD HH:MM:SS")) virtual,
key(c2));

--echo #
--echo # NLS_DATA functions
--echo #

SELECT TO_DATE(' 2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN') AS x;
SELECT TO_DATE(' 2024-January-01 00:00:00', 'YYYY-MONTH-DD HH24:MI:SS', '  NLS_CALENDAR = GREGORIAN  NLS_DATE_LANGUAGE =en_AU   ') AS x;
SELECT TO_DATE(' 2024-February-01 00:00:00', 'YYYY-MONTH-DD HH24:MI:SS', '  NLS_CALENDAR = GREGORIAN  NLS_DATE_LANGUAGE ="en_AU"   ') AS x;

SELECT TO_DATE('January 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', 'NLS_DATE_LANGUAGE = American') AS x;
SELECT TO_DATE('Januar 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', 'NLS_DATE_LANGUAGE = German') AS x;
SELECT TO_DATE('Ja 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', 'NLS_DATE_LANGUAGE = German') AS x;
SELECT TO_DATE('15 Heinäkuu 2024','DD MONTH YYYY','NLS_DATE_LANGUAGE=FINNISH') AS x;
SELECT TO_DATE('15 HEINÄKUU 2024','DD MONTH YYYY','NLS_DATE_LANGUAGE=FINNISH') AS x;
SELECT TO_DATE('15 HEINÄ 2024','DD MONTH YYYY','NLS_DATE_LANGUAGE=FINNISH') AS x;

CREATE TABLE t1 (a VARCHAR(32) CHARACTER SET latin1);
INSERT INTO t1 VALUES ('2026-März-01');
SELECT a, to_date(a, 'YYYY-MONTH-DD') AS d FROM t1;
SELECT a, to_date(a, 'YYYY-MONTH-DD','NLS_DATE_LANGUAGE=GERMAN') AS d FROM t1;
SET @@lc_time_names='de_DE';
SELECT a, to_date(a, 'YYYY-MONTH-DD') AS d FROM t1;
SET @@lc_time_names=DEFAULT;
DROP TABLE t1;

--echo #
--echo # NLS_DATA errors
--echo #
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=VICTORIAN') AS x;
SELECT TO_DATE('January 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', 'NLS_DATE_LANGUAGE = German') AS x;
--error ER_UNKNOWN_LOCALE
SELECT TO_DATE('January 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', 'NLS_DATE_LANGUAGE = not_exists');
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_XX=YYY') AS x;
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', '=YYY') AS x;
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'XX=') AS x;
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'XX=') AS x;
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'A=B C=') AS x;
SELECT TO_DATE('2024-11-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'A=B =D') AS x;
/* H matches Heinäkuu and Helmikuu */
SELECT TO_DATE('15 H 2024','DD MONTH YYYY','NLS_DATE_LANGUAGE=FINNISH') AS x;
SELECT TO_DATE('15 Heinäkuu 2024','DD "Heinäkuu" YYYY','NLS_DATE_LANGUAGE=FINNISH') AS x;
set @a='NLS_DATE_LANGUAGE = American';
--error ER_PARSE_ERROR
SELECT TO_DATE('January 15, 1989, 11:00 A.M.', 'Month dd, YYYY, HH:MI A.M.', @a);
