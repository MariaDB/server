include/rpl_init.inc [topology=1->2, 1->3]
# Set up
CREATE TABLE t (a INT);
include/save_master_pos.inc
include/save_master_gtid.inc
connection server_2;
START SLAVE;
include/sync_with_master_gtid.inc
connection server_3;
SET @save_gtid_ignore_duplicates= @@GLOBAL.gtid_ignore_duplicates;
SET @@GLOBAL.gtid_ignore_duplicates= ON;
START SLAVE IO_THREAD;
include/sync_io_with_master.inc
CHANGE MASTER 'bridge' TO
master_host='127.0.0.1', master_port=SERVER_MYPORT_2, master_user='root';
SET @@SESSION.default_master_connection= 'bridge';
include/start_slave.inc
include/sync_with_master_gtid.inc
include/stop_slave.inc
SET @@SESSION.default_master_connection= '';
RESET SLAVE 'bridge' ALL;
# Test
SET @@GLOBAL.sql_slave_skip_counter= 100;
START SLAVE SQL_THREAD;
include/wait_for_slave_param.inc [Relay_Master_Log_File]
include/wait_for_slave_param.inc [Exec_Master_Log_Pos]
SELECT @@sql_slave_skip_counter;
@@sql_slave_skip_counter
100
Skip_Counter = '100'
connection server_1;
DROP TABLE t;
include/save_master_gtid.inc
connection server_2;
include/sync_with_master_gtid.inc
connection server_3;
include/sync_with_master_gtid.inc
SHOW TABLES;
Tables_in_test
t
# Tear down
include/stop_slave.inc
SET @@GLOBAL.sql_slave_skip_counter= 0;
SET @@GLOBAL.gtid_ignore_duplicates= @save_gtid_ignore_duplicates;
SET STATEMENT sql_log_bin=0 FOR DROP TABLE t;
include/rpl_end.inc
