include/rpl_init.inc [topology=1->2->3]
CREATE TABLE t (a INT);
DROP TABLE t;
include/save_master_pos.inc
connection server_3;
SET @save_dbug= @@GLOBAL.debug_dbug;
SET @save_gtid_ignore_duplicates= @@GLOBAL.gtid_ignore_duplicates;
SET @@GLOBAL.gtid_ignore_duplicates= ON;
CHANGE MASTER 'shortcut' TO
master_host='127.0.0.1', master_port=SERVER_MYPORT_1, master_user='root';
SET @@SESSION.default_master_connection= 'shortcut';
START SLAVE IO_THREAD;
include/sync_io_with_master.inc
SET @@SESSION.default_master_connection= '';
START SLAVE;
connection server_2;
START SLAVE;
include/wait_for_slave_param.inc [Relay_Master_Log_File]
include/wait_for_slave_param.inc [Exec_Master_Log_Pos]
connection server_3;
SET @@SESSION.default_master_connection= 'shortcut';
SELECT @@sql_slave_skip_counter AS 'Before';
Before
0
Skip_Counter = '0'
SET @@GLOBAL.debug_dbug= '+d,pause_sql_thread_on_gtid_ignore_duplicates';
START SLAVE SQL_THREAD;
SET @@SESSION.debug_sync='now WAIT_FOR paused_on_event';
SELECT @@sql_slave_skip_counter AS 'During';
During
0
Skip_Counter = '0'
SET @@GLOBAL.debug_dbug= @save_dbug;
SET @@SESSION.debug_sync='now SIGNAL sql_thread_continue';
include/wait_for_slave_param.inc [Relay_Master_Log_File]
include/wait_for_slave_param.inc [Exec_Master_Log_Pos]
SELECT @@sql_slave_skip_counter AS 'After';
After
0
Skip_Counter = '0'
# Cleanup
include/stop_slave.inc
SET @@SESSION.default_master_connection= '';
include/stop_slave.inc
RESET SLAVE 'shortcut' ALL;
SET @@SESSION.debug_sync='RESET';
SET @@GLOBAL.gtid_ignore_duplicates= @save_gtid_ignore_duplicates;
include/rpl_end.inc
