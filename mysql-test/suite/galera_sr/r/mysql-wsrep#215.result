CREATE TABLE t1 (f1 INTEGER PRIMARY KEY AUTO_INCREMENT) ENGINE=InnoDB;
SET SESSION wsrep_trx_fragment_size = 2;
SET SESSION wsrep_trx_fragment_unit = 'statements';
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SET AUTOCOMMIT=OFF;
START TRANSACTION;
SET GLOBAL debug = 'd,sync.wsrep_apply_cb';
SET SESSION wsrep_sync_wait = 0;
INSERT INTO t1 VALUES (1);
SELECT COUNT(*) = 0 FROM t1;
COUNT(*) = 0
1
INSERT INTO t1 VALUES (1);
SET DEBUG_SYNC='now SIGNAL signal.wsrep_apply_cb';
SET GLOBAL debug = '';
INSERT INTO t1 VALUES (2);
Got one of the listed errors
COMMIT;
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SELECT COUNT(*) = 1 FROM t1;
COUNT(*) = 1
1
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
TRUNCATE TABLE t1;
SET SESSION wsrep_trx_fragment_size = 10;
SET SESSION wsrep_trx_fragment_unit = 'bytes';
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SET AUTOCOMMIT=OFF;
START TRANSACTION;
SET GLOBAL debug = 'd,sync.wsrep_apply_cb';
SET SESSION wsrep_sync_wait = 0;
INSERT INTO t1 VALUES (1);
SELECT COUNT(*) = 0 FROM t1;
COUNT(*) = 0
1
INSERT INTO t1 VALUES (1);
SET DEBUG_SYNC='now SIGNAL signal.wsrep_apply_cb';
SET GLOBAL debug = '';
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
INSERT INTO t1 VALUES (2);
COMMIT;
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SELECT COUNT(*) = 2 FROM t1;
COUNT(*) = 2
1
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
TRUNCATE TABLE t1;
SET SESSION wsrep_trx_fragment_size = 200;
SET SESSION wsrep_trx_fragment_unit = 'bytes';
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SET AUTOCOMMIT=OFF;
START TRANSACTION;
SET GLOBAL debug = 'd,sync.wsrep_apply_cb';
SET SESSION wsrep_sync_wait = 0;
INSERT INTO t1 VALUES (1);
SELECT COUNT(*) = 0 FROM t1;
COUNT(*) = 0
1
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
SET DEBUG_SYNC='now SIGNAL signal.wsrep_apply_cb';
SET GLOBAL debug = '';
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
COMMIT;
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
SELECT COUNT(*) = 1 FROM t1;
COUNT(*) = 1
1
SELECT COUNT(*) = 0 FROM wsrep_schema.SR;
COUNT(*) = 0
1
DROP TABLE t1;
