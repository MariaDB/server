CREATE TABLE t (
  id INT PRIMARY KEY,
  b MEDIUMBLOB NULL,
  c INT
) ENGINE=MyISAM;

INSERT INTO t VALUES
  (1, REPEAT('a', 10000), 1),
  (2, NULL, 2),
  (3, REPEAT('b', 10000), 3),
  (4, NULL, 4);

FLUSH STATUS;
SELECT COUNT(*) FROM t WHERE b IS NULL;
SELECT VARIABLE_VALUE > 0 AS null_only_used
  FROM information_schema.session_status
 WHERE VARIABLE_NAME='Handler_null_only_columns';

FLUSH STATUS;
SELECT COUNT(*) FROM t WHERE b <=> NULL;
SELECT VARIABLE_VALUE > 0 AS null_only_used
  FROM information_schema.session_status
 WHERE VARIABLE_NAME='Handler_null_only_columns';

FLUSH STATUS;
SELECT COUNT(*)
  FROM t t1 JOIN t t2
    ON t1.id= t2.id AND t1.b IS NULL;
SELECT VARIABLE_VALUE > 0 AS null_only_used
  FROM information_schema.session_status
 WHERE VARIABLE_NAME='Handler_null_only_columns';

FLUSH STATUS;
SELECT COUNT(*)
  FROM t outer_t
 WHERE EXISTS (SELECT 1
                 FROM t inner_t
                WHERE inner_t.id= outer_t.id
                  AND inner_t.b IS NULL);
SELECT VARIABLE_VALUE > 0 AS null_only_used
  FROM information_schema.session_status
 WHERE VARIABLE_NAME='Handler_null_only_columns';

FLUSH STATUS;
SELECT IFNULL(SUM(LENGTH(b)), -1) AS total_len
  FROM t WHERE b IS NULL OR c = 3;
SELECT VARIABLE_VALUE = 0 AS null_only_used
  FROM information_schema.session_status
 WHERE VARIABLE_NAME='Handler_null_only_columns';

SELECT id, IFNULL(LENGTH(b), -1) AS len
  FROM t WHERE b IS NULL OR c = 3
  ORDER BY id;
SELECT id FROM t WHERE b IS NULL FOR UPDATE;

CREATE TABLE t_v (
  id INT PRIMARY KEY,
  b MEDIUMBLOB NULL,
  v VARBINARY(1) AS (SUBSTR(b, 1, 1)) VIRTUAL
) ENGINE=MyISAM;

INSERT INTO t_v (id, b) VALUES
  (1, REPEAT('a', 10000)),
  (2, NULL),
  (3, REPEAT('b', 10000)),
  (4, NULL);

SELECT COUNT(*) FROM t_v WHERE v IS NULL;

DROP TABLE t_v;
DROP TABLE t;
