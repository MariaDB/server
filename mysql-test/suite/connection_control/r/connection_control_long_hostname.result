# Setup
# Install connection_control plugin
INSTALL PLUGIN connection_control SONAME 'CONNECTION_CONTROL_LIB';
INSTALL PLUGIN connection_control_failed_login_attempts SONAME 'CONNECTION_CONTROL_LIB';
# Create user accounts for testing
CREATE USER u1 IDENTIFIED BY 'abcd';
FLUSH HOSTS;
SET @old_debug=@@global.debug_dbug;
SET GLOBAL DEBUG_DBUG='+d,vio_peer_addr_fake_ipv4,getnameinfo_fake_long_host,getaddrinfo_fake_good_ipv4';
connect(127.0.0.1,u1,,test,MASTER_PORT,MASTER_SOCKET);
connect 'con1','127.0.0.1','u1',,test,$MASTER_MYPORT,;
ERROR 28000: Access denied for user 'u1'@'host5678901_345678902_345678903_345678904_345678905_345678906_345678907_345678908_345678909_345678910_345678911_345678912_345678913_345678914_345678915_345678916_345678917_345678918_345678919_345678920_345678921_345678922_345678923_345678924_345678925_345' (using password: NO)
SET GLOBAL DEBUG_DBUG=@old_debug;
# Try various queries
SELECT * FROM INFORMATION_SCHEMA.connection_control_failed_login_attempts;
USER_HOST	FAILED_ATTEMPTS
'u1'@'host5678901_345678902_345678903_345678904_345678905_345678906_345678907_345678908_345678909_345678910_345678911_345678912_345678913_345678914_345678915_345678916_345678917_345678918_345678919_345678920_345678921_345678922_345678923_345678924_345678925_345'	1
# Cleanup.
DROP USER u1;
# Uninstall connection_control plugin
UNINSTALL PLUGIN connection_control;
UNINSTALL PLUGIN connection_control_failed_login_attempts;
