*** Test handling of disk full, waiting for space to be freed.
CREATE TABLE t1 (a INT NOT NULL, b INT NOT NULL, c LONGBLOB, PRIMARY KEY(a, b)) ENGINE=InnoDB;
INSERT INTO t1 VALUES (0, 0, 'Start');
INSERT INTO t1 VALUES (1, 0, REPEAT('a', 1000000));
connection default;
SET @old_dbug= @@GLOBAL.debug_dbug;
SET GLOBAL debug_dbug= '+d,ib_alloc_file_disk_full';
connect con1,localhost,root,,;
SET SESSION debug_dbug= '+d,dummy_keyword_just_to_not_enable_dbug_output';
SET SESSION debug_dbug= '-d,ib_alloc_file_disk_full';
INSERT INTO t1 VALUES (2, 0, REPEAT('b', 1000000));
connection default;
SELECT a, b, LENGTH(c) FROM t1 ORDER BY a, b;
a	b	LENGTH(c)
0	0	5
1	0	1000000
SET GLOBAL debug_dbug= @old_dbug;
connection con1;
connection default;
disconnect con1;
SELECT a, b, LENGTH(c) FROM t1 ORDER BY a, b;
a	b	LENGTH(c)
0	0	5
1	0	1000000
2	0	1000000
include/assert_grep.inc [Check that binlog pre-allocation is retried on ENOSPC]
DROP TABLE t1;
CALL mtr.add_suppression('InnoDB: Unable to allocate file.* "No space left on device"');
