include/master-slave.inc
[connection master]
*** Test large gtid_state record, > 1 page.
connection master;
CREATE TABLE t1 (a INT PRIMARY KEY, b INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES (0, 0);
include/save_master_gtid.inc
connection slave;
include/sync_with_master_gtid.inc
include/stop_slave.inc
connection master;
include/save_master_gtid.inc
SELECT COUNT(*) AS midway_count FROM t1;
midway_count
4001
INSERT INTO t1 VALUES (-1, 2);
FLUSH BINARY LOGS;
INSERT INTO t1 VALUES (-2, 3);
SELECT COUNT(*) AS full_count FROM t1;
full_count
8003
include/rpl_restart_server.inc [server_number=1]
OK, binlog state preserved across server restart.
connection slave;
Warnings:
Note	1278	It is recommended to use --skip-slave-start when doing step-by-step replication with START SLAVE UNTIL; otherwise, you will get problems if you get an unexpected slave's mariadbd restart
include/sync_with_master_gtid.inc
SELECT COUNT(*) FROM t1;
COUNT(*)
4001
include/wait_for_slave_to_stop.inc
connection master;
include/save_master_gtid.inc
connection slave;
include/start_slave.inc
include/sync_with_master_gtid.inc
SELECT COUNT(*) FROM t1;
COUNT(*)
8003
connection master;
DROP TABLE t1;
include/rpl_end.inc
