--source include/have_binlog_format_row.inc
--source include/have_innodb_binlog.inc

RESET MASTER;

CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t2 (a INT PRIMARY KEY, b VARCHAR(2048)) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1);
BEGIN;
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
COMMIT;
INSERT INTO t2 VALUES (0, REPEAT("x", 2048));
INSERT INTO t2 SELECT a+1, b FROM t2;
INSERT INTO t2 SELECT a+2, b FROM t2;
INSERT INTO t2 SELECT a+4, b FROM t2;
INSERT INTO t2 SELECT a+8, b FROM t2;

SHOW BINARY LOGS;
FLUSH BINARY LOGS;
SHOW BINARY LOGS;

RESET MASTER;
# ToDo: This will be racy, the second binlog file binlog-000001.ibb is
# pre-allocated in the background, so will be visible or not depending on exact
# timing. So just omit this SHOW BINARY LOGS or wait for both to be created
# or something.
SHOW BINARY LOGS;

INSERT INTO t1 VALUES (100);
INSERT INTO t2 VALUES (100, 'xyzzy');

DROP TABLE t1, t2;

--exec $MYSQL_BINLOG --read-from-remote-server --user=root --host=127.0.0.1 --port=$MASTER_MYPORT master-bin.000001 --start-position=0-1-1 > $MYSQLTEST_VARDIR/tmp/mysqlbinlog.txt
