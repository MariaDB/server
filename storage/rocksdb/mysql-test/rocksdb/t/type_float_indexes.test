--source include/have_rocksdb.inc

#
# Float type columns with indexes
#

SET @ORIG_PAUSE_BACKGROUND_WORK = @@ROCKSDB_PAUSE_BACKGROUND_WORK;
SET GLOBAL ROCKSDB_PAUSE_BACKGROUND_WORK = 1;

--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings

CREATE TABLE t1 (
  f FLOAT PRIMARY KEY,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10)
) ENGINE=rocksdb;

SHOW INDEX IN t1;

INSERT INTO t1 (f,r,d,dp) VALUES
(1.2345,1422.22,1.2345,1234567.89),
(0,0,0,0),
(-1,-1,-1,-1),
(17.5843,4953453454.44,29229114.0,1111111.23),
(4644,1422.22,466664.999,0.5);

--replace_column 9 #
EXPLAIN SELECT f FROM t1 ORDER BY f;
SELECT f FROM t1 ORDER BY f;

--replace_column 9 #
EXPLAIN SELECT f FROM t1 IGNORE INDEX (PRIMARY) ORDER BY f;
SELECT f FROM t1 IGNORE INDEX (PRIMARY) ORDER BY f;

DROP TABLE t1;

#--error ER_GET_ERRMSG
CREATE TABLE t1 (
  f FLOAT,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10),
  pk DOUBLE PRIMARY KEY,
  UNIQUE KEY r_dp (r,dp)
) ENGINE=rocksdb;

#--disable_parsing

SHOW INDEX IN t1;
  
INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,1422.22,1.2345,1234567.89,1),
(0,0,0,0,2),
(-1,-1,-1,-1,3),
(17.5843,4953453454.44,29229114.0,1111111.23,4),
(4644,1422.22,466664.999,0.5,5);

--replace_column 9 #
EXPLAIN SELECT r, dp FROM t1 WHERE r > 0 or dp > 0;
--sorted_result
SELECT r, dp FROM t1 WHERE r > 0 or dp > 0;

DROP TABLE t1;

CREATE TABLE t1 (
  f FLOAT,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10),
  pk FLOAT PRIMARY KEY,
  UNIQUE KEY(d)
) ENGINE=rocksdb;

SHOW INDEX IN t1;

INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,1422.22,1.2345,1234567.89,1),
(0,0,0,0,2),
(-1,-1,-1,-1,3),
(17.5843,4953453454.44,29229114.0,1111111.23,4),
(4644,1422.22,466664.999,0.5,5);

--replace_column 9 #
EXPLAIN SELECT DISTINCT d FROM t1 ORDER BY d;
SELECT DISTINCT d FROM t1 ORDER BY d;

DROP TABLE t1;

#--enable_parsing

CREATE TABLE t1 (
  f FLOAT,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10),
  pk FLOAT PRIMARY KEY,
  KEY(d)
) ENGINE=rocksdb;

SHOW INDEX IN t1;

INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,1422.22,1.2345,1234567.89,1),
(0,0,0,0,2),
(-1,-1,-1,-1,3),
(17.5843,4953453454.44,29229114.0,1111111.23,4),
(4644,1422.22,466664.999,0.5,5);

--replace_column 9 #
EXPLAIN SELECT DISTINCT d FROM t1 ORDER BY d;
SELECT DISTINCT d FROM t1 ORDER BY d;

DROP TABLE t1;

CREATE TABLE t1 (
  f FLOAT,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10),
  pk FLOAT PRIMARY KEY,
  UNIQUE KEY(f)
) ENGINE=rocksdb;

SHOW INDEX IN t1;

INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,1422.22,1.2345,1234567.89,1),
(0,0,0,0,2),
(-1,-1,-1,-1,3),
(17.5843,4953453454.44,29229114.0,1111111.23,4),
(4644,1422.22,466664.999,0.5,5);

# Should fail because of 'unique' constraint
--error ER_DUP_ENTRY
INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,0,0,0,6);

--replace_column 9 #
EXPLAIN SELECT DISTINCT f FROM t1 ORDER BY f;
SELECT DISTINCT f FROM t1 ORDER BY f;

DROP TABLE t1;

CREATE TABLE t1 (
  f FLOAT,
  r REAL(20,3),
  d DOUBLE,
  dp DOUBLE PRECISION (64,10),
  pk FLOAT PRIMARY KEY,
  KEY(f)
) ENGINE=rocksdb;

SHOW INDEX IN t1;

INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,1422.22,1.2345,1234567.89,1),
(0,0,0,0,2),
(-1,-1,-1,-1,3),
(17.5843,4953453454.44,29229114.0,1111111.23,4),
(4644,1422.22,466664.999,0.5,5);

# Should succeed because of no 'unique' constraint
INSERT INTO t1 (f,r,d,dp,pk) VALUES
(1.2345,0,0,0,6);

--replace_column 9 #
EXPLAIN SELECT DISTINCT f FROM t1 ORDER BY f;
SELECT DISTINCT f FROM t1 ORDER BY f;

DROP TABLE t1;

SET GLOBAL ROCKSDB_PAUSE_BACKGROUND_WORK = @ORIG_PAUSE_BACKGROUND_WORK;
